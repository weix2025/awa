(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9537],{76905:function(e,t,n){Promise.resolve().then(n.bind(n,57329))},57329:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var i=n(27573),a=n(28803),s=n(1133),r=n(81695),l=n(48894),o=n(47082),d=n(27218),u=n(98731);function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let n=Math.ceil(t/2);return"".concat(e.substring(0,n),"\n\n  [...]\n\n  ").concat(e.substring(e.length-n))}var m=n(7653),f=n(40950),v=n(71817),g=n(57271),p=n(1812),_=n(88755),x=n(51375),h=n(7680),y=n(18701),j=n(40030),k=n(81865),C=n(49034),S=n(3053),w=n(67995),b=n(53392),N=n(59821),M=n(70354),E=n(52939),z=n(22523),I=n(45790),A=n(30833),U=n(66829),O=n(65499);function Z(e){let{isModalOpen:t,currentTool:n,currentToolInput:a,currentServer:s,handleDeny:r,handleAllow:l,handleAlwaysAllow:o}=e,{isExpanded:d,setIsExpanded:u,snappyTransition:c}=(0,O.g)(!1);if(n)return(0,i.jsxs)(E.u_,{isOpen:t,onClose:()=>r(),autoCloseOnFocusOut:!1,modalSize:"lg",title:(0,i.jsx)(I.Z,{defaultMessage:"Claude would like to use an external integration",id:"UubrzH+Qzc"}),children:[(0,i.jsx)("div",{className:"mt-4"}),(0,i.jsx)(A.qd,{isStreaming:!1,isExpanded:d,setIsExpanded:u,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,i.jsx)(z.X2,{className:"!py-0",children:(0,i.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,i.jsx)(N.s,{url:null==s?void 0:s.url,fallbackSvg:(0,i.jsx)(b._,{letter:n.serverName,size:40}),size:40}),(0,i.jsxs)("div",{className:"flex flex-col py-1",children:[(0,i.jsx)("div",{className:"text-sm text-text-400 font-mono",children:n.name}),(0,i.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:n.serverName})]})]})}),className:"!h-auto",children:(0,i.jsx)(A.jE,{isExpanded:d,snappyTransition:c,isScrollable:!0,children:(0,i.jsx)(U.K,{input:a?JSON.parse(a):""})})}),(0,i.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,i.jsx)("p",{className:"font-medium",children:(0,i.jsx)(I.Z,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,i.jsx)("p",{children:(0,i.jsx)(I.Z,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,i.jsx)(E.dm,{className:"flex justify-between",children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex gap-2",children:[o&&(0,i.jsx)(M.z,{onClick:o,children:(0,i.jsx)(I.Z,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,i.jsx)(M.z,{onClick:l,autoFocus:!0,children:(0,i.jsx)(I.Z,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,i.jsx)(M.z,{onClick:r,variant:"outline",children:(0,i.jsx)(I.Z,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function D(e){var t,n;let{conversation:s,conversationUUID:l,isLoadingHarmony:o,chatInputDefaultMessage:h}=e,{currentPath:y,data:j,isLoading:b,isPlaceholderData:N}=(0,a._C)(l,{suppressError:!0}),{changeDisplayedConversationPath:M}=(0,g.p)(),{onInvokeTool:E,isModalOpen:z,currentTool:I,currentToolInput:A,currentServer:U,handleAllow:O,handleDeny:D,handleAlwaysAllow:T}=function(e){let{conversationUUID:t}=e,{mcpTools:n,servers:i}=(0,x.cH)(),a=(0,C.Q)(),{track:s}=(0,S.z$)(),[r,l]=(0,m.useState)(!1),[o,d]=(0,m.useState)(null),[u,c]=(0,m.useState)(null),[f,v]=(0,m.useState)(null),[g,p]=(0,m.useState)(null),_=(0,x.YB)(),{toggleMcpToolAlwaysApproved:h}=(0,x.$Y)(),{getApprovalSetting:y}=(0,x.S9)(),{alwaysAllowEnabled:j}=y(null==o?void 0:o.serverName,o),k=(0,m.useRef)(_);(0,m.useEffect)(()=>{k.current=_},[_]);let b=(0,m.useCallback)(async(e,t,s,r,o)=>{var u,m;let f=n.find(e=>e.name===t),g=(null===(u=i.find(e=>{let{name:t}=e;return t===(null==f?void 0:f.serverName)}))||void 0===u?void 0:u.uuid)||"local";if(!f||!g)return a(e,t,s,r,o);let{approvalSetting:_}=y(f.serverName,f);if("never"===_)return a(e,t,s,r,o);if("dolphin"===t){let n=(m=(0,w.I)(r))&&"object"==typeof m?"actions"in m&&Array.isArray(m.actions)?m.actions.map(e=>({type:e.action,state:"pending",coordinate:"coordinate"in e?e.coordinate:void 0,start_coordinate:"start_coordinate"in e?e.start_coordinate:void 0,text:"text"in e?e.text:void 0,scroll_direction:"scroll_direction"in e?e.scroll_direction:void 0,scroll_amount:"scroll_amount"in e?e.scroll_amount:void 0,duration:"duration"in e?e.duration:void 0})):"action"in m?[{type:m.action,state:"pending",coordinate:"coordinate"in m?m.coordinate:void 0,start_coordinate:"start_coordinate"in m?m.start_coordinate:void 0,text:"text"in m?m.text:void 0,scroll_direction:"scroll_direction"in m?m.scroll_direction:void 0,scroll_amount:"scroll_amount"in m?m.scroll_amount:void 0,duration:"duration"in m?m.duration:void 0}]:[]:[];if(1===n.length&&"screenshot"===n[0].type)return a(e,t,s,r,o);if(n.length>0)return new Promise(e=>{c(g),d(f),v(s),p(r),e()})}return k.current.includes((0,x.PQ)(g,f))?a(e,t,s,r,o):new Promise(e=>{c(g),d(f),v(s),p(r),l(!0),e()})},[i,a,n,y]),N=(0,m.useCallback)(()=>{l(!1),o&&null!==f&&null!==g&&a(t,o.name,f,g)},[t,o,f,g,a]),M=(0,m.useCallback)(()=>{if(l(!1),o&&null!==f&&null!==g){var e;a(t,o.name,f,g,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),s({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!==(e=(0,w.I)(g))&&void 0!==e?e:{}).length})}},[t,o,f,g,a,s]),E=(0,m.useCallback)(()=>{j&&(o&&u&&h(u,o,!0),l(!1),o&&null!==f&&null!==g&&a(t,o.name,f,g))},[u,t,o,f,g,a,h,j]);return{onInvokeTool:b,isModalOpen:r,currentTool:o,currentServer:i.find(e=>e.uuid===u),currentToolInput:g,handleAllow:N,handleDeny:M,handleAlwaysAllow:j?E:void 0}}({conversationUUID:l}),F=(0,C.z)(null==j?void 0:j.settings,null==s?void 0:s.project_uuid),[R,P]=(0,m.useState)(),Q=(0,m.useCallback)(e=>{P(e)},[P]),K=(0,v.pV)(l,E,F),L=(0,v.lE)(l,E,F,R),{mutate:q}=(0,a.jl)(l),V=K.isStreaming||L.isStreaming,Y=K.runStream;!function(e,t){let[n,i]=(0,m.useState)(!1),{activeOrganization:s}=(0,d.t)(),r=(0,f.Z)(),l=e?e.uuid:"",{mutate:o}=(0,a.W)(l),{mutate:v,error:g}=(0,a.j7)(l),p=(0,m.useRef)(!1);(0,m.useEffect)(()=>{var t;if(!g||(null==e?void 0:e.name))return;let n=(null==e?void 0:null===(t=e.chat_messages)||void 0===t?void 0:t[0])?(0,u.K)(e.chat_messages[0]):"";if(n){if(p.current)return;let e=n.slice(0,30),t=n.length>30?"...":"";p.current=!0,o({name:"".concat(e).concat(t)})}},[g,e,o]),(0,m.useEffect)(()=>{if(t||n||(null==e?void 0:e.name))return;let a=null==e?void 0:e.chat_messages;if(!a||a.length<2||0===(0,u.K)(a[1]).length)return;let r=["Message 1:",c((0,u.K)(a[0])),"Message 2:",c((0,u.K)(a[1]))].join("\n\n");s&&(i(!0),v({message_content:r,recent_titles:[]}))},[t,n,e,s,v,r])}(j,V),function(e){let{conversationUUID:t,isStreaming:n}=e,[i,a]=(0,m.useState)(n),{mcpClients:s}=(0,x.cH)(),r=s.dolphin,l=(0,_.Q)(),o=!!r&&l;(0,m.useEffect)(()=>{o&&(!n&&i?(a(!1),r.notification({method:"notifications/progress",params:{progress:1,total:1,progressToken:"streaming"}})):!i&&n&&(r.notification({method:"notifications/progress",params:{progress:0,total:1,progressToken:"streaming"}}),a(!0)))},[t,o,n,i,r])}({conversationUUID:l,isStreaming:V});let B=(0,m.useCallback)(async(e,t)=>{var n,i;await Y({prompt:t,attachments:e.attachments,files:null!==(i=e.files_v2)&&void 0!==i?i:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:R,compass_mode:null===(n=e.metadata)||void 0===n?void 0:n.compass_mode})},[Y,R]),H=(0,m.useCallback)((e,t)=>{M(l,e,t,e=>q({current_leaf_message_uuid:e}))},[M,l,q]);return j||b||N||(0,r.notFound)(),(0,i.jsxs)(p.I,{settings:(null==j?void 0:j.settings)||{},children:[(0,i.jsx)(k.J,{isStreaming:V,chatInputDefaultMessage:h,conversationTitle:s?"".concat(s.name," - Claude"):"Claude",conversationUUID:l,isLoading:b||!!o,messages:y,name:null!==(n=null!==(t=null==j?void 0:j.name)&&void 0!==t?t:null==s?void 0:s.name)&&void 0!==n?n:"Untitled Chat",onSend:K.runStream,onRetry:L.runStream,projectUuid:null==j?void 0:j.project_uuid,changeDisplayedConversationPath:H,editMessage:B,setPersonalizedStyleCallback:Q,onToolAllow:O}),(0,i.jsx)(Z,{isModalOpen:z,currentTool:I,currentToolInput:A,currentServer:U,handleDeny:D,handleAllow:O,handleAlwaysAllow:T})]})}function T(e){let{data:t}=(0,a._C)(e.conversationUUID,{suppressError:!0}),n=(null==t?void 0:t.project_uuid)||"",{userHasHarmony:s,projectHasHarmony:r}=(0,y.Y)(n),[l,o]=(0,m.useState)(!!(s&&r)),d=(0,m.useCallback)(()=>o(!1),[]);return(0,i.jsx)(j.C,{projectUuid:n,onLoad:d,children:(0,i.jsx)(h.r,{children:(0,i.jsx)(D,{...e,isLoadingHarmony:l})})})}var F=n(40972);function R(e){var t;let{params:{uuid:n}}=e,d=(0,r.useSearchParams)(),u=null==d?void 0:d.get("q"),{data:c}=(0,a._C)(n);return(0,s.ZQ)(null!==(t=null==c?void 0:c.name)&&void 0!==t?t:""),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.M,{conversationUUID:n,children:(0,i.jsx)(l.d,{conversationUUID:n,children:(0,i.jsx)(T,{conversation:c,conversationUUID:n,chatInputDefaultMessage:null!=u?u:void 0})})}),(0,i.jsx)(F.U,{})]})}},40972:function(e,t,n){"use strict";n.d(t,{U:function(){return g}});var i=n(27573),a=n(3053),s=n(27218),r=n(27895),l=n(33209),o=n(83617),d=n(52939),u=n(77930),c=n(7653),m=n(45790),f=n(8905),v=n(54699);function g(){let[e,t]=(0,c.useState)(!1),n=(0,a.z$)(),{activeOrganization:g}=(0,s.t)(),{addError:p,addSuccess:_}=(0,r.e)(),x=(0,l.x2)(),h=(0,u.useQueryClient)(),{shouldShowModal:y,dismissReminder:j}=(0,v.$)(),k=(0,f.Ns)({onSuccess:async e=>{try{let t=await x;if(!t)throw Error("Stripe failed to initialize");let a=await t.handleNextAction({clientSecret:e.clientSecret});if(a.error)throw Error(a.error.message||"PAYMENT_VERIFICATION_FAILED");await h.invalidateQueries({queryKey:["check-3ds-required",null==g?void 0:g.uuid]}),_((0,i.jsx)(m.Z,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_success"})}catch(e){p(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,i.jsx)(m.Z,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,i.jsx)(m.Z,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),p((0,i.jsx)(m.Z,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),C=()=>{j()};return y?(0,i.jsx)(d.u_,{isOpen:y,onClose:C,modalSize:"md",autoCloseOnFocusOut:!0,hasCloseButton:!0,title:(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsx)(o.C,{color:"secondary",size:"lg",children:(0,i.jsx)(m.Z,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,i.jsx)(m.Z,{defaultMessage:"Verify your payment method by July 1",id:"veM3hVR5P1"})}),(0,i.jsx)("p",{className:"text-text-200 mb-6",children:(0,i.jsx)(m.Z,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,i.jsx)("p",{className:"text-text-200 mb-6",children:(0,i.jsx)(m.Z,{defaultMessage:"Without verification, your subscription access will be blocked after July 1, 2025.",id:"MmLorvC+0z"})}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,i.jsx)(d.mH,{onClick:()=>{t(!0),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_start"});let e=window.location.href;k.mutate({return_url:e})},loading:e,className:"w-full",children:(0,i.jsx)(m.Z,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,i.jsx)(d.mH,{variant:"secondary",onClick:C,className:"w-full",children:(0,i.jsx)(m.Z,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},54699:function(e,t,n){"use strict";n.d(t,{$:function(){return d}});var i=n(3053),a=n(27218),s=n(87033),r=n(7653),l=n(8905);let o="payment-verification-reminder-dismissed";function d(){let{activeOrganization:e}=(0,a.t)(),t=(0,i.z$)(),[n,d]=(0,r.useState)(!1),{value:u}=(0,s.FL)("show_3ds_modal"),{data:c}=(0,l.C_)(u);return(0,r.useEffect)(()=>{var n;let i=localStorage.getItem(o);if(i){let e=new Date(i).getTime();if(new Date().getTime()-e<864e5){d(!1);return}}let a=u&&null!==(n=null==c?void 0:c.requires_3ds_verification)&&void 0!==n&&n;d(a),a&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[u,c,t,e]),{shouldShowModal:n,dismissReminder:(0,r.useCallback)(()=>{let n=new Date().toISOString();localStorage.setItem(o,n),d(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:n})},[t,e])}}}},function(e){e.O(0,[703,7277,9906,2044,7611,4408,950,3279,6340,1270,8183,6947,3840,6971,7492,8425,4882,3097,2821,9002,9505,3387,9833,7715,3290,1274,6299,1919,9820,6488,2576,132,3055,6591,7023,8352,9148,3473,5123,7218,4060,3959,9163,9285,1817,2639,8222,6705,2210,2983,959,326,4555,2839,635,204,1060,1865,1293,1362,1426,1744],function(){return e(e.s=76905)}),_N_E=e.O()}]);