(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1865],{84927:function(e,t,s){"use strict";s.d(t,{H:function(){return i}});var n=s(27573),a=s(45790);function i(e){let t,{project:s,className:i}=e;if(s.is_starter_project)t=(0,n.jsx)(a.Z,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var l;t=(null===(l=s.creator)||void 0===l?void 0:l.full_name)?(0,n.jsx)(a.Z,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,n.jsx)(a.Z,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,n.jsx)("span",{className:i,children:t})}},80700:function(e,t,s){"use strict";s.d(t,{$:function(){return c}});var n=s(27573),a=s(70354),i=s(32737),l=s(85069),r=s(88755),o=s(40950);function c(e){let{children:t,disabledReason:s,...c}=e,d=(0,r.Q)(l.t6),u=(0,o.Z)(),f={defaultMessage:t.props.defaultMessage,id:t.props.id};if(!d)return(0,n.jsx)(i.u,{tooltipContent:s,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(a.z,{...c,children:t})})});let m=u.formatMessage(f);return(0,n.jsx)(i.u,{tooltipContent:null!=s?s:m,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(a.z,{...c,size:"icon_sm"})})})}},45014:function(e,t,s){"use strict";s.d(t,{K0:function(){return ev},$G:function(){return eb}});var n=s(41596),a=s(27573),i=s(19170),l=s(34555),r=s(1146),o=s(3053),c=s(8571),d=s(27218),u=s(27895),f=s(5984),m=s(9788),x=s(70354),h=s(45033),g=s(96346),p=s(49002),v=s(10607),j=s(7653);function y(){let e=(0,n._)(["\n  z-dropdown\n  bg-bg-100\n  border-0.5\n  border-border-300\n  backdrop-blur-xl\n  rounded-lg\n  min-w-[8rem]\n  overflow-hidden\n  p-1\n  text-text-200\n  shadow-element\n"]);return y=function(){return e},e}function b(e){var t;let{children:s,open:n,defaultButtonLabel:i,onClickDefaultButton:l,onOpenChange:r,...o}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(p.fC,{open:n,onOpenChange:r,children:[(0,a.jsxs)("div",{className:"flex border border-border-300 font-medium rounded-lg overflow-hidden",children:[(0,a.jsx)("button",{className:(0,v.Z)("py-1 px-2 border-r border-border-300 hover:bg-bg-200",n&&"bg-bg-200"),onClick:l,children:i}),(0,a.jsx)(p.xz,{asChild:!0,children:(0,a.jsx)("button",{className:"py-1 px-1 hover:bg-bg-200",children:(0,a.jsx)(g.p,{size:16})})})]}),(0,a.jsx)(p.Uv,{children:(0,a.jsx)(w,{sideOffset:null!==(t=o.sideOffset)&&void 0!==t?t:4,...o,children:s})})]})})}let w=(0,m.q)(p.VY)(y());var _=s(11607),N=s(52939),C=s(32737),M=s(17582),k=s(82083),S=s(1133),E=s(85069),z=s(87033),I=s(88755),Z=s(67667),T=s(74133),F=s(39405),R=s(85689),A=s(7778),L=s(23525),O=s(86518),D=s(80151),P=s(62168),U=s(10794),B=s(9599),H=s(90245),J=s(49454),W=s(13037),G=s(8927),q=s(68425),K=s(29860),V=s.n(K),Y=s(50294),X=s(88146),Q=s(45790),$=s(40950),ee=s(7160),et=s(95899),es=s(32559),en=s(47082),ea=s(70278),ei=s(65683),el=s(89827),er=s(43490);function eo(){let e=(0,n._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return eo=function(){return e},e}function ec(e){let t,{onClose:s,onSubmitRating:n,onSubmitNotes:i}=e,l=(0,$.Z)(),[r,o]=(0,j.useState)(!1),[c,d]=(0,j.useState)(""),u=e=>{n(e),o(!0)},m=()=>{s()};return t=r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("div",{className:"ml-1",children:(0,a.jsx)(Q.Z,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,a.jsx)("div",{className:"pt-1",children:(0,a.jsx)("button",{onClick:m,children:(0,a.jsx)(ei.X,{size:20})})})]}),(0,a.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(c),m()},children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"grow",children:(0,a.jsx)(f.oi,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:c,onChange:e=>d(e.target.value)})}),(0,a.jsx)("div",{children:(0,a.jsx)(x.z,{variant:"primary",type:"submit",children:(0,a.jsx)(Q.Z,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(Q.Z,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,a.jsx)(el.V,{size:20})}),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,a.jsx)(er.L,{size:20})}),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:m,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,a.jsx)(ei.X,{size:20})})]})]}),(0,a.jsxs)(ed,{children:[(0,a.jsx)("div",{className:"p-3",children:t}),(0,a.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,a.jsx)("a",{className:"hover:underline",href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,a.jsx)(Q.Z,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let ed=m.q.div(eo());var eu=s(98555),ef=s(56685);let em=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:n}=e,i=(0,j.useCallback)(()=>{n(!1)},[n]),{chatResourceState:{artifacts:l},dispatchChatResource:r}=(0,en.Y)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),c=(0,j.useRef)(t),d=(0,j.useRef)(!1),u=e=>{d.current=!0,i();let t=o[e];c.current=t,f(t)},f=(0,j.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUUID:e.versions[e.versions.length-1].uuid})})},[r]);(0,j.useEffect)(()=>{let e=c.current;return()=>{e&&!d.current&&(null==t?void 0:t.id)!==e.id&&f(e),d.current=!1}},[]);let m=(0,eu.i)(),h=(0,$.Z)();return o.length<2?null:(0,a.jsxs)(p.fC,{open:s,onOpenChange:e=>n(e),children:[(0,a.jsx)(p.xz,{asChild:!0,children:(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,a.jsx)(C.u,{side:"right",className:"ml-2",tooltipContent:s?"":h.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,a.jsx)(ef.b,{size:20})})})}),(0,a.jsx)(p.VY,{align:"start",asChild:!0,children:(0,a.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>c.current&&f(c.current),children:o.map((e,t)=>{var s;let n=e.type?m[e.type]:null,i=(null===(s=c.current)||void 0===s?void 0:s.id)===e.id,l=h.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),r=e.versions.length>1?"".concat(e.versions.length):"",o=e.versions.length>1&&n?" \xb7 ":"";return(0,a.jsx)(q.E.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,a.jsxs)(p.ck,{className:(0,v.Z)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",i?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>u(t),onMouseEnter:()=>{f(e)},"aria-label":"".concat(e.title).concat(n?", ".concat(n):"").concat(r?", ".concat(r," ").concat(l):""),children:[(0,a.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,a.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,a.jsxs)(a.Fragment,{children:[r," ",l]}):null,o?(0,a.jsx)(a.Fragment,{children:o}):null,n]})]},e.id)},e.id)})})})]})};async function ex(e){if(e.type!==k.JP.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return new Promise((s,n)=>{try{var a;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null===(a=l.contentWindow)||void 0===a?void 0:a.document);if(!r){document.body.removeChild(l),n(Error("Could not access iframe document"));return}let o=(null==e?void 0:e.title)||"Artifact";r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(o,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                * Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(t.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let c=document.title,d=()=>{try{document.title=c,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var t;document.title="".concat((null==e?void 0:e.title)||"Markdown Artifact"),null===(t=l.contentWindow)||void 0===t||t.print(),setTimeout(()=>{d(),s()},100)}catch(e){d(),n(e)}},l.onerror=e=>{d(),n(e)}}catch(e){n(e)}})}let eh=(e,t)=>{let[s,n]=(0,j.useState)(""),[a,i]=(0,j.useState)("");return(0,j.useEffect)(()=>{var s;let a=null!==(s=e.versions[t].resultState)&&void 0!==s?s:"",l=(0,k.VA)(e),r=new Blob([a],{type:"text/plain"}),o=URL.createObjectURL(r);return n(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:a}};function eg(){let e=(0,n._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return eg=function(){return e},e}function ep(){let e=(0,n._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return ep=function(){return e},e}let ev=e=>{var t,s,n,c,u,f,m,x,h,g;let{onClose:p,artifact:y,isStreaming:b,selectedArtifactMessageUUID:w,selectedArtifactVersionUUID:_,setSelectedArtifactVersionUUID:N,projectUuid:C,selectDoc:M,disablePublishing:S,sendMessage:E,richSandboxCapabilities:I,isOpen:T}=e,{account:F}=(0,d.t)(),R=(0,o.z$)(),[A,L]=(0,j.useState)("normal"),O=(0,j.useRef)(null),D=(0,d.Cf)(),[P,U]=(0,j.useState)(!0),{value:B}=(0,z.FL)("publish_artifacts"),{data:H}=(0,es.Yc)(C),J=!S&&B&&!D,[W,{open:K,close:V}]=(0,Z.q)(!1),Y=(0,j.useCallback)(()=>{U(!1)},[]),{data:X}=(0,ee.L1)({includeDeletedArtifacts:!0}),Q=b&&!(null==y?void 0:null===(t=y.versions[y.versions.length-1])||void 0===t?void 0:t.isClosed),$=(0,j.useMemo)(()=>{if(!y)return 0;if(!Q&&_&&w!==r.FC){let e=y.versions.findIndex(e=>e.uuid===_);if(-1!==e)return e}return!Q&&w&&w!==r.FC?y.versions.findIndex(e=>e.message===w):y.versions.length-1},[w,_,Q,y]),{value:et}=(0,z.FL)("apps_artifacts_sh"),ea=null==y?void 0:null===(s=y.versions[$])||void 0===s?void 0:s.uuid;(0,j.useEffect)(()=>{ea&&ea!==_&&N(ea),L("normal")},[null==y?void 0:y.id,ea,N,_]);let ei=et&&D,[el,{open:er,close:eo}]=(0,Z.q)(!1),ed=y&&(null==X?void 0:null===(n=X.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===y.id&&s===y.versions[$].message}))||void 0===n?void 0:n.published_artifact_uuid),eu=null!==(m=null==X?void 0:X.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ed&&s}))&&void 0!==m&&m,ef=null==y?void 0:null===(c=y.versions[$])||void 0===c?void 0:c.message,[em,ex]=(0,j.useState)(!1);(0,j.useEffect)(()=>ex(em||b),[em,b]);let[eh,eg]=(0,j.useState)(!1);(0,j.useEffect)(()=>eg(!1),[w,ef]);let[ep,ev]=(0,j.useState)(!1),{data:ey}=(0,ee.pf)(),{mutate:eb}=(0,i.Ck)(),{track:eN}=(0,o.z$)(),eC=null!==(x=(0,en.Y)().chatResourceState.conversationUUID)&&void 0!==x?x:"",{mutateAsync:eM}=(0,ee.Hd)(eC),ek=(0,j.useCallback)(async()=>{if(!_)try{var e;let{artifactVersionUUID:t}=await eM({version_index:$,artifact_identifier:null!==(e=null==y?void 0:y.id)&&void 0!==e?e:""});N(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}eN({event_key:"artifact.share_button_clicked",message_uuid:ef,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),er()},[_,er,eM,$,null==y?void 0:y.id,N,eN,ef,null==y?void 0:y.type,null==y?void 0:y.language]),eS=(0,j.useCallback)(()=>{eN({event_key:"artifact.publish_button_clicked",message_uuid:ef,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),K()},[K,eN,ef,null==y?void 0:y.type,null==y?void 0:y.language]),eE=(null==y?void 0:y.type)===k.JP.Text,ez=(null==y?void 0:y.type)===k.JP.Markdown||(null==y?void 0:y.type)===k.JP.Code,eI=(null==y?void 0:y.type)===k.JP.Html||(null==y?void 0:y.type)===k.JP.React,eZ=(null==y?void 0:y.type)!==k.JP.Text&&!(Q&&((null==y?void 0:y.type)===k.JP.Svg||(null==y?void 0:y.type)===k.JP.Mermaid||(null==y?void 0:y.type)===k.JP.React||(null==y?void 0:y.type)===k.JP.Html)),eT=!eZ||"raw"===A,eF=eh||em&&!b&&!ep&&!(null==F?void 0:F.settings.dismissed_artifact_feedback_form)&&ey,eR=null!==(h=null==y?void 0:y.versions.length)&&void 0!==h?h:0,[eA,eL]=(0,j.useState)(!1),eO=C&&y?{show:!Q&&!(null==H?void 0:H.is_starter_project),artifact:y,projectUuid:C,selectedVersion:$,selectDoc:M}:void 0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,v.Z)(y?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eA&&eL(!1),children:[(0,a.jsx)(ej,{versionCount:eR,selectedVersion:$,artifact:y,canRenderNormal:eZ,canOnlyRenderRaw:eE,canOnlyRenderNormal:ez,viewing:A,setViewing:L,showRaw:eT,canRefresh:eI,isSandboxLoading:P,handleRefresh:()=>{U(!0),O.current&&O.current.refresh()},canShare:ei,handleOpenShareModal:ek,isStreaming:b,onClose:p,hasMenuOpen:eA,setHasMenuOpen:eL,canPublish:J,wasUnpublished:eu,publishedArtifactUuid:ed,openPublishModal:eS,projectParams:eO,richSandboxRef:O,handleVersionSelect:e=>{let t=null==y?void 0:y.versions[e].uuid;t&&N(t)}}),(0,a.jsx)(l.B,{isOpen:T,content:null!==(g=null==y?void 0:null===(u=y.versions[$])||void 0===u?void 0:u.resultState)&&void 0!==g?g:"",type:null==y?void 0:y.type,citations:null==y?void 0:null===(f=y.versions[$])||void 0===f?void 0:f.citations,language:void 0===y?void 0:y.language||k.yc[y.type].syntaxName,showRaw:eT,richSandboxRef:O,isCurrentStreaming:Q,isChatStreaming:b,onSandboxConfirmation:Y,sendMessage:E,richSandboxCapabilities:I,isLatestVersion:!!y&&$===y.versions.length-1,artifactId:null==y?void 0:y.id,artifactVersion:$,onArtifactRuntimeError:e=>{R.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==_?void 0:_.toString(),error_type:e.type,source:null==y?void 0:y.versions[$].source})},artifact:y,hasMenuOpen:eA}),(0,a.jsx)(G.M,{children:eF&&(0,a.jsx)(q.E.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,a.jsx)("div",{children:(0,a.jsx)(ec,{onSubmitNotes:e=>{eN({event_key:"artifact.feedback.note",note:e,message_uuid:ef,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),eg(!1)},onSubmitRating:e=>{eN({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:ef,artifact_type:null==y?void 0:y.type,artifact_language:null==y?void 0:y.language}),eb({...null==F?void 0:F.settings,dismissed_artifact_feedback_form:!0}),eg(!0)},onClose:()=>{ev(!0),eb({...null==F?void 0:F.settings,dismissed_artifact_feedback_form:!0}),eg(!1)}})})})})]}),(null==y?void 0:y.versions[$])&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e_,{messageUuid:y.versions[$].message,isOpen:W&&!eu,onClose:V,artifact:y,selectedVersion:$,publishedArtifactUuid:ed,richSandboxRef:O}),ei&&_&&(0,a.jsx)(ew,{isOpen:el,onClose:eo,artifactVersionUuid:_,artifact:y,messageUuid:y.versions[$].message,isProjectArtifact:!!(null==H?void 0:H.is_private)})]})]})};function ej(e){var t;let{versionCount:s,selectedVersion:n,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:c,setViewing:d,showRaw:m,canRefresh:p,isSandboxLoading:y,handleRefresh:w,canShare:N,handleOpenShareModal:S,isStreaming:z,canPublish:Z,wasUnpublished:P,publishedArtifactUuid:U,projectParams:B,onClose:H,openPublishModal:J,handleVersionSelect:W,hasMenuOpen:G,setHasMenuOpen:q,richSandboxRef:K}=e,Y=(0,$.Z)(),X=(0,I.Q)(E.t6),{copyToClipboard:ee,didCopy:es}=(0,M.m)(),{copyToProject:en,isCopiedToProject:ei}=function(e){let{projectUuid:t,artifact:s,selectedVersion:n}=e,[i,l]=(0,j.useState)(!1),{mutateAsync:r,data:o}=(0,et.u3)(null!=t?t:""),{addError:c}=(0,u.e)();return(0,j.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(k.yc[s.type].extension()),content:null!==(e=s.versions[n].resultState)&&void 0!==e?e:""})}catch(e){c((0,a.jsx)(Q.Z,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}))}},isCopiedToProject:i}}({artifact:i,projectUuid:null!==(t=null==B?void 0:B.projectUuid)&&void 0!==t?t:"",selectedVersion:n});async function el(){var e,t;if(!i)return;let s=i.type===k.JP.Markdown,a=i.type===k.JP.React,l=null!==(e=i.versions[n].resultState)&&void 0!==e?e:"";if(a&&K.current){let e=await (null===(t=K.current)||void 0===t?void 0:t.copyHtmlContent());e?await ee({text:e,html:e}):await ee(l)}else if(s)try{let e=(0,ea.c)(l);await ee({text:l,html:e})}catch(e){await ee(l)}else await ee(l)}let{ref:er,width:eo}=function(){let e=(0,j.useRef)(null),[t,s]=(0,j.useState)(()=>{var t,s;return null!==(s=null===(t=e.current)||void 0===t?void 0:t.offsetWidth)&&void 0!==s?s:null});return(0,j.useEffect)(()=>{let t=V()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),n=new ResizeObserver(t);if(e.current){let s=e.current;return t(),n.observe(s),()=>n.disconnect()}},[]),{ref:e,width:t}}(),ec=eo&&eo<480,ed=!m&&p,{addError:eu}=(0,u.e)(),ef=(null==i?void 0:i.type)===k.JP.Markdown&&"raw"!==c?(0,a.jsx)(h.hP,{onSelect:async()=>{try{await ex(i)}catch(e){eu((0,a.jsx)(Q.Z,{defaultMessage:"Error saving as PDF",id:"kemaiSh7+2"}))}},children:(0,a.jsx)(Q.Z,{defaultMessage:"Save as PDF",id:"rv9NrWszM1"})},"saveAsPdf"):null,eh=i?(0,a.jsx)(h.hP,{asChild:!0,"data-testid":"export-download",children:(0,a.jsx)(ey,{artifact:i,selectedVersion:n})},"download"):null;return(0,a.jsxs)("div",{ref:er,className:(0,v.Z)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",X?[E.eM,E.Gg,"draggable"]:"py-2"),children:[i&&(0,a.jsx)(em,{currentArtifact:i,hasMenuOpen:G,setHasMenuOpen:q}),G?(0,a.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,a.jsx)(Q.Z,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!m&&ed&&y?(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,a.jsx)(_.Loading,{size:"sm"})}):null]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center flex-1 gap-2",children:[!(!l||r||o)&&(0,a.jsx)(f.sY,{options:[{key:"normal",label:(0,a.jsx)(L.b,{size:16}),ariaLabel:Y.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,a.jsx)(O.E,{size:16}),ariaLabel:Y.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===c?"normal":"code",onSelect:e=>{d("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===c?"normal":"code"),s>1?(0,a.jsx)(h.Lt,{align:"start",trigger:(0,a.jsxs)(x.z,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",n+1,ec||n!==s-1?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"∙"}),(0,a.jsx)(Q.Z,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,a.jsx)(g.p,{size:12,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,a.jsxs)(h.hP,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>W(e-1),children:[(0,a.jsx)(Q.Z,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,a.jsxs)(a.Fragment,{children:[" - ",(0,a.jsx)(Q.Z,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===n?(0,a.jsx)(R.J,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,a.jsxs)("div",{className:(0,v.Z)("flex gap-2 items-center text-sm"),children:[ec?(0,a.jsxs)(h.Lt,{align:"end",trigger:(0,a.jsx)(x.z,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger",children:(0,a.jsx)(A.F,{size:18,weight:"bold"})}),children:[ed&&(0,a.jsx)(h.hP,{disabled:y,onSelect:w,children:(0,a.jsx)(Q.Z,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),(0,a.jsx)(h.hP,{onSelect:el,children:(0,a.jsx)(Q.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),N?(0,a.jsx)(h.hP,{onSelect:S,children:(0,a.jsx)(Q.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,P?(0,a.jsx)(h.hP,{disabled:!0,onSelect:J,children:(0,a.jsx)(Q.Z,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):Z?(0,a.jsx)(h.hP,{onSelect:J,children:(0,a.jsx)(Q.Z,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,eh,ef]}):(()=>{let e=!m&&ed&&(y?(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,a.jsx)(_.Loading,{size:"sm"})}):(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:w,children:(0,a.jsx)(T._,{size:18})})),t=N&&(0,a.jsx)(x.z,{onClick:S,variant:"primary",size:"sm",disabled:z,prepend:(0,a.jsx)(F.D,{size:18,weight:"light"}),className:"font-medium !text-sm",children:(0,a.jsx)(Q.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),s=Z&&(0,a.jsx)(C.u,{open:!!P&&void 0,tooltipContent:(0,a.jsx)(Q.Z,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,a.jsx)(x.z,{onClick:J,variant:"primary",size:"sm",disabled:P||z,prepend:(0,a.jsx)(F.D,{size:16}),className:(0,v.Z)("font-medium !text-sm",P&&"!pointer-events-auto"),children:void 0===U||P?(0,a.jsx)(Q.Z,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,a.jsx)(Q.Z,{defaultMessage:"Published",id:"w7tf2zwi6+"})})}),n=(0,a.jsxs)(b,{align:"end",defaultButtonLabel:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:(0,v.Z)(es?"invisible":""),children:(0,a.jsx)(Q.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),es?(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(R.J,{size:18})}):null]}),onClickDefaultButton:el,children:[(null==B?void 0:B.show)?ei?(0,a.jsx)(h.hP,{disabled:!0,children:(0,a.jsx)(Q.Z,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,a.jsx)(h.hP,{onSelect:en,children:(0,a.jsx)(Q.Z,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,eh,ef]});return(0,a.jsxs)(a.Fragment,{children:[e,n,t,s]})})(),(0,a.jsx)(x.z,{variant:"ghost",size:"icon_sm",onClick:H,children:(0,a.jsx)(D.X,{size:18})})]})]})]})}function ey(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:n,filename:i}=eh(t,s),l=function(e){switch(e.type){case k.JP.Markdown:return"Markdown";case k.JP.Html:return"HTML";case k.JP.React:return"TSX";case k.JP.Svg:return"SVG";case k.JP.Text:return"TXT";case k.JP.Mermaid:return"Mermaid";case k.JP.Code:var t;return null!==(t=k.yc[e.type].extension(e))&&void 0!==t?t:null;default:return null}}(t);return(0,a.jsx)("a",{href:n,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000",children:l?(0,a.jsx)(Q.Z,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,a.jsx)(Q.Z,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}let eb=m.q.div(eg());m.q.div(ep());let ew=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:n,artifact:i,messageUuid:l,isProjectArtifact:r}=e,c=(0,$.Z)(),{track:d}=(0,o.z$)(),{mutateAsync:u,isPending:f}=(0,ee.Ky)(n),{data:m,isLoading:h}=(0,ee.Hn)(n),g=(null==m?void 0:m.visibility)==="shared",p=f||h,[v,y]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>y(""),5e3);return()=>clearTimeout(e)},[v]);let b="".concat(window.location.origin,"/artifacts/").concat(n),{copyToClipboard:w,didCopy:_}=(0,M.m)(),C=p?"loading":g?"shared":"private",k=(0,j.useRef)(C);k.current!==C&&("loading"!==k.current&&"private"===C&&y(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),k.current=C);let S=e=>{"private"===e&&g&&u({visibility:"private"}).then(()=>t()),"shared"!==e||g||u({visibility:"shared"}).then(()=>w(b))};return(0,a.jsx)(N.u_,{title:(0,a.jsx)("span",{className:"text-text-200 font-tiempos text-xl font-medium",children:g?(0,a.jsx)(Q.Z,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,a.jsx)(Q.Z,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:s,onClose:t,modalSize:"lg",hasCloseButton:!0,children:(0,a.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(H.T,{className:"mt-1",size:18})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Q.Z,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,a.jsx)("p",{className:"text-text-300 tracking-tight",children:r?(0,a.jsx)(Q.Z,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,a.jsx)(Q.Z,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(X.default,{className:"text-text-300 truncate text-sm",href:b,children:b}),(0,a.jsx)(x.z,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{w(b)},prepend:_?(0,a.jsx)(P.f,{size:16}):(0,a.jsx)(U.r,{size:16}),children:_?(0,a.jsx)(Q.Z,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(Q.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)(x.z,{size:"lg",variant:"secondary",loading:p,onClick:()=>S("private"),children:(0,a.jsx)(Q.Z,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}),!g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:r?(0,a.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,a.jsx)(J.k,{size:18,className:"mt-0.5 shrink-0"}),(0,a.jsx)(Q.Z,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,a.jsx)("p",{children:(0,a.jsx)(Q.Z,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,a.jsx)(W.H,{className:"mt-0.5",size:18}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Q.Z,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,a.jsx)("p",{className:"text-text tracking-tight-300",children:(0,a.jsx)(Q.Z,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(x.z,{size:"lg",loading:p,onClick:()=>{S("shared"),d({event_key:"artifact.share.modal.share_button_clicked",message_uuid:l,artifact_type:i.type,artifact_language:i.language})},children:(0,a.jsx)(Q.Z,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})]})})},e_=e=>{var t;let{onClose:s,isOpen:n,artifact:i,selectedVersion:l,messageUuid:r,publishedArtifactUuid:d,richSandboxRef:u}=e,f=(0,$.Z)(),{track:m}=(0,o.z$)(),{mutateAsync:h,isPending:g}=(0,ee.ZX)(),{publishedArtifactsBaseUrl:p}=(0,c.mX)(),[v,y]=(0,j.useState)(),b=!!d,{mutateAsync:w,isPending:_}=(0,ee.rC)(d),C=g||_,[k,S]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===k)return;let e=setTimeout(()=>S(""),5e3);return()=>clearTimeout(e)},[k]);let E="".concat(p,"/public/artifacts/").concat(d),{copyToClipboard:z,didCopy:I}=(0,M.m)(),Z=C?"loading":b?"shared":"private",T=(0,j.useRef)(Z),F=(0,j.useCallback)(async()=>{var e;let t=await (null===(e=u.current)||void 0===e?void 0:e.getScreenshot());t&&y(t)},[u]);(0,j.useEffect)(()=>{n&&u.current&&F()},[u,n,F]),T.current!==Z&&("loading"!==T.current&&"private"===Z&&S(f.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),T.current=Z);let R=e=>{if("private"===e&&b&&w({}).then(()=>s()),"shared"===e&&!b){var t;h({title:i.title,artifact_type:i.type,code_language:i.language,message_uuid:r,artifact_identifier:i.id,content:null!==(t=i.versions[l].resultState)&&void 0!==t?t:"",screenshot:v,artifact_version_uuid:i.versions[l].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return z("".concat(p,"/public/artifacts/").concat(t))})}};return(0,a.jsx)(N.u_,{title:(0,a.jsx)("span",{className:"text-text-200 font-tiempos text-xl font-medium",children:b?(0,a.jsx)(Q.Z,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}):(0,a.jsx)(Q.Z,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),isOpen:n,onClose:s,modalSize:"lg",hasCloseButton:!0,children:(0,a.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,a.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)("div",{children:(0,a.jsx)(H.T,{className:"mt-1",size:18})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h6",{className:"font-medium",children:(0,a.jsx)(Q.Z,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,a.jsx)("p",{className:"text-text-300 tracking-tight",children:(0,a.jsx)(Q.Z,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,a.jsx)(X.default,{className:"text-text-300 truncate text-sm",href:E,children:E}),(0,a.jsx)(x.z,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{z(E)},prepend:I?(0,a.jsx)(P.f,{size:16}):(0,a.jsx)(U.r,{size:16}),children:I?(0,a.jsx)(Q.Z,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,a.jsx)(Q.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(x.z,{size:"lg",variant:"secondary",loading:C,onClick:()=>R("private"),children:(0,a.jsx)(Q.Z,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,a.jsxs)("p",{className:"text-text-400 text-xs tracking-tight",children:[(0,a.jsx)(Q.Z,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,a.jsx)("br",{}),(0,a.jsx)(Q.Z,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]}),!b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,a.jsx)("p",{children:(0,a.jsx)(Q.Z,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet. Your chat will remain private.",id:"OMUnb5GMFX"})})}),(0,a.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[(0,a.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[v?(0,a.jsx)("img",{src:v,alt:i.title,className:"w-full h-auto bg-always-white"}):(0,a.jsx)(Y.default,{src:"/images/claude_ogimage.png",alt:i.title,className:"w-full h-auto",width:1138,height:640}),!v&&(0,a.jsx)(eC,{handleCapture:()=>void F()})]}),v&&(0,a.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,a.jsx)(eN,{handleRemove:()=>y(void 0)})})]}),(0,a.jsx)("div",{children:null!==(t=i.title)&&void 0!==t?t:(0,a.jsx)(Q.Z,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,a.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,a.jsx)(J.k,{size:18,className:"mt-0.5 shrink-0"}),(0,a.jsx)("span",{children:(0,a.jsx)(Q.Z,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Don’t share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,a.jsx)(X.default,{href:"https://www.anthropic.com/legal/aup",target:"_blank",className:"underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,a.jsx)(x.z,{size:"lg",loading:C,onClick:()=>{R("shared"),m({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:r,artifact_type:null==i?void 0:i.type,artifact_language:null==i?void 0:i.language})},children:(0,a.jsx)(Q.Z,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})]})})},eN=e=>{let{handleRemove:t}=e;return(0,a.jsx)(C.u,{tooltipContent:(0,a.jsx)(Q.Z,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,a.jsx)("button",{className:(0,v.Z)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,S.tq)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,a.jsx)(D.X,{size:12,weight:"bold"})})})},eC=e=>{let{handleCapture:t}=e;return(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,a.jsx)(C.u,{tooltipContent:(0,a.jsx)(Q.Z,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,a.jsx)(x.z,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,a.jsx)(B.V,{size:20})})})})}},50110:function(e,t,s){"use strict";var n,a;s.d(t,{G:function(){return n}}),(a=n||(n={})).Standard="Standard",a.TimelineGroup="TimelineGroup"},74550:function(e,t,s){"use strict";s.d(t,{c:function(){return d}});var n=s(27573),a=s(82274),i=s(2130),l=s(70354),r=s(47666),o=s(80151),c=s(7653);let d=e=>{let{attachment:t,goBack:s,onClose:d}=e,u=(0,c.useMemo)(()=>(0,i.G)(t),[t]);return(0,n.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,n.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,n.jsx)(l.z,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,n.jsx)(r.X,{size:20})}),(0,n.jsx)("h2",{className:"font-styrene-display flex-1 truncate text-lg font-medium",children:u.title}),(0,n.jsx)(l.z,{variant:"ghost",size:"icon",className:"-mr-2",onClick:d,"data-testid":"close-file-preview",children:(0,n.jsx)(o.X,{size:20})})]}),(0,n.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,n.jsx)(a.R,{metaData:u.metaData}),(0,n.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},5492:function(e,t,s){"use strict";s.d(t,{g:function(){return X}});var n=s(27573),a=s(39527),i=s(80727),l=s(35898),r=s(10607),o=s(7653),c=s(80204),d=s(28803),u=s(70354),f=s(85069),m=s(88755),x=s(38459),h=s(88146),g=s(45790),p=s(51866),v=s(37607),j=s(3053),y=s(32737),b=s(36667),w=s(39405),_=s(40950),N=s(80700),C=s(47082),M=s(48894),k=s(79285),S=s(27218),E=s(27895),z=s(45033),I=s(11607),Z=s(52939),T=s(17582),F=s(16963),R=s(11510),A=s(62168),L=s(10794),O=s(425),D=s(7533),P=s(22027),U=s(40845),B=s(11852),H=s(32559);function J(e){let{conversationUUID:t,snapshot:s,closeShareModal:a,showShareModal:i,disabled:l,disabledReason:r}=e,c=(0,_.Z)(),f=!!s,{addError:m}=(0,E.e)(),{account:x,activeOrganization:h}=(0,S.t)(),p=(0,S.Cf)(),v=(0,d.cE)(t),y=null==v?void 0:v.project_uuid,{data:b}=(0,H.Yc)(y),w=(null==s?void 0:s.uuid)?W(s.uuid):"",{copyToClipboard:N,didCopy:C}=(0,T.m)(),{mutateAsync:M,isPending:z}=(0,d.PD)(t),{mutate:O,isPending:D}=(0,d.Ls)(t,null==s?void 0:s.uuid),P=(0,o.useCallback)(async()=>{try{await M({project_uuid:null==v?void 0:v.project_uuid})}catch(e){m(c.formatMessage({defaultMessage:"Something went wrong while sharing this conversation. Please refresh the page.",id:"bMqfGRVujK"}))}},[M,m,null==v?void 0:v.project_uuid,c]),{track:U}=(0,j.z$)(),B=(0,o.useCallback)(()=>{f?(U({event_key:"chat.share.modal.unshare_button.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),O()):(U({event_key:"chat.share.modal.share_button.clicked",conversation_uuid:t}),P())},[f,O,P,U,t,null==s?void 0:s.uuid]);return(0,n.jsx)(Z.u_,{title:(0,n.jsx)("div",{className:"text-text-200 font-copernicus text-xl font-medium tracking-tight",children:f?c.formatMessage({defaultMessage:"Chat shared",id:"svB/EMJSZy"}):c.formatMessage({defaultMessage:"Share chat",id:"bXa+lJhlYV"})}),isOpen:i,onClose:a,modalSize:"lg",hasCloseButton:!0,children:x?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("div",{children:(0,n.jsx)(K,{upToDate:null==s?void 0:s.up_to_date,upsertSnapshot:P,isShared:!!f,disabled:l,disabledReason:r,isRaven:p})}),(0,n.jsx)(G,{isShared:f,project:b,orgName:null==h?void 0:h.name,toggleShare:B,isRaven:p}),f&&(0,n.jsxs)("button",{className:"w-full flex items-center justify-between bg-inherit h-auto text-text-300 border border-border-300 rounded-md px-3 py-2 cursor-pointer hover:bg-bg-300/50",onClick:()=>{U({event_key:"chat.share.open_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),window.open(W((null==s?void 0:s.uuid)||""),"_blank")},children:[(0,n.jsx)("span",{className:"truncate",children:W((null==s?void 0:s.uuid)||"")}),(0,n.jsx)(F.G,{size:16})]}),!p&&(0,n.jsxs)("div",{className:"flex flex-row gap-1.5 rounded-lg bg-bg-400 p-2 text-text-300 text-xs",children:[(0,n.jsx)(R.k,{size:16,className:"shrink-0"}),(0,n.jsx)("div",{children:(0,n.jsx)(g.Z,{defaultMessage:"Don’t share personal information or third-party content without permission, and see our <usagePolicyLink>Usage Policy</usagePolicyLink>.",id:"RkAGrm1doc",values:{usagePolicyLink:e=>(0,n.jsx)(k.LegalLink,{type:"aup",className:"hover:text-text-100 underline",children:e})}})})]}),(0,n.jsx)("div",{className:"mt-2 flex w-full items-center gap-2",children:f?(0,n.jsx)(u.z,{size:"lg",variant:C?"outline":"primary",onClick:()=>{U({event_key:"chat.share.copy_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),N(w)},prepend:C?(0,n.jsx)(A.f,{size:16}):(0,n.jsx)(L.r,{size:16}),children:C?(0,n.jsx)(g.Z,{defaultMessage:"Copied",id:"p556q3uvbn"}):(0,n.jsx)(g.Z,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}):(0,n.jsx)(u.z,{size:"lg",loading:z||D,onClick:B,children:(0,n.jsx)(g.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})]}):(0,n.jsx)("div",{className:"mb-4 mt-8 flex h-full w-full items-center justify-center",children:(0,n.jsx)(I.Loading,{})})})}let W=e=>new URL("/share/".concat(e),window.location.origin).toString();function G(e){let{isShared:t,orgName:s,project:a,toggleShare:i,isRaven:l}=e,o=(0,n.jsxs)("button",{className:(0,r.Z)("border-border-300 relative flex flex-row items-center justify-between gap-2 w-full rounded-xl border text-left !py-2 !px-3",t?"!bg-bg-000 text-text-000 cursor-pointer":"text-text-300 cursor-default"),children:[(0,n.jsx)(q,{state:t?"shared":"private",orgName:s,project:a,isRaven:l}),t&&(0,n.jsx)(x.p,{size:14,className:"right-3.5 top-3.5 text-text-000"})]});return t?(0,n.jsxs)(z.Lt,{align:"start",trigger:o,children:[(0,n.jsx)(z.hP,{onSelect:i,className:"!gap-0",children:(0,n.jsx)(q,{state:"private",isCurrentState:!t,orgName:s,project:a,isRaven:l})}),(0,n.jsx)(z.hP,{onSelect:i,className:"!gap-0",children:(0,n.jsx)(q,{state:"shared",isCurrentState:t,orgName:s,project:a,isRaven:l})})]}):(0,n.jsx)("div",{children:o})}function q(e){let{state:t,isCurrentState:s,orgName:a,project:i,isRaven:l}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{className:"inline-flex flex-row items-center justify-between gap-3 max-w-full overflow-hidden",children:[(0,n.jsxs)("span",{className:"inline-flex flex-row items-center gap-1.5 max-w-full",children:[(0,n.jsxs)("span",{className:"text-text-300 shrink-0",children:["private"===t&&(0,n.jsx)(O.H,{size:18}),"shared"===t&&l&&(0,n.jsx)(D.$,{size:18}),"shared"===t&&!l&&(0,n.jsx)(P.T,{size:18})]}),(0,n.jsxs)("p",{className:(0,r.Z)("text-ellipsis overflow-hidden",s&&"font-medium text-text-000"),children:["private"===t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{defaultMessage:"Private (only you have access)",id:"EsW/fizDS4"}),"\xa0",s&&"private"!==t&&(0,n.jsx)("span",{className:"text-text-300 text-sm font-normal",children:(0,n.jsx)(g.Z,{defaultMessage:"(Unshare this chat)",id:"EZEp1AdoRv"})})]}),"shared"===t&&l&&(0,n.jsx)(g.Z,{defaultMessage:"Shared (anyone in {scope} can view)",id:"mG1NQd3Jzv",values:{scope:(null==i?void 0:i.is_private)?i.name:a}}),"shared"===t&&!l&&(0,n.jsx)(g.Z,{defaultMessage:"Public (anyone on the web can view)",id:"no0TFMuRD0"})]})]}),s&&(0,n.jsx)(B.J,{size:16,weight:"bold",className:"text-accent-secondary-100 shrink-0"})]})})}function K(e){let{upToDate:t,isShared:s,upsertSnapshot:a,disabled:i,disabledReason:l="",isRaven:r}=e;return(0,n.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,n.jsx)("div",{className:"text-text-300 flex flex-row items-center gap-1 text-sm",children:s?(0,n.jsx)(n.Fragment,{children:r&&(t?(0,n.jsx)(g.Z,{defaultMessage:"Future messages aren’t included",id:"YiRN6e1JBr"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{defaultMessage:"New messages since last shared",id:"RnySEeXsUF"}),(0,n.jsx)(y.u,{tooltipContent:i?l:(0,n.jsx)(g.Z,{defaultMessage:"Share the most recent chat content",id:"oAf7Y+LN9j"}),children:(0,n.jsx)(u.z,{variant:"underline",size:"unset",className:"ml-1 gap-1",onClick:a,prepend:(0,n.jsx)(U.t,{}),disabled:i,children:(0,n.jsx)(g.Z,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})]}))}):(0,n.jsx)(g.Z,{defaultMessage:"Only messages up until now will be shared",id:"OUOkOQvr8p"})})})}function V(e){let{controlsSidebarIsOpen:t,closeControlsSidebar:s,openControlsSidebar:a,conversationUUID:i,isStreaming:l}=e,c=(0,_.Z)(),x=(0,m.Q)(f.t6),h=function(e){let{track:t}=(0,j.z$)(),{data:s}=(0,d.Cy)(e.conversationUUID),[n,a]=(0,o.useState)(!1),i=(0,o.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUUID}),a(!0)},[t,e.conversationUUID]),l=!!(null==s?void 0:s.snapshot),r=l||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),c=e.isStreaming||!l&&!(null==s?void 0:s.shareable);return{conversationUUID:e.conversationUUID,showShareModal:n,openShareModal:i,closeShareModal:()=>a(!1),isShared:l,showShareFlow:r,disabled:c,...s}}({conversationUUID:i,isStreaming:l}),{chatResourceState:{artifacts:p,selectedItem:v},dispatchChatResource:k}=(0,C.Y)(),{setIsDrawerExpanded:S}=(0,M.b)(),E=!!a&&!!s&&!t;return(0,n.jsxs)("div",{className:(0,r.Z)("flex items-center gap-1","transition-opacity duration-300",t?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!E&&"hidden"),children:[h.showShareFlow&&(0,n.jsx)(N.$,{variant:"ghost",className:"font-medium text-sm !text-text-100",onClick:h.openShareModal,disabled:h.disabled||!E,prepend:(0,n.jsx)(w.D,{size:18,weight:"light"}),disabledReason:h.disabled_reason,children:(0,n.jsx)(g.Z,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),p&&Object.values(p).length>0?(0,n.jsx)(y.u,{tooltipContent:c.formatMessage({defaultMessage:"Open artifacts",id:"qsF1KKbjFR"}),delayDuration:500,side:"bottom",children:(0,n.jsx)(u.z,{variant:"ghost",size:x?"icon_sm":"icon",onClick:()=>{if(p){if(v&&(null==v?void 0:v.type)==="artifact")S(!0);else{let e=Object.values(p).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()})[0],t=e.versions[e.versions.length-1].uuid;k({type:"SELECT_ARTIFACT",id:e.id,versionUUID:t}),setTimeout(()=>{S(!0)},50)}}},disabled:!E,children:(0,n.jsx)(b.G3,{size:18})})}):null,x&&(0,n.jsx)(N.$,{href:"/new",prepend:(0,n.jsx)(b.yc,{size:16}),variant:"flat",disabled:!E,className:"ml-1",children:(0,n.jsx)(g.Z,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),h.showShareFlow&&(0,n.jsx)(J,{...h})]})}let Y=(0,o.memo)(function(e){let{conversationUUID:t,name:s,isInteractive:a=!0,sharedBy:i,project:l,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:j,isStreaming:y,isSharedChat:b}=e,{data:w}=(0,d._C)(t,{enabled:!b}),_=!!l&&!l.is_harmony_project,N=(0,m.Q)(f.t6);return(0,n.jsxs)(v.PageHeader,{className:(0,r.Z)("h-12",!N&&"-mb-6"),contentClassName:"gap-6 pr-2",sticky:!0,children:[(0,n.jsxs)("div",{className:"flex min-w-0 flex-1 shrink flex-col md:flex-row md:items-center",children:[_&&(0,n.jsx)(h.default,{href:"/project/".concat(l.uuid),className:"text-sm text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 max-md:text-xs tracking-tight",children:(0,n.jsxs)("div",{className:"truncate",children:[l.name," ",(0,n.jsx)("span",{className:"opacity-50",children:"/"})]})}),(0,n.jsx)("div",{className:"flex min-w-0 shrink-1 items-center max-md:text-sm",children:a&&w?(0,n.jsx)(p.p,{conversation:w,initialName:s,trigger:(0,n.jsx)(u.z,{variant:"ghost",size:"default",className:"!text-text-000 !shrink gap-1 !px-1 !py-0 !scale-100 !h-7",append:(0,n.jsx)(x.p,{size:12,weight:"bold"}),"data-testid":"chat-menu-trigger",children:(0,n.jsx)("div",{className:"min-w-0 flex-1",children:(0,n.jsx)("div",{className:"truncate tracking-tight font-normal font-styrene",children:s.length>0?s:(0,n.jsx)(g.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}):(0,n.jsx)("div",{className:"truncate tracking-tight font-normal font-styrene text-sm",children:s.length>0?s:(0,n.jsx)(g.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,n.jsxs)("div",{className:"right-3 flex gap-2",children:[i&&(0,n.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 text-sm",children:(0,n.jsx)(g.Z,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!b&&(0,n.jsx)(V,{conversationUUID:t,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:j,isStreaming:y})]})]})});function X(e){let{headerProps:t,mainElement:s,drawerElement:d,auxilaryElement:u,isDrawerOpen:f,autoscrollRef:m,autoscrollDisabled:x}=e,[h,g]=(0,o.useState)(!1),p=(0,o.useRef)(null),v=(0,o.useRef)(null),j=(0,o.useRef)(null),y=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:b}=(0,M.b)(),w=(0,i.Z)("md");(0,o.useEffect)(function(){let e=!0;if(!v.current||!p.current||!_.current||!j.current)return;let t=p.current,s=v.current,n=j.current;if(w){let e=f?window.innerWidth/2-c.u:s.getBoundingClientRect().width;n.style.width="".concat(e,"px")}let a=Date.now(),i=f?0:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return f&&(requestAnimationFrame(function i(){if(!e)return;let l=(Date.now()-a)/220,r=50*l;if(l>=1||!w){t.style.flex=String(50),s.style.flex=String(50),n.style.width="auto";return}t.style.flex=String(100-r),s.style.flex=String(r),requestAnimationFrame(i)}),y.current.interacted=!0),!f&&y.current.interacted&&requestAnimationFrame(function l(){if(!e)return;let r=(Date.now()-a)/220,o=i-r*i;if(r>=1||!w){t.style.flex=String(100),s.style.flex=String(0),n.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(l)}),()=>{e=!1}},[f]);let[_,N]=(0,l.y)();return(0,o.useEffect)(()=>{if(!v.current||!p.current||!_.current)return;let e=_.current.getBoundingClientRect(),t=p.current.getBoundingClientRect();if(window.innerWidth<768||t.width>420)return;let s=420/e.width*100;p.current.style.flex=String(s),v.current.style.flex=String(100-s)},[N.width,N.height,_]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,r.Z)("flex flex-1 h-screen w-full overflow-hidden relative",h&&"select-none"),ref:_,onMouseUp:function(){g(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{if(!h||!v.current||!p.current||!_.current)return;let t=_.current.getBoundingClientRect(),s=p.current.getBoundingClientRect(),n=Math.min(Math.max(e.clientX-s.left,420),t.width-240)/t.width*100;p.current.style.flex=String(n),v.current.style.flex=String(100-n)},children:[(0,n.jsxs)("div",{ref:p,className:"h-screen flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,n.jsx)(Y,{...t}),(0,n.jsx)(a.l,{ref:m,disabled:x,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,n.jsxs)("div",{className:(0,r.Z)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!f&&"hidden"),onMouseDown:function(){g(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,n.jsx)("div",{className:(0,r.Z)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",h&&"!bg-accent-secondary-000")}),(0,n.jsx)("div",{className:(0,r.Z)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",h&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,n.jsx)("div",{ref:v,className:(0,r.Z)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",f?"max-md:flex-1":"max-md:hidden",h&&"pointer-events-none"),style:{flex:"0 0"},children:(0,n.jsxs)("div",{ref:j,className:"flex flex-col h-full overflow-hidden",children:[(0,n.jsx)("div",{className:"h-12 md:hidden bg-bg-500 bg-opacity-60",onClick:()=>{b(!1)}}),(0,n.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:d})]})})]}),null!=u?u:null]})}},99281:function(e,t,s){"use strict";s.d(t,{J:function(){return tm},U:function(){return tx}});var n=s(41596),a=s(27573),i=s(7653),l=s(87757),r=s(84571);r.Z.blockRegex;let o=r.Z.defaultRules,c=r.Z.parserFor;r.Z.defaultBlockParse;let d=r.Z.outputFor,u=e=>d(e,"react");var f=s(61995);let m={fence:{...o.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,a.jsx)(f.M.code,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...o.blockQuote,react:(e,t,s)=>(0,a.jsx)(f.M.blockQuote,{children:t(e.content,s)})},list:{...o.list,react:(e,t,s)=>{let n=e.ordered?f.M.ol:f.M.ul;return(0,a.jsx)(n,{children:e.items.map((e,n)=>(0,a.jsx)(f.M.li,{children:t(e,s)},n))},s.key)}},newline:o.newline,paragraph:{...o.paragraph,react:(e,t,s)=>(0,a.jsx)(f.M.p,{children:t(e.content,s)},s.key)},u:o.u,del:o.del,inlineCode:{...o.inlineCode,react:e=>{let t=e.content;if(t&&l.Oy.test(t)){var s;if((null===(s=t.match(l.Oy))||void 0===s?void 0:s[0])===t)return(0,a.jsxs)(f.M.code,{inline:!0,children:[(0,a.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,a.jsx)(l.ZQ,{color:t})}),t]})}return(0,a.jsx)(f.M.code,{inline:!0,children:t})}},text:{...o.text,react:e=>(0,l.TB)(e.content)},url:o.url,link:{...o.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,a.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}},em:o.em,strong:o.strong},x=(e,t)=>c(t)(e,{inline:!1}),h=(0,i.memo)(e=>{let{text:t}=e,s=x(t,m);return u(m)(s)});h.displayName="AnthropicMarkDown";var g=s(16282),p=s(18916),v=s(9788),j=s(70354),y=s(87033),b=s(30070),w=s(33995),_=s(11510),N=s(40950),C=s(45790),M=s(2717);function k(){let e=(0,n._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return k=function(){return e},e}function S(){let e=(0,n._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return S=function(){return e},e}function E(){let e=(0,n._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return E=function(){return e},e}function z(){let e=(0,n._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return z=function(){return e},e}let I=v.q.div(k()),Z=(0,v.q)(I)(S()),T=(0,v.q)(I)(E()),F=(0,v.q)(I)(z()),R=(0,i.memo)(function(e){let{message:t,messageWarningPropsFromParent:s,hasLink:n,hasCode:l,hasDriveDocWithImages:r,onRetry:o,onSendContinue:c,conversationSettings:d,isLastMessage:u}=e,f=(0,N.Z)(),{value:m}=(0,p.h)(null!=d?d:{}),x=null==d?void 0:d.enabled_web_search,{value:h}=(0,y.FL)("claudeai_web_search"),g=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,a.jsx)("a",{...s,className:"underline"})}}),[]);if((null==s?void 0:s.style)==="prominent")return(0,a.jsxs)(T,{"data-testid":"message-warning",children:[(0,a.jsx)(b.v,{className:"shrink-0",size:16}),(0,a.jsx)(M.D,{components:g,children:s.contentMarkdown})]});let v="human"===t.sender;if(!v&&"error"===t.stop_reason&&o)return(0,a.jsxs)(F,{"data-testid":"message-warning",onClick:()=>o(t.parent_message_uuid),children:[(0,a.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,a.jsx)(b.v,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,a.jsx)(w.y,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,a.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,a.jsx)(C.Z,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!v&&u&&"max_tokens"===t.stop_reason&&c)return(0,a.jsx)(Z,{"data-testid":"message-warning",children:(0,a.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.k,{className:"shrink-0",size:16}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(C.Z,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,a.jsx)("div",{className:"ml-6",children:(0,a.jsx)(j.z,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==c?void 0:c(),"aria-label":f.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,a.jsx)(C.Z,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});let k=[];return(v?(n&&!x&&(h?k.push(f.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search to get up to date info from web links.",id:"fPI2JySdII"})):k.push(f.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"}))),r&&k.push(f.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(n&&!x&&(h?k.push(f.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search for up to date and accurate links.",id:"sN35Yf2Rzl"})):k.push(f.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"}))),l&&!m&&k.push(f.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),t.stop_reason,"conversation_length_limit"===t.stop_reason&&k.push(f.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),s&&k.push(s.contentMarkdown)),0===k.length)?null:(0,a.jsxs)(Z,{"data-testid":"message-warning",children:[(0,a.jsx)(_.k,{className:"shrink-0",size:16}),(0,a.jsx)(M.D,{components:g,children:k.reverse().join(" ")})]})});var A=s(2210),L=s(405),O=s(27218),D=s(835),P=s(5984),U=s(82083),B=s(96707),H=s(10228),J=s(53462),W=s(58183),G=s(10607),q=s(68425),K=s(2949),V=s(84575),Y=s(76220),X=s(1812),Q=s(17582),$=s(98731),ee=s(19984),et=s(91588),es=s(37141),en=s(8927),ea=s(41270),ei=s(59016),el=s(85465),er=s(22639),eo=s(5362);let ec=(e,t)=>{let{activeOrganization:s}=(0,O.t)(),n=null==s?void 0:s.uuid;return(0,eo.uC)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")};var ed=s(20147),eu=s(71817),ef=s(45033),em=s(11607),ex=s(52939),eh=s(77003),eg=s(41668),ep=s(49034);function ev(e){let{isOpen:t,onClose:s,conversationUUID:n,messageUUID:i,text:l}=e;return(0,a.jsx)(ex.u_,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,children:(0,a.jsx)(ej,{conversationUUID:n,messageUUID:i,text:l})})}function ej(e){let{conversationUUID:t,messageUUID:s,text:n}=e,{data:l,isPending:r,mutateAsync:o}=ec(t,s),{model:c}=(0,er.r)(),d=(0,el.gE)("paprika_mode"),u=(0,X.T)(),f=(0,ep.z)(u||{}),{codeStyle:m}=(0,ed.o)(),x=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let n=JSON.parse(s);e.logs.api_usage[t]=n}catch(e){}return e}(l),null,2):"",h=(0,eu.wN)(t);(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:c||h,tools:f(),personalized_styles:[],paprika_mode:d})})()},[o,c,f,d,h]);let{didCopy:g,copyToClipboard:p}=(0,Q.m)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(ex.dm,{layout:"left",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("h2",{className:"font-styrene-display text-accent-pro-000 text-xl font-medium",children:[(0,a.jsx)(C.Z,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),"\xa0",(0,a.jsx)("span",{className:"ml-1 text-sm font-medium text-danger-000",children:(0,a.jsx)(C.Z,{defaultMessage:"FOR INTERNAL USE ONLY",id:"ISVSjyq5f9"})})]})}),(0,a.jsxs)(j.z,{variant:"ghost",onClick:()=>{p(x)},disabled:r,children:[(0,a.jsx)(Q.f,{didCopy:g,size:16,className:"mr-2"}),(0,a.jsx)(C.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})]}),(0,a.jsx)(ey,{text:n})]}),r?(0,a.jsx)("div",{className:"my-2 flex h-full w-full items-center justify-center",children:(0,a.jsx)(em.Loading,{})}):(0,a.jsx)(eg.Z,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:m,children:x})]})}let ey=e=>{let{text:t}=e,{copyToClipboard:s}=(0,Q.m)();return(0,a.jsx)(ef.Lt,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,a.jsx)(j.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(eh.x,{size:20})}),children:(0,a.jsx)(ef.hP,{className:"text-md",onSelect:()=>{s(t)},children:(0,a.jsx)("div",{className:"flex items-center justify-between gap-1",children:(0,a.jsx)("div",{className:"flex grow items-center",children:(0,a.jsx)(C.Z,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})})})})})};var eb=s(35707),ew=s(77056),e_=s(5751);function eN(e){var t,s;let{conversationUuid:n,message:l}=e,[r,o]=(0,i.useState)(void 0),[c,d]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o("flag"):"upvote"!==r&&o("upvote"),d(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote"),children:(0,a.jsx)(eb.V,{size:16,weight:(null===(t=l.chat_feedback)||void 0===t?void 0:t.type.includes("upvote"))?"fill":"regular"})}),(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag"),children:(0,a.jsx)(ew.L,{size:16,weight:(null===(s=l.chat_feedback)||void 0===s?void 0:s.type.includes("flag"))?"fill":"regular"})}),(0,a.jsx)(e_.r,{conversationUuid:n,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:c,onClose:()=>d(!1)})]})}var eC=s(69321),eM=s(30131),ek=s(96346);function eS(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:n,parentMessageUUID:l,setPaprikaModeState:r}=e,[o,c]=(0,i.useState)(!1),d=(0,eM.dI)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{n(e,t),r(t)},[n,r]);return(0,a.jsxs)(ef.Lt,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:c,trigger:(0,a.jsxs)(j.z,{variant:"unstyled",size:"unset",className:"flex flex-row items-center gap-1 rounded-md p-2 py-1.5 text-sm transition-opacity delay-100 hover:bg-bg-300 select-none",children:[(0,a.jsx)(C.Z,{defaultMessage:"Retry",id:"62nsdyMyIO"}),(0,a.jsx)(ek.p,{size:12,className:"text-text-500 shrink-0"})]}),children:[(0,a.jsx)(ef.hP,{className:"text-sm",onClick:()=>n(l),children:(0,a.jsx)(C.Z,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),d.map(e=>(0,a.jsx)(ef.hP,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,a.jsx)(C.Z,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,a.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,a.jsx)(eC.d7,{id:e.description_key}):e.description})]})},e.id))]})}var eE=s(70278);let ez={default:{allowed:"never"}},eI=ea.z.record(ea.z.object({allowed:ea.z.enum(["never","first_turn","always"])}));function eZ(e){var t,s,n,l,r,o,c,d;let{message:u,conversationUUID:f,isStreaming:m,onRetry:x,isLastMessage:h,isLastHumanMessage:g=!1,isInteractive:p=!0,changeDisplayedConversationPath:v,editMessage:j,isFirstAssistantMessage:b,isResearchPending:w}=e,[_,N]=(0,i.useState)(!1),M=null!==(r=null===(t=(0,X.T)())||void 0===t?void 0:t.preview_feature_uses_artifacts)&&void 0!==r&&r,k="human"===u.sender,S="assistant"===u.sender,E=m&&h,{value:z}=(0,y.FL)("anthropic_internal_only_expose_chat_debug"),I=!m&&(null!==(o=u.nOptions)&&void 0!==o?o:0)>1&&v,Z=!m&&!w&&j&&u.parent_message_uuid&&p,T=null==u?void 0:null===(s=u.content)||void 0===s?void 0:s.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),F=!m&&!w&&p&&!T,R=(0,$.K)(u),{didCopy:A,copyToClipboard:L}=(0,Q.m)(),O=async()=>{let e=(M?(0,U.w0)(R):R).trim();try{let t=(0,eE.c)(e);await L({text:e,html:t})}catch(t){await L(e)}},D=(0,ei.hb)(),{toggleConversationSetting:P}=(0,el.M0)(),B=(0,el.gE)("paprika_mode"),{model:H}=(0,er.r)(),{allModelOptions:J}=(0,Y.uL)(),W=(0,y.xQ)("claude_ai_paprika_retry",ez,eI),G=null!==(d=null!==(c=H&&(null===(n=W[H])||void 0===n?void 0:n.allowed))&&void 0!==c?c:null===(l=W.default)||void 0===l?void 0:l.allowed)&&void 0!==d?d:"never";if(k&&!Z&&!I)return null;let q=J.find(e=>e.model===H),K=null==q?void 0:q.paprika_modes,et=K&&K.length>0&&!B&&("always"===G||"first_turn"===G&&b);return(0,a.jsx)(eT,{isStreaming:E,isLastMessage:h||g,isInteractive:p,isAssistant:S,children:(0,a.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[S&&z&&(0,a.jsx)(V.w,{Icon:ee.J,tooltipContent:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(C.Z,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),(0,a.jsx)("div",{className:"px-1 py-px -mr-0.5 text-xs bg-always-white/20 rounded",children:(0,a.jsx)(C.Z,{defaultMessage:"Internal",id:"2KtWqT5Nl+"})})]}),onClick:()=>N(!0),isAssistant:S}),S&&z&&(0,a.jsx)(ev,{isOpen:_,onClose:()=>N(!1),messageUUID:u.uuid,text:R,conversationUUID:f}),k&&Z&&(0,a.jsx)(V.w,{onClick:()=>j(u,"test edit message"),isAssistant:S,children:(0,a.jsx)(C.Z,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),S&&(0,a.jsx)(V.w,{tooltipContent:(0,a.jsx)(C.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),onClick:O,isAssistant:S,children:(0,a.jsx)("div",{children:(0,a.jsx)(Q.f,{size:16,"data-testid":"action-bar-copy",didCopy:A})})}),S&&!E&&!w&&p&&"error"!==u.stop_reason&&D&&(0,a.jsx)(eN,{conversationUuid:f,message:u}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5",children:[I&&(0,a.jsx)(eF,{message:u,changeDisplayedConversationPath:v,isAssistant:S}),S&&F&&(et?(0,a.jsx)(eS,{paprikaMode:B,supportedPaprikaModes:K,onRetry:x,parentMessageUUID:u.parent_message_uuid,setPaprikaModeState:e=>{P("paprika_mode",null!=e?e:null)}}):(0,a.jsx)(V.w,{onClick:()=>x(u.parent_message_uuid),isAssistant:S,children:(0,a.jsx)(C.Z,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})}let eT=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:n,isAssistant:i,children:l}=e;return(0,a.jsx)(en.M,{children:!t&&(0,a.jsx)(q.E.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,a.jsx)("div",{className:(0,G.Z)("rounded-lg transition min-w-max pointer-events-auto",!i&&"translate-y-4 bg-bg-300/90 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",i&&"translate-x-2",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})};function eF(e){var t;let{message:s,changeDisplayedConversationPath:n,isAssistant:i}=e,l=(null!==(t=s.selectedOption)&&void 0!==t?t:0)+1,r=l===s.nOptions;return(0,a.jsxs)("div",{className:"flex text-xs",children:[(0,a.jsx)(V.w,{className:(0,G.Z)("px-0.5 mr-1",1===l&&"opacity-50 pointer-events-none"),onClick:()=>n(s,-1),isAssistant:i,children:(0,a.jsx)(et.W,{})}),(0,a.jsx)("span",{className:"self-center shrink-0 select-none",children:(0,a.jsx)(C.Z,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:l,totalOptions:s.nOptions}})}),(0,a.jsx)(V.w,{className:(0,G.Z)("px-0.5 ml-1",r&&"opacity-50 pointer-events-none"),onClick:()=>n(s,1),isAssistant:i,children:(0,a.jsx)(es.T,{})})]})}var eR=s(3053),eA=s(32006),eL=s(54328);let eO=()=>{let e=(0,eR.z$)(),{initDriveAuth:t}=(0,K.nC)({});return(0,a.jsx)(eD,{title:(0,a.jsx)(C.Z,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,a.jsx)(eL.v,{size:18}),cta:(0,a.jsxs)(j.z,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,a.jsx)(eA.k6,{size:16,className:"mr-1"}),(0,a.jsx)(C.Z,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eD=e=>{let{title:t,icon:s,cta:n}=e;return(0,a.jsx)(q.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,a.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,a.jsx)("div",{className:"px-2.5 py-2.5",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,a.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),n]})})})})},eP=e=>{let{previousMessage:t}=e,s=(0,K.Aj)(),{isDriveAuthenticated:n}=(0,K.nC)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,y.FL)("pumpernickel_enabled");return r&&s&&!n&&l?(0,a.jsx)(eO,{}):null};var eU=s(48912);let eB=e=>{let{title:t,text:s}=e,n=(0,N.Z)();t=t||n.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,Q.m)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,eE.c)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,a.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-message",children:[(0,a.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,a.jsx)("span",{className:"flex-1",children:t}),(0,a.jsx)(j.z,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,a.jsx)(Q.f,{didCopy:i,size:16})})]}),(0,a.jsx)(eU.U,{className:"px-4 pt-2 pb-4",children:s})]})};var eH=s(89799),eJ=s(1146),eW=s(89269);let eG=e=>{let{size:t=32,className:s}=e;return(0,a.jsxs)("svg",{width:t,height:t,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:s,children:[(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0121 5.17898C14.6561 5.0615 15.3204 5 16 5C22.0751 5 27 9.92487 27 16C27 22.0751 22.0751 27 16 27C15.8588 27 15.7183 26.9973 15.5785 26.9921C15.0266 26.9713 14.5624 27.4019 14.5416 27.9538C14.5209 28.5057 14.9514 28.9699 15.5033 28.9907C15.6681 28.9969 15.8337 29 16 29C23.1797 29 29 23.1797 29 16C29 8.8203 23.1797 3 16 3C15.1995 3 14.4151 3.07246 13.6532 3.21144C13.1099 3.31055 12.7498 3.83134 12.8489 4.37466C12.948 4.91798 13.4688 5.27808 14.0121 5.17898ZM10.6328 5.5356C10.556 5.24904 10.396 4.99168 10.1729 4.79607C9.94988 4.60046 9.67384 4.47539 9.3797 4.43667C9.08557 4.39794 8.78656 4.44731 8.52048 4.57852C8.25441 4.70974 8.03321 4.91691 7.88488 5.17383C7.73654 5.43076 7.66772 5.7259 7.68713 6.02194C7.70653 6.31797 7.81328 6.60161 7.99389 6.83697C8.17449 7.07234 8.42083 7.24886 8.70176 7.34423C8.98268 7.43959 9.28558 7.4495 9.57214 7.37272C9.95641 7.26976 10.284 7.01836 10.483 6.67383C10.6819 6.3293 10.7358 5.91987 10.6328 5.5356ZM6.60273 8.85853C6.82578 9.05414 6.98581 9.3115 7.0626 9.59807C7.16556 9.98234 7.11166 10.3918 6.91274 10.7363C6.71383 11.0808 6.3862 11.3322 6.00194 11.4352C5.71537 11.512 5.41248 11.5021 5.13155 11.4067C4.85062 11.3113 4.60428 11.1348 4.42368 10.8994C4.24307 10.6641 4.13632 10.3804 4.11692 10.0844C4.09752 9.78836 4.16633 9.49322 4.31467 9.2363C4.46301 8.97937 4.6842 8.7722 4.95027 8.64099C5.21635 8.50977 5.51536 8.4604 5.8095 8.49913C6.10363 8.53785 6.37968 8.66293 6.60273 8.85853ZM4.86963 13.9817C5.09268 14.1773 5.25272 14.4346 5.3295 14.7212C5.43247 15.1055 5.37857 15.5149 5.17965 15.8594C4.98074 16.2039 4.65311 16.4553 4.26884 16.5583C3.98228 16.6351 3.67938 16.6252 3.39846 16.5298C3.11753 16.4344 2.87119 16.2579 2.69059 16.0226C2.50998 15.7872 2.40323 15.5036 2.38383 15.2075C2.36442 14.9115 2.43324 14.6163 2.58158 14.3594C2.72991 14.1025 2.95111 13.8953 3.21718 13.7641C3.48326 13.6329 3.78227 13.5835 4.07641 13.6223C4.37054 13.661 4.64658 13.786 4.86963 13.9817Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M15 9.00012V16.0001C15 16.2653 15.1054 16.5197 15.2929 16.7072C15.4804 16.8948 15.7348 17.0001 16 17.0001H23C23.2652 17.0001 23.5196 16.8948 23.7071 16.7072C23.8946 16.5197 24 16.2653 24 16.0001C24 15.7349 23.8946 15.4806 23.7071 15.293C23.5196 15.1055 23.2652 15.0001 23 15.0001H17V9.00012C17 8.73491 16.8946 8.48055 16.7071 8.29302C16.5196 8.10548 16.2652 8.00012 16 8.00012C15.7348 8.00012 15.4804 8.10548 15.2929 8.29302C15.1054 8.48055 15 8.73491 15 9.00012Z",fill:"currentColor"}),(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 21C8 20.4477 7.55228 20 7 20C6.44772 20 6 20.4477 6 21V24H3C2.44772 24 2 24.4477 2 25C2 25.5523 2.44772 26 3 26H6V29C6 29.5523 6.44772 30 7 30C7.55228 30 8 29.5523 8 29V26H11C11.5523 26 12 25.5523 12 25C12 24.4477 11.5523 24 11 24H8V21Z",fill:"currentColor"})]})};var eq=s(49148);let eK=["year","month","day","hour","minute","second","millisecond"],eV=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=eq.nL.fromDurationLike(t);return e.formatList(eK.filter(e=>0!==a["".concat(e,"s")]).map(t=>e.formatNumber(a["".concat(t,"s")],{...n,style:"unit",unit:t})),{...n,style:s})}((0,N.Z)(),t,s)};var eY=s(49454),eX=s(43290),eQ=s(88146),e$=s(50110),e0=s(30833),e1=s(65499);function e2(){let e=(0,n._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 text-xs mx-4 mb-4 font-styrene tracking-tight"]);return e2=function(){return e},e}function e5(e,t){if(!e)return;let s=(t?eX.ou.fromISO(t):eX.ou.now()).diff(eX.ou.fromISO(e),["hours","minutes","seconds"]);return 0>s.toMillis()?eX.nL.fromMillis(0):s}let e3=v.q.div(e2()),e4=()=>(0,a.jsxs)(e3,{"data-testid":"message-warning",children:[(0,a.jsx)(eY.k,{className:"shrink-0",size:16}),(0,a.jsx)(C.Z,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,a.jsx)(eQ.default,{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),e6=e=>{let{text:t,cutOff:s}=e,{value:n}=(0,y.FL)("use_in_house_latex_transformer");return(0,a.jsxs)("div",{className:"text-text-300 text-sm font-normal leading-[21px] gap-0.5 relative font-tiempos",children:[(0,a.jsx)(A.ux,{className:"p-3 pt-0 pr-8",text:t,useInHouseLatexPlugin:n}),!0!==s?null:(0,a.jsx)(e4,{})]})},e7=e=>{let t,{index:s,text:n,cutOff:l=!1,startTimestamp:r,stopTimestamp:o,isStreaming:c,mostRecentSummary:d,onToggle:u,messageUuid:f,isFirstBlockOfMessage:m,isLastBlockOfMessage:x,renderMode:h=e$.G.Standard,isFirstItemInGroup:g,isLastItemInGroup:p}=e,v=(0,W.useDynamicConfig)("claudeai_isp_thinking_ux"),j=v.get("enabled",!1),y=(0,N.Z)(),b=y.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),w=y.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),_=y.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:C,setIsExpanded:M,snappyTransition:k}=(0,e1.g)(!j&&c,String(s)),S=(0,eR.z$)(),[E,z]=(0,i.useState)(()=>e5(r,o)),I=(0,i.useRef)(),Z=(0,i.useRef)(!1),[T,F]=(0,i.useState)(null),R=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eJ.Ef)(f)&&R.current.length>0&&(R.current.forEach(e=>{S.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:f,timestamp:e.timestamp})}),R.current=[])},[f,S]),(0,i.useEffect)(()=>{c&&(Z.current=!0)},[c]);let A=c||Z.current?v.get("fallback_summary_debounce_ms",2e3):0;(0,eW.s)(()=>{!c&&n.length>0&&F(e8(n,v))},[n,c],A),(0,i.useEffect)(()=>{let e=()=>{let e=e5(r,void 0);I.current=e,z(e)};if(c){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!I.current&&o&&z(e5(r,o))},[r,o,c]);let L=null==d?void 0:d.summary;if(j){if(c)t=null!=L?L:w;else{var O;t=null!==(O=null!=L?L:T)&&void 0!==O?O:w}}else t=null!=L?L:c?b:_;return(0,a.jsx)(e0.qd,{isStreaming:c,isExpanded:C,setIsExpanded:()=>{let e=new Date().toISOString();(0,eJ.Ef)(f)?S.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!C,is_streaming:c,chat_message_uuid:f,timestamp:e}):R.current.push({isOpening:!C,wasStreamingWhenClicked:c,timestamp:e}),M(!C)},isFirstBlockOfMessage:m,isLastBlockOfMessage:x,text:C?_:c||I.current?(0,a.jsx)(en.M,{mode:"wait",children:(0,a.jsx)(q.E.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:j?"text-text-300":"text-left relative text-sm font-tiempos leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,a.jsx)("span",{className:j?"text-text-300":"text-left relative text-sm font-tiempos leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:E?(0,a.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,a.jsx)(eG,{className:(0,G.Z)("text-text-300 transition-all duration-300 ease-in-out opacity-50",c?"!opacity-0 scale-50":"scale-100 opacity-100"),size:14}),(0,a.jsx)("span",{className:"tabular-nums",children:(0,a.jsx)(eV,{value:E,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:h,isFirstItemInGroup:g,isLastItemInGroup:p,children:(0,a.jsx)(e0.jE,{isExpanded:C,snappyTransition:k,onTransitionEnd:u,isScrollable:!0,children:(0,a.jsx)(e6,{text:n,cutOff:l})})})},e8=(e,t)=>{let s=t.get("fallback_summary_min_len",50),n=t.get("fallback_summary_max_len",100),a=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|。)")),i=e.substring(0,n),l=a.exec(i);if(l)return l[0];for(let e=i.length-1;e>=s;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i};var e9=s(81353),te=s(32420);function tt(){let e=(0,n._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return tt=function(){return e},e}function ts(){let e=(0,n._)(["\n  group\n  relative\n  -tracking-[0.015em]\n"]);return ts=function(){return e},e}function tn(){let e=(0,n._)(["\n  font-claude-message\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&>div>div>:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&>div>div>:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return tn=function(){return e},e}let ta={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},ti={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},tl={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},tr=[],to=e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0},tc=(e,t,s)=>{var n,a,i,l;let r,o,c;let d=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=to(s.partial_json)):r=null===(a=s.input)||void 0===a?void 0:a.id,u&&(o=null==e?void 0:null===(i=e.input)||void 0===i?void 0:i.id),!d||(null==t?void 0:t.partial_json)||(c=null==t?void 0:null===(l=t.input)||void 0===l?void 0:l.id);let f=r===o,m=r===c,x="individual_cell_create",h=null===(n=s.input)||void 0===n?void 0:n.command;return(h&&(x=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),d||u)?d&&u?f||m?f&&!m?"multi_edit_last":"multi_edit_not_last":x:d&&!u?m?"multi_edit_not_last":x:!d&&u&&f?"multi_edit_last":x:x},td=(e,t)=>{let s=(0,B.X)(),n=(0,i.useCallback)(e=>{if("text"!==e.type)return e;let n=e.text;return s&&e.citations&&e.citations.length>0&&(n=(0,L.NM)(e.citations,n)),n=t?(0,U.An)(n):(0,U.w0)(n),{...e,text:n}},[t,s]);return(0,i.useMemo)(()=>{var t;let s=e.content,a=null===(t=e.content)||void 0===t?void 0:t[0];(null==a?void 0:a.type)==="text"&&""===a.text.trim()&&(s=null==s?void 0:s.slice(1));let i=(null==s?void 0:s.map(e=>n(e)))||[];return{...e,content:i}},[e,n])},tu=e=>{var t,s,n;let{block:l,message:r,updatedMessage:o,index:c,isShared:d,isStreaming:u,isLastMessage:f,publishedArtifacts:m,isFirstBlockOfMessage:x,isLastBlockOfMessage:h,renderMode:g,isFirstItemInGroup:p,isLastItemInGroup:v}=e,{renderToolUseCell:j}=(0,e9.I)(),y=(0,J.n)(l),b=l.name,w=l.id,_=l.context,N=null===(t=o.content)||void 0===t?void 0:t[c+1],C=(null==N?void 0:N.type)==="tool_result"?N:void 0,M={integrationName:l.integration_name,integrationIcon:l.integration_icon_url,message:(null==C?void 0:C.message)||l.message,input:l.display_content,result:null==C?void 0:C.display_content},k=!!o.content&&o.content.length<=c+1&&u,S=tc(null===(s=o.content)||void 0===s?void 0:s[c-2],null===(n=o.content)||void 0===n?void 0:n[c+2],l);if(!j)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let E=j({toolUseId:w,input:y,isLastMessage:f,message:r,publishedArtifacts:m,isStreaming:k,toolName:b,toolResult:C,displayData:M,artifactCellType:S,isFirstBlockOfMessage:x,isLastBlockOfMessage:h,isShared:d,context:_,renderMode:g,groupItemKey:String(c),isFirstItemInGroup:p,isLastItemInGroup:v});return(0,a.jsx)(i.Fragment,{children:E})},tf=e=>{var t,s,n;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,textAreaRef:c,finishEdit:d,cancelEdit:u,author:f,loggedInAccount:m,message:x,selectAttachment:h,showSharedImageMissing:p=!1,showSharedFileMissing:v=!1}=e;(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),u()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===c.current){var t;null===(t=c.current)||void 0===t||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,u,c]);let y=null!==(n=x.files_v2)&&void 0!==n?n:x.files,b=p||v||x.attachments.length+y.length+((null==x?void 0:null===(t=x.sync_sources)||void 0===t?void 0:t.length)||0)>0;return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[b&&(0,a.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[y.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e},t)),x.attachments.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e,onClick:()=>null==h?void 0:h(e)},t)),null==x?void 0:null===(s=x.sync_sources)||void 0===s?void 0:s.map(e=>(0,a.jsx)(eH.Q,{uuid:e.uuid,syncSource:e},e.uuid)),p&&(0,a.jsx)(g.Xz,{}),v&&!p&&(0,a.jsx)(g.kD,{})]}),(0,a.jsx)(th,{...l&&ti,className:"w-full",children:(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"flex shrink-0 items-center",children:(0,a.jsx)(D.q,{name:f||(null==m?void 0:m.full_name)||"",size:"sm"})}),(0,a.jsxs)("div",{className:"font-user-message mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,a.jsx)(P.Kx,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:c}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,a.jsx)(_.k,{"aria-hidden":"true",className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(C.Z,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(j.z,{onClick:u,variant:"secondary",children:(0,a.jsx)(C.Z,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsx)(j.z,{type:"submit",disabled:0===r.length,children:(0,a.jsx)(C.Z,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})},tm=(0,i.memo)(function(e){var t,s,n,l,r,o,c;let{lastHumanMessageRef:d,lastAssistantMessageRef:u,isLastMessage:f,isLastHumanMessage:m,selectAttachment:x,author:p,isInteractive:v=!0,onOpenArtifact:j,onResize:b,editable:w,conversationSettings:_,publishedArtifacts:N=tr,messageWarningProps:C,showSharedImageMissing:M=!1,showSharedFileMissing:k=!1,isFirstAssistantMessage:S,isShared:E,actionEmitter:z,onSendContinue:I,isResearchPending:Z=!1,...T}=e,{previousMessage:F,message:L,isStreaming:P,conversationUUID:U}=T,[B,J]=(0,i.useState)(!1),[V,Y]=(0,i.useState)(""),X=(0,i.useRef)(null),Q=(0,i.useRef)(1);(0,i.useEffect)(()=>{f||(Q.current+=1)});let $=null!==(c=L.files_v2)&&void 0!==c?c:L.files,ee=td(L,j),et="",es=null===(t=ee.content)||void 0===t?void 0:t.find(e=>"text"===e.type);es&&"text"in es&&(et=es.text);let en=(0,i.useRef)(!1),ea=(0,i.useRef)(!1),{account:ei,activeOrganization:el}=(0,O.t)(),{value:er}=(0,y.FL)("use_in_house_latex_transformer"),eo=(0,i.useCallback)((e,t)=>{null==z||z.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[z]),ec=w?()=>{Y(et),J(!0)}:void 0,ed=(0,i.useCallback)(()=>{0!==V.length&&z&&(z.emit("edit",{message:ee,text:V}),J(!1),Y(""))},[V,z,ee]),eu=(0,i.useCallback)(e=>null==j?void 0:j(e,ee.uuid),[j,ee.uuid]),ef="human"===ee.sender,em="assistant"===ee.sender,ex=null===(s=ee.content)||void 0===s?void 0:s.some(e=>"text"===e.type&&""!==e.text),eh=f&&P,eg=M||k||ee.attachments.length+$.length+((null==ee?void 0:null===(n=ee.sync_sources)||void 0===n?void 0:n.length)||0)>0,ep=(0,i.useMemo)(()=>{var e,t;return null!==(t=null===(e=L.sync_sources)||void 0===e?void 0:e.filter(e=>e.type===H.Fg.GDRIVE).map(e=>e.config.uri))&&void 0!==t?t:[]},[L.sync_sources]),ev=(0,K.mD)(ep),ej=(0,i.useMemo)(()=>ev.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[ev]),ey="voice"===ee.input_mode||"speech_input"===ee.input_mode,eb=(0,W.useDynamicConfig)("claudeai_isp_thinking_ux");if(B)return(0,a.jsx)(tf,{isStreaming:P,currentEdit:V,setCurrentEdit:Y,textAreaRef:X,finishEdit:ed,cancelEdit:()=>{J(!1),Y("")},author:p,loggedInAccount:ei,message:ee,selectAttachment:x,showSharedImageMissing:M,showSharedFileMissing:k});let ew=function(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e$.G.Standard,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=s[t+1],c=(null==o?void 0:o.type)==="tool_result",d=0===t,u=!!s.length&&t===s.length-1-(c?1:0);if("thinking"===e.type){var m;return(0,a.jsx)(e7,{index:t,text:e.thinking,cutOff:e.cut_off,startTimestamp:e.start_timestamp,stopTimestamp:e.stop_timestamp,isStreaming:eh&&!e.stop_timestamp,mostRecentSummary:null===(m=e.summaries)||void 0===m?void 0:m.at(-1),messageUuid:ee.uuid,onToggle:()=>{b&&b()},isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:n,isFirstItemInGroup:l,isLastItemInGroup:r},t)}if("tool_use"===e.type)return(0,a.jsx)(tu,{block:e,message:L,updatedMessage:ee,index:t,isShared:E,isStreaming:P,isLastMessage:f,publishedArtifacts:N,isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:n,isFirstItemInGroup:l,isLastItemInGroup:r},t);if("text"===e.type){if(0===t&&""===e.text)return;return(0,a.jsxs)(i.Fragment,{children:[(0,a.jsx)(A.ux,{text:e.text,blockCitations:e.citations,hasLinkRef:en,hasCodeRef:ea,isStreaming:P,onOpenArtifact:eu,isLastMessage:f,publishedArtifacts:eh?void 0:N,useInHouseLatexPlugin:er,onLinkClick:void 0}),""]},"".concat(t,"-").concat(eh?"streaming":"static"))}};return(0,a.jsxs)("div",{ref:m?d:f?u:null,"data-test-render-count":Q.current,children:[ef&&(0,a.jsxs)("div",{className:"mb-1 mt-1",children:[eg&&(0,a.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[$.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e},t)),ee.attachments.map((e,t)=>(0,a.jsx)(g.mB,{size:"lg",file:e,onClick:()=>null==x?void 0:x(e)},t)),null==ee?void 0:null===(l=ee.sync_sources)||void 0===l?void 0:l.map(e=>(0,a.jsx)(eH.Q,{uuid:e.uuid,syncSource:e},e.uuid)),M&&(0,a.jsx)(g.Xz,{}),k&&!M&&(0,a.jsx)(g.kD,{})]}),(0,a.jsxs)(th,{className:ex?"pr-6":"pr-[2.5px]",...P&&ti,children:[(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,a.jsx)("div",{className:"shrink-0",children:(0,a.jsx)(D.q,{name:p||(null==ei?void 0:ei.full_name)||"",size:"sm"})}),(0,a.jsx)("div",{"data-testid":"user-message",className:(0,G.Z)("font-user-message grid grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",{italic:ey}),children:null===(r=ee.content)||void 0===r?void 0:r.map((e,t)=>"text"!==e.type?null:(0,a.jsx)(h,{text:e.text},t))})]}),(0,a.jsx)(R,{message:L,isLastMessage:f,hasLink:en.current,hasDriveDocWithImages:ej,conversationSettings:_,messageWarningPropsFromParent:C}),(0,a.jsx)(eZ,{isLastMessage:f,isInteractive:v,editMessage:ec,onRetry:eo,isResearchPending:Z,...T})]})]}),em&&(0,a.jsx)(a.Fragment,{children:ee.content&&ee.content[0]&&(0,a.jsx)(q.E.div,{style:{height:"auto"},...P&&tl,children:(0,a.jsxs)(tg,{"data-is-streaming":eh,...P&&ta,className:f?"pb-3":"pb-8",children:[(0,a.jsx)(tp,{children:(()=>{let e=ee.content,t=[],s=Array(e.length).fill(!1);for(let n=0;n<e.length;n++){let i;let l=e[n],r=[],o=!1;if(eb.get("timeline_enabled",!1)&&(0,te.Nt)(l,eb)){if(r.push([l,n,(0,te.o_)(l)]),s[n])continue;for(let t=n+1;t<e.length;t++){let s=e[t];if(!(0,te.Nt)(s,eb))break;r.push([s,t,(0,te.o_)(s)]),t===e.length-1&&(o=!0)}}if(eb.get("timeline_artifacts_enabled",!1)){let e=r.findLastIndex(e=>{let[t]=e;return"tool_use"===t.type&&"artifacts"===t.name});if(e>=0){r=r.slice(0,e);for(let e=0;e<r.length;e++){let t=r[e],s=t[0];"tool_use"===s.type&&"artifacts"===s.name&&(t[2]=!1)}}}let c=0;for(let[,,e]of r)e&&c++;c>1?(r.forEach(e=>{let[,t]=e;s[t]=!0}),i=(0,a.jsx)(te.E$,{isFirstBlockOfMessage:0===n,isLastBlockOfMessage:o,isStreaming:P,children:r.map((t,s)=>{let[n,a,i]=t;if(i)return ew(n,a,e,e$.G.TimelineGroup,0===s,s===r.length-1)})},"group-".concat(n))):i=ew(l,n,e),t.push(i)}return t})()}),null===(o=ee.content)||void 0===o?void 0:o.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,a.jsx)(eB,{text:e.text,title:e.title},t)}),!P&&f&&(0,a.jsx)(eP,{previousMessage:F}),(0,a.jsx)(eZ,{isLastMessage:f,isInteractive:v,isFirstAssistantMessage:S,onRetry:eo,isResearchPending:Z,...T}),(0,a.jsx)(R,{message:L,isLastMessage:f,messageWarningPropsFromParent:C,conversationSettings:_,hasLink:en.current,hasCode:ea.current,onRetry:eo,onSendContinue:I})]})})})]})}),tx=()=>(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,a.jsx)(th,{children:(0,a.jsx)("div",{className:(0,G.Z)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,a.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})}),th=(0,v.q)(q.E.div)(tt()),tg=(0,v.q)(q.E.div)(ts()),tp=v.q.div(tn())},81353:function(e,t,s){"use strict";s.d(t,{I:function(){return l},w:function(){return r}});var n=s(27573),a=s(7653);let i=a.createContext({renderToolUseCell:void 0}),l=()=>a.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,a.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,n.jsx)(i.Provider,{value:l,children:s})}},81865:function(e,t,s){"use strict";s.d(t,{k:function(){return sz},J:function(){return sE}});var n=s(41596),a=s(27573),i=s(28803),l=s(51789),r=s(1146),o=s(71817),c=s(76220),d=s(15281),u=s(66557),f=s(27218),m=s(1812),x=s(48410),h=s(9788),g=s(72538),p=s(32737),v=s(82083),j=s(87033),y=s(98649),b=s(10607),w=s(68425),_=s(2457),N=s.n(_),C=s(43290),M=s(5289),k=s(88146),S=s(81695),E=s(7653),z=s(40950),I=s(45790),Z=s(41270),T=s(7160),F=s(95899),R=s(32559),A=s(23098),L=s(95586),O=s(15662),D=s(99281),P=s(63690),U=s(16155),B=s(7680),H=s(37458),J=s(47082),W=s(28346),G=s(95566),q=s(80762),K=s(13927),V=s(35204);let Y=e=>V.RI[e](),X={js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",py:"python",rb:"ruby",java:"java",cpp:"cpp",cs:"csharp",php:"php",go:"go",rs:"rust",html:"html",css:"css",md:"markdown",json:"json",xml:"xml",yaml:"yaml",yml:"yaml",sh:"shell",sql:"sql"};var Q=s(52902);let $=e=>{if((0,Q.Wx)(e)){let{pathComponents:t}=(0,Q.Xp)(e);if(!t.length)throw Error("Invalid file uri");return t[t.length-1]}return e},ee=new K.F6,et=new K.F6,es=[ee.of([]),et.of([])],en=(e,t,s)=>{let n=(0,W.Z)({original:t,gutter:!1});if(e.dispatch({effects:ee.reconfigure(n)}),s){let s=(0,W.Z)({original:t,collapseUnchanged:{margin:3,minSize:4},gutter:!1});requestAnimationFrame(()=>{e.dispatch({effects:ee.reconfigure(s)})})}},ea=e=>{var t,s;let{fetchFileContent:n,isStreaming:i,selectedContentId:l,readOnly:r,theme:o,onUpdate:c,onCreateEditor:d,collapseUnchanged:u=!0}=e,f=(0,E.useRef)(null),{registerEditor:m,unregisterEditor:x,getInstance:h,setMergeState:g}=(0,B.s)(),[p,v]=(0,E.useState)(void 0),[j,y]=(0,E.useState)(!1);(0,E.useEffect)(()=>()=>{j&&x(l)},[l,x,j]),(0,E.useEffect)(()=>{n(l).then(e=>{v(e)})},[l,p,n]);let b=null!==(s=null===(t=h(l))||void 0===t?void 0:t.mergeState)&&void 0!==s?s:{isActive:!1};(0,E.useEffect)(()=>{var e;let t=null===(e=f.current)||void 0===e?void 0:e.view;t&&(b.isActive&&"diffSource"in b?en(t,b.diffSource,u):t.dispatch({effects:ee.reconfigure([])}))},[b.isActive,u,i]);let w=(0,E.useCallback)(e=>{if(null==c||c(e),b.isActive){let t=(0,W.Sk)(e.state),s=!t||0===t.chunks.length;e.transactions.some(e=>e.effects.some(e=>e.is(W.kP)))&&s&&b.isActive&&(q.f("All changes accepted, deactivating merge view"),g(l,{isActive:!1}))}},[b.isActive,c,l,g]),_=function(e){let t=(0,E.useMemo)(()=>{var t;return X[(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())||""]||"javascript"},[e]);return(0,E.useMemo)(()=>Y(t),[t])}($(l)||"Unnamed File"),N=(0,E.useCallback)(e=>{m(l,e),y(!0),e.dispatch({effects:et.reconfigure(_||[])}),null==d||d(e)},[_,d,m,l]);return(0,a.jsx)(G.ZP,{ref:f,value:p,theme:o,readOnly:r,extensions:es,onUpdate:w,onCreateEditor:N,basicSetup:{foldGutter:!1,autocompletion:!1,lineNumbers:!1}})};function ei(e,t){switch(t.type){case"create":case"update":if(t.newText!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t.newText},annotations:[G.YW.addToHistory.of(!1)]});try{en(e,(0,W.gO)(e.state).toString(),"update"===t.type)}catch(e){}}break;case"delete":e.dispatch({changes:{from:0,to:e.state.doc.length,insert:""},annotations:[G.YW.addToHistory.of(!1)]})}}var el=s(28096),er=s(18701);let eo=Z.z.object({path:Z.z.string().optional(),new_str:Z.z.string().optional(),old_str:Z.z.string().optional(),original_hash:Z.z.string().optional(),file_text:Z.z.string().optional()}),ec="antDocumentUpdate";RegExp("".concat("<".concat(ec),"(?:\\s+([^>]*)>|(?!>)\\S*)([\\s\\S]*?)(?:").concat("</".concat(ec,">"),"|$)"),"g");var ed=s(40030),eu=s(10690),ef=s(81389);function em(e){var t;return!!ex(e)&&!!(null===(t=e.content)||void 0===t?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function ex(e){var t;return null===(t=e.content)||void 0===t?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}var eh=s(16173),eg=s(53949),ep=s(37199),ev=s(84165),ej=s(27895),ey=s(45014),eb=s(59821),ew=s(70354),e_=s(43566),eN=(s(17582),s(28386)),eC=s(91588),eM=s(43116),ek=s(80151),eS=s(77003),eE=s(96346),ez=s(7992),eI=s(8927),eZ=s(35919),eT=s.n(eZ),eF=s(30833),eR=s(21273);let eA=e=>{let t=new Map,s=new Map;for(let n of e)for(let e of n.annotated_snippets)for(let n of e.tool_calls)if("web_search"===n.tool_name||"web_fetch"===n.tool_name){let e=[];if("web_search"===n.tool_name){if(!n.output||"rich_content"!==n.output.type||!n.output.content)continue;e=n.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===n.tool_name){if(!n.output||"rich_link"!==n.output.type||!n.output.link.url)continue;e=[n.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),n="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=s.get(i);s.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,a.jsx)(eb.s,{url:n,size:14})})}catch(e){}}else if(n.output){let e=n.integration_name||n.tool_name,s="rich_content"===n.output.type?n.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+s,icon:(null==i?void 0:i.icon)||(0,a.jsx)(eR.AQ,{canShowLetterIcon:!0,size:14,iconUrl:n.server_icon_url||void 0,integrationName:n.integration_name||void 0,toolName:n.tool_name})})}let n=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(s.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return n.concat(i).slice(0,4-n.length)},eL=e=>{let{onClose:t,onBack:s,onDebug:n,title:i,isHidden:l,className:r}=e;return(0,a.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,a.jsx)(ew.z,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,a.jsx)(eC.W,{size:16})}),(0,a.jsx)("h2",{className:(0,b.Z)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!n&&(0,a.jsx)(ew.z,{variant:"ghost",size:"icon_sm",onClick:n,disabled:l,children:(0,a.jsx)(eM.t,{size:16})})]}),(0,a.jsx)(ew.z,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,a.jsx)(ek.X,{size:16})})]})};function eO(e){let{compassStatus:t,onOpenSources:s}=e;if(!t.total_sources)return null;let n=eA(t.agents),i=n.length>0?n[0][1].count:0,l=t.total_sources-n.reduce((e,t)=>t[1].count+e,0);return 0===n.length?null:(0,a.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:(0,a.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[n.map((e,t)=>{let[s,{count:n,icon:l}]=e;return(0,a.jsxs)("div",{className:"flex items-center text-xs",children:[(0,a.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,a.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:s,children:s}),(0,a.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,a.jsx)(I.Z,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:n}})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(w.E.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(n/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)}),l>0&&(0,a.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,a.jsx)(eS.x,{size:16,className:"text-text-300 mr-2"}),(0,a.jsx)("p",{children:(0,a.jsx)(I.Z,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let eD=e=>{let{title:t,complete:s,className:n}=e;return(0,a.jsx)(w.E.h3,{className:(0,b.Z)("text-base text-text-100 font-tiempos",n),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,a.jsx)(e_.g,{children:t})},t)};function eP(e){let{title:t,description:s,numSources:n,onClick:i,complete:l}=e;return(0,a.jsxs)(w.E.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,a.jsx)(eD,{title:null!=s?s:t,complete:l}),(0,a.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===n?(0,a.jsx)(I.Z,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,a.jsx)(I.Z,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:n}})})]})}function eU(e){let{status:t,allSnippets:s,onOpenSources:n}=e,[i,l]=(0,E.useState)([]);return(0,E.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,P.eB)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,a.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,a.jsx)(eO,{compassStatus:t,onOpenSources:()=>n(!0)}),s&&s.length>0&&(0,a.jsx)("div",{className:"flex flex-col gap-3",children:(0,a.jsx)(w.E.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,a.jsx)(eP,{...e,onClick:()=>n(!0,e.globalAgentIndex)},t))})})]})}function eB(e){let{data:t,onClose:s}=e,[n,i]=(0,E.useState)(!1),[l,r]=(0,E.useState)({sourcesOpen:!1}),{conversationUUID:o,organizationUUID:c,isShared:d,taskId:u}=t,{compassStatus:f}=(0,P.Oz)({organizationUUID:c,conversationUUID:o,taskId:u,isShared:d});if(!f)return null;let m=(e,t)=>{r({sourcesOpen:e,index:t})},x=void 0,h=l.sourcesOpen||n;return(0,a.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,a.jsx)(w.E.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,a.jsx)(eH,{compassStatus:f,onClose:s,onDebug:x,handleOpenSources:m})}),(0,a.jsx)("div",{className:(0,b.Z)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,a.jsx)(w.E.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:eN.J.snappyOut},className:(0,b.Z)("absolute top-0 left-0 right-0 bottom-0"),children:(0,a.jsx)(eG,{isHidden:!h,compassStatus:f,onBack:n?()=>i(!1):()=>m(!1),onClose:s,onDebug:x,isDebug:n,agentIndex:l.index})})]})}function eH(e){let{compassStatus:t,onClose:s,onDebug:n,handleOpenSources:i}=e,l=(0,z.Z)(),r=(0,P.ii)(t),o=t.status,c=(0,P.PF)(t),d=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,total_sources:e.total_sources,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),f=y.on.indexOf(o),m=[{title:o===y.IN.Starting||o===y.IN.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:c?(0,a.jsx)(P.xL,{thought:c,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!c},{title:o===y.IN.InitiatingAgents||o===y.IN.Searching?0===d?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:d}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:d}),titleIcons:(0,a.jsx)(P.AS,{hrefs:(0,P.eB)({agents:t.agents,n:3})}),children:(0,a.jsx)(eU,{allSnippets:u,status:t,onOpenSources:i}),shown:f>=2||t.agents.length>1,expandable:u.length>0},{title:o===y.IN.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:f>=4,expandable:!1}],x=m.filter(e=>e.expandable).length,h=m.findLastIndex(e=>!!e.expandable),g=(0,E.useRef)(h),[p,v]=(0,E.useState)(h),[j,b]=(0,E.useState)(!0),w=(0,E.useCallback)((e,t,s)=>{b(s),t?v(e):v(0===e?1:0)},[b,v]);(0,E.useEffect)(()=>{h!==g.current&&w(h,!0,!1)},[w,h]);let _=[y.IN.Cancelled,y.IN.Failed,y.IN.TimedOut].includes(t.status),N=m.filter(e=>e.shown).length;return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,a.jsx)(eL,{onClose:s,onDebug:n,title:r,className:"font-medium"}),(0,a.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[m.map((e,s)=>{let{expandable:n,shown:i,title:l,titleIcons:r,children:o}=e,c=_||s<N-1||t.status===y.IN.Completed;return(0,a.jsx)(eJ,{title:l,titleIcons:r,noShimmer:c||_,complete:c,isExpanded:n&&p===s,snappyTransition:j,showLine:s<N-1||_||p===s,handleExpand:e=>w(s,e,!0),expandable:n,collapsible:x>1,shown:i,children:o},s)}),_&&(0,a.jsx)(eJ,{title:t.status===y.IN.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:eT(),shown:_})]})]})}function eJ(e){let{title:t,titleIcons:s,complete:n,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:c,snappyTransition:d,noShimmer:u,isError:f,showLine:m,children:x}=e;return!!r&&(0,a.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,a.jsx)("div",{className:(0,b.Z)("transition-all w-2.5 h-2.5 rounded-full shrink-0",f?"bg-danger-200":n?"bg-text-500":"bg-accent-main-200")}),m&&(0,a.jsx)("div",{className:(0,b.Z)("transition-all h-full -mb-1 w-[1px]",n?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>c(!o),disabled:!i||o&&!l,children:(0,a.jsxs)("h4",{className:(0,b.Z)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",f&&"!text-danger-200"),children:[u?t:(0,a.jsx)(e_.g,{children:t}),(0,a.jsx)(eI.M,{children:!!s&&!o&&(0,a.jsx)(w.E.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:s})}),!!i&&l&&(0,a.jsx)(eE.p,{className:(0,b.Z)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,a.jsx)(eF.jE,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:d,className:"!max-h-none w-full",setIsExpanded:c,children:x})]})]})}function eW(e){var t,s;let{toolCall:n,isHidden:i}=e;if("web_fetch"===n.tool_name&&(null===(t=n.output)||void 0===t?void 0:t.type)==="rich_link"&&n.output.link.url){let{url:e,icon_url:t,title:s,subtitles:l}=n.output.link;return(0,a.jsx)(eF.hZ,{isDisabled:i,isStreaming:!1,icon:(0,a.jsx)(eb.s,{fadeInOnLoad:!0,url:t,size:16}),text:(0,a.jsx)(I.Z,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:s,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,a.jsx)(ez.O,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return n.output?(0,a.jsx)(eR.ii,{integrationName:n.integration_name||void 0,integrationIcon:n.server_icon_url||void 0,message:n.message,isExpandingDisabled:i,result:n.output,isStreaming:!1,isError:n.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null===(s=n.output)||void 0===s?void 0:s.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eG(e){var t;let{isHidden:s,compassStatus:n,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:c}=e,d=(0,E.useRef)(null),u=(0,z.Z)(),f=c?!!(null===(t=n.agents[c])||void 0===t?void 0:t.completed_at):n.status===y.IN.Completed,m=void 0===c?null:n.agents[c].description||n.agents[c].name,x=function(e,t){let s=[];for(let n of t?[e.agents[t]]:e.agents)for(let e of n.annotated_snippets)for(let t of e.tool_calls)t.output&&s.push({toolCall:t,timestamp:e.complete&&n.completed_at||n.started_at});return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s.map(e=>{let{toolCall:t}=e;return t})}(n,c),h=void 0===c?n.total_sources:n.agents[c].total_sources;return(0,a.jsxs)("div",{className:(0,b.Z)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,a.jsx)(eL,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:f?"":(0,a.jsx)(I.Z,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{d.current&&(d.current.scrollTop=0)},500),r()}}),(0,a.jsxs)("div",{ref:d,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!m&&(0,a.jsx)(eD,{title:m,complete:f,className:"pt-1 pb-5"}),x.length>0?(0,a.jsx)("div",{className:"flex flex-col gap-4",children:x.map((e,t)=>(0,a.jsx)(eW,{toolCall:e,isHidden:s},t))}):(0,a.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,a.jsx)(I.Z,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}s(18187);var eq=s(22269);s(71844),s(5161),s(58865);var eK=s(3053);s(1679);var eV=s(5984),eY=s(45033),eX=s(52939),eQ=s(85689),e$=s(58183),e0=s(89846),e1=s.n(e0),e2=s(67587),e5=s(67667),e3=s(98753),e4=s(87150),e6=s(18999),e7=s(48894),e8=s(37141);let e9=e=>{let{contentId:t,showFullPath:s=!0}=e;if(!(0,Q.Wx)(t))return null;let{pathComponents:n}=(0,Q.Xp)(t);return s?(0,a.jsx)("span",{className:"flex gap-0.5 items-center",children:n.map((e,t)=>(0,a.jsxs)(E.Fragment,{children:[0!==t&&(0,a.jsx)(e8.T,{size:"10",className:"mt-0.5 text-text-500"}),(0,a.jsx)("span",{className:(0,b.Z)(t<n.length-1&&"opacity-70"),children:e})]},"".concat(e,"-").concat(t)))}):(0,a.jsx)(p.u,{tooltipContent:n.join("/"),children:(0,a.jsx)("span",{children:n[n.length-1]})})};var te=s(11607),tt=s(87590),ts=s.n(tt),tn=s(34326),ta=s(8628);function ti(e,t){let s=0;if(!e.children&&(0,tn.VG)(t,e.path))return 1;if(e.children)for(let n of e.children.values())s+=ti(n,t);return s}let tl=e=>{let{directoryName:t,listFiles:s,openedFiles:n,onSubmit:i}=e,[l,r]=(0,E.useState)(),[o,c]=(0,E.useState)("/"),d=(0,E.useMemo)(()=>{let e={};for(let t of n)if("string"==typeof t){let{pathComponents:s}=(0,Q.Xp)(t);e["/"+s.join("/")]="include"}return e},[n]),[u,f]=(0,E.useState)(d),m=(0,E.useMemo)(()=>!ts()(d,u),[d,u]);(0,E.useEffect)(()=>{s().then(e=>{r(function(e){let t={name:"",path:"/",size:0,children:new Map};for(let s of e){let{pathComponents:e}=(0,Q.Xp)(s);if(0===e.length||1===e.length&&s.endsWith("/"))continue;let n=t;for(let t=0;t<e.length;t++){let a=e[t];if(!a)continue;let i=t===e.length-1,l="/"+e.slice(0,t+1).join("/");i?s.endsWith("/")||n.children.set(a,{name:a,path:l,size:0}):(n.children.has(a)||n.children.set(a,{name:a,path:l.endsWith("/")?l:l+"/",size:0,children:new Map}),n=n.children.get(a))}}return t}(e))})},[s]);let x=(0,E.useCallback)(()=>{if(!l)return;let e=function e(t,s){let n=[];if(!t.children&&(0,tn.VG)(s,t.path)&&n.push(t.path),t.children)for(let a of t.children.values())n.push(...e(a,s));return n}(l,u),t=n[0],{projectUuid:s,directoryUuid:a,directoryName:r}=(0,Q.Xp)(t);i(e.map(e=>"file://".concat(s,"/").concat(a,"/").concat(r).concat(e)))},[l,u,n,i]);return l?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"rounded-xl border-0.5 border-border-300 bg-bg-000 shadow-sm h-[600px] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 px-4 border-b-0.5 border-border-300 h-16",children:[(0,a.jsx)("p",{className:"text-sm text-text-400",children:"Select which files to include..."}),(0,a.jsx)(eI.M,{children:m&&(0,a.jsx)(w.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",damping:20,stiffness:400},children:(0,a.jsx)(ew.z,{size:"sm",onClick:x,children:"Update"})})})]}),(0,a.jsx)(ta.o,{repo:t,rootNode:l,filters:u,setFilters:f,currentDirectory:o,setCurrentDirectory:c}),(0,a.jsx)("div",{className:"flex text-xs items-center justify-between border-border-300 border-t-0.5 py-2 px-4 text-text-300",children:l&&u&&Object.keys(u).length>0?(0,a.jsxs)("p",{children:[ti(l,u)," ",(0,a.jsx)(I.Z,{defaultMessage:"{count, plural, one {file} other {files}}",id:"pGWzhe74G/",values:{count:ti(l,u)}})," ","selected"]}):(0,a.jsx)("p",{children:"Select files to add to chat context"})})]})}):(0,a.jsx)(tr,{})},tr=()=>(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 h-full bg-bg-000 shadow-sm text-sm text-text-300",children:[(0,a.jsx)("div",{children:(0,a.jsx)(te.Loading,{size:"sm"})}),"Fetching directory contents..."]});var to=s(82780);let tc=e=>{let{contentId:t,fetchFileContent:s,latestHash:n,className:i}=e,{getInstance:l}=(0,B.s)(),[r,o]=(0,E.useState)(),[c,d]=(0,E.useState)(!0),u=l(t);return((0,E.useEffect)(()=>{let e=!0,n=async()=>{d(!0);let n=await s(t);e&&o(n),e&&d(!1)};return u&&(0,el.oI)(u)?n():d(!1),()=>{e=!1}},[t,s,u,n]),!u||c)?null:(0,el.oI)(u)?r!==u.baseContent?(0,a.jsx)(p.u,{tooltipContent:"File has changed",children:(0,a.jsx)("span",{className:(0,b.Z)("text-danger-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,a.jsx)(to.o,{size:32,weight:"duotone"})})}):(0,a.jsx)(p.u,{tooltipContent:"Unsaved changes",children:(0,a.jsx)("div",{className:(0,b.Z)("text-accent-secondary-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,a.jsx)(to.o,{size:32,weight:"duotone"})})}):null},td=e=>{let{directoryName:t,isStreaming:s,changesMode:n,selectedContentId:i,fetchFileContent:l,saveContent:r,onCreateEditor:o,canEdit:c,latestHash:d,onOpen:u,onClose:f,onCreateNewFile:m,openedFiles:x,listFiles:h}=e,{mode:g}=(0,e2.F)(),{getInstance:p,setBaseContent:v}=(0,B.s)(),j=p(i),y=!!j&&(0,el.oI)(j),[w,_]=(0,E.useState)(!1),N=(0,E.useCallback)(()=>{_(!!j&&(0,el.oI)(j))},[j]);(0,E.useEffect)(()=>{N()},[N,y]);let C=(0,E.useCallback)(e=>{j&&e.docChanged&&N()},[N,j]),{dispatchChatResource:M}=(0,J.Y)(),k=(0,E.useRef)(""),S=(0,E.useCallback)(async()=>{let e=await l(i);if(!w){let t=null==j?void 0:j.view;t&&e!==(0,el.li)(j)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:e}})}e&&v(i,e)},[l,j,i,v,w]),z=(0,E.useCallback)(()=>{_(!1),r(i).then(e=>{e||_(!0)})},[r,i]),I=(0,E.useCallback)(()=>{j&&j.view.dispatch({changes:{from:0,to:j.view.state.doc.length,insert:j.baseContent}})},[j]),[Z,{toggle:T}]=(0,e5.q)(!1),F=(0,E.useCallback)(T,[T]),{setIsDrawerExpanded:R}=(0,e7.b)(),A=(0,E.useCallback)(e=>{let t=x.filter(t=>!e.includes(t)),s=e.filter(e=>!x.includes(e));Promise.all([...t.map(e=>f(e)),...s.map(e=>u(e))]).then(()=>{T()})},[u,f,x,T]);return(0,E.useEffect)(()=>{if(!c)return;let e=new AbortController;return(async()=>{if("string"!=typeof d){q.v("latestHash is not a string",d);return}k.current||(k.current=""),k.current===d&&d||w||(await S(),e.signal.aborted||(k.current=d))})(),()=>{e.abort()}},[c,S,j,d,i,w]),(0,a.jsxs)("div",{className:"flex flex-col min-h-0 min-w-0 bg-bg-300 w-full",children:[(0,a.jsxs)("div",{className:(0,b.W)("flex-none w-full flex items-center justify-between pl-3 pr-2 py-2 border-b-0.5 border-border-300 text-sm font-mono",{"h-12":!n}),children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[n?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)(eY.Lt,{align:"start",trigger:(0,a.jsxs)(ew.z,{size:"icon_sm",variant:"ghost",className:"overflow-visible",children:[(0,a.jsx)(e3.a,{}),(0,a.jsx)("div",{className:"border-0.5 border-border-300 bg-bg-100 text-text-400 absolute -right-0.5 -top-0.5 flex h-[1.15rem] min-w-[1.15rem] items-center justify-center rounded-full px-[0.15rem] text-center text-[0.5rem] font-medium",children:x.length})]}),children:[x.map(e=>(0,a.jsxs)(eY.hP,{onSelect:()=>{if((0,Q.Wx)(e))return M({type:"SELECT_SYNCED_DIRECTORY",id:e})},children:[(0,a.jsxs)("div",{className:"flex gap-1.5 items-center text-sm font-mono w-full",children:[(0,a.jsx)("div",{className:"w-4 h-4",children:e===i&&(0,a.jsx)(eQ.J,{})}),(0,a.jsx)("div",{className:"flex-1 flex items-center justify-between gap-2 text-xs h-6",children:(0,a.jsx)(e9,{contentId:e})})]}),(0,a.jsx)("div",{className:"flex items-center justify-center h-6",children:(0,a.jsx)(tc,{className:"m-2",contentId:e,fetchFileContent:l})})]},e)),(0,a.jsx)(eY.u2,{}),(0,a.jsx)(eY.hP,{className:"text-sm",onSelect:()=>m(),children:(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,a.jsx)(e4.F,{}),"Create new file..."]})}),(0,a.jsx)(eY.hP,{className:"text-sm",onSelect:F,children:(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,a.jsx)(e4.F,{}),"Add existing file..."]})})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"font-mono text-xs",children:(0,a.jsx)(e9,{contentId:i})}),(0,a.jsx)(tc,{className:"ml-2",fetchFileContent:l,contentId:i,latestHash:d})]})]}),(0,a.jsx)("div",{className:"flex gap-1 items-center",children:n?(0,a.jsx)(a.Fragment,{}):(0,a.jsxs)(a.Fragment,{children:[w&&(0,a.jsx)(ew.z,{variant:"primary",size:"sm",className:"text-xs rounded-md px-2 py-1",onClick:z,disabled:!c,children:"Save"}),(0,a.jsxs)(eY.Lt,{align:"end",trigger:(0,a.jsx)(ew.z,{size:"icon_sm",variant:"ghost",children:(0,a.jsx)(e6.x,{})}),children:[(0,a.jsx)(eY.hP,{className:"text-sm",onClick:I,disabled:!w||!c,children:"Discard unsaved changes"}),(0,a.jsx)(eY.hP,{className:"text-sm",onClick:()=>f(i),disabled:!c,children:"Remove this file"})]}),(0,a.jsx)(ew.z,{size:"icon_sm",variant:"ghost",onClick:()=>R(!1),children:(0,a.jsx)(ek.X,{})})]})})]}),(0,a.jsx)("div",{className:"flex flex-1 min-h-0 min-w-0 relative font-mono",children:(0,a.jsx)(ea,{fetchFileContent:l,isStreaming:s,selectedContentId:i,readOnly:!c,theme:"auto"===g?"dark":g,onUpdate:C,onCreateEditor:e=>null==o?void 0:o(i,e)})}),(0,a.jsx)(eX.u_,{isOpen:Z,onClose:T,hasCloseButton:!0,autoCloseOnFocusOut:!1,title:"Add a file from ".concat(t),subtitle:"Selected files will be included in the conversation",modalSize:"xl",children:(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)(tl,{listFiles:h,openedFiles:x,directoryName:t,onSubmit:A})})})]})};var tu=s(44506);let tf=e=>{let{openContentIds:t,fetchFileContent:s}=e,{syncedDirectories:n,projectDocs:a}=(0,ed.b)(),[i,l]=(0,E.useState)(new Map),[r,o]=(0,E.useState)(!0);return(0,E.useEffect)(()=>{r&&(async()=>{o(!1);let e=new Map;for(let n of t){let t=await s(n);if(void 0===t)continue;let a=await (0,tu.G)(t||"");e.set(n,a)}l(e)})()},[t,r,n,a,s]),(0,E.useEffect)(()=>{let e=()=>{o(!0)};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),{latestHashes:i,refreshHashes:()=>o(!0)}},tm=e=>{let{directoryName:t,isStreaming:s,selectedContentId:n,openedFiles:i,onOpen:l,onSaveAllContents:r,onSaveContent:o,onCloseFile:c,fetchFileContent:d,listFiles:u,children:f}=e,m=(0,e$.useDynamicConfig)("harmony_product_strings"),{getInstance:x,setBaseContent:h,unregisterEditor:g,changesMode:p,activeEditors:v,acceptAllChanges:j,rejectAllChanges:y,deactivateChangesMode:w}=(0,B.s)(),[_,N]=(0,E.useState)(new Map),[C,M]=(0,E.useState)(!1),[k,S]=(0,E.useState)(""),{dispatchChatResource:z}=(0,J.Y)();(0,E.useEffect)(()=>{N(e=>{let t=new Map(e);for(let e of i)t.delete(e);return t})},[i]);let I=(0,E.useMemo)(()=>e1()([...i,...Array.from(_.keys())]),[i,_]),[Z,T]=(0,E.useState)(!1),{latestHashes:F,refreshHashes:R}=tf({fetchFileContent:d,openContentIds:new Set(I)}),A=(0,E.useMemo)(()=>n&&F.get(n)||"",[F,n]),L=(0,E.useMemo)(()=>!!n&&I.includes(n),[I,n]),O=async e=>{if(!I.includes(e)){T(!0);try{await l(e)}finally{T(!1)}}},D=async e=>{let t=x(e);if(!t)throw Error("Instance not found for file: ".concat(e));if(_.has(e)){window.confirm(m.get("editor_unsaved",""))&&(g(e),N(t=>{let s=new Map(t);return s.delete(e),s}));return}if(!(0,el.oI)(t)||window.confirm(m.get("editor_unsaved",""))){T(!0);try{g(e),await c(e)}finally{T(!1)}}},{saveContent:P,saveAllContents:U}=function(e){let{setLoading:t,refreshHashes:s,getInstance:n,setBaseContent:a}=e,i=(0,E.useRef)({pendingOperation:null,contentToUpdate:new Map}),l=(0,E.useCallback)(async(e,n)=>{let{pendingOperation:l}=i.current;l&&(l.abort(),q.f("Aborting previous save operation"));let r=new AbortController;i.current={pendingOperation:r,contentToUpdate:n},t(!0);let o=await Promise.race([e(),new Promise((e,t)=>{r.signal.addEventListener("abort",()=>t(Error("Save aborted")))})]);for(let[e,t]of(q.f("Save operation completed",{filesProcessed:n.size,results:o}),o))if(t){let t=n.get(e);t&&a(e,t)}return!r.signal.aborted&&s&&setTimeout(s,1),t(!1),i.current.pendingOperation===r&&(i.current.pendingOperation=null),o},[t,a,s]);return{saveContent:(0,E.useCallback)(async(e,t)=>{let s=n(e);return s?l(async()=>new Map([[e,await t()]]),new Map([[e,(0,el.li)(s)]])):new Map([[e,!1]])},[l,n]),saveAllContents:(0,E.useCallback)(async(e,t)=>{if(!e||0===e.size)return q.v("No save options provided"),new Map;let s=new Map,a=new Map;for(let[t,i]of e.entries()){if(!n(t)||!i.content){q.v("No instance or content found for contentId ".concat(t,". Skipping."));continue}s.set(t,i.content),a.set(t,i)}if(0===s.size)return q.v("No valid files to save"),new Map;let i=await l(()=>t(a),s);return q.f("Save all operation completed",{success:i,filesProcessed:s.size,totalFiles:e.size}),i},[l,n])}}({setLoading:T,refreshHashes:R,getInstance:x,setBaseContent:h}),H=(0,E.useCallback)(e=>{let{projectUuid:t,directoryUuid:s,directoryName:n}=(0,Q.Xp)(i[0]);if(!e){M(!0);return}if(!e)return;if(/[<>:"\\|?*\x00-\x1F]/.test(e)){alert("Filename contains invalid characters");return}if(e.startsWith(".")||e.startsWith("~")||"CON"===e||"PRN"===e||"AUX"===e||"NUL"===e){alert("Invalid filename");return}if(e.length>255){alert("Filename is too long");return}let a="file://".concat(t,"/").concat(s,"/").concat(n,"/").concat(e);if(i.includes(a)){alert("A file with this name already exists");return}N(e=>{let t=new Map(e);return t.set(a,""),t}),z({type:"SELECT_SYNCED_DIRECTORY",id:a})},[z,i]),W=async(e,t)=>{void 0===await d(e)&&_.has(e)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:_.get(e)},annotations:[G.YW.addToHistory.of(!1)]})},K=async e=>{let t;let s=new Map;if(e.forEach(e=>{let t=x(e);if(t&&(0,el.oI)(t))s.set(e,{content:(0,el.li)(t),baseContent:t.baseContent,isDeletedFile:t.filePendingDeletion});else if(!t)throw Error("Instance not found for file: ".concat(e))}),0===s.size)return new Map;if(1===e.length){let n=e[0];t=await P(n,()=>o(n,s.get(n)))}else t=await U(s,r);return await Promise.all(t.entries().map(async e=>{let[t,n]=e;n||void 0!==await d(t)||N(e=>{var n,a;let i=new Map(e);return i.set(t,null!==(a=null===(n=s.get(t))||void 0===n?void 0:n.content)&&void 0!==a?a:""),i})})),t},V=async()=>{if(!n)throw Error("No content selected to save");return(await K([n])).get(n)},Y=async()=>{for(let e of(j(),v)){let t=x(e);t&&void 0===await d(e)&&N(s=>{let n=new Map(s);return n.set(e,(0,el.li)(t)),n})}w()};tx(async()=>await K(I),K,n);let X=(0,a.jsxs)(ew.z,{variant:"primary",size:"sm",disabled:s,children:["Review changes ",(0,a.jsx)(eE.p,{})]}),$=e=>{let{Icon:t,title:s,description:n}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-0.5 w-64 p-0.5 pb-1",children:[(0,a.jsxs)("div",{className:"flex gap-1.5 items-center",children:[t&&(0,a.jsx)(t,{size:16}),(0,a.jsx)("div",{className:"text-sm font-light",children:s})]}),(0,a.jsxs)("div",{className:"flex gap-1.5 items-start",children:[(0,a.jsx)("div",{className:"h-1 w-4 flex-shrink-0",children:"\xa0"}),(0,a.jsx)("div",{className:"text-xs text-text-500 whitespace-normal",children:n})]})]})},ee=E.Children.toArray(f).find(e=>(0,E.isValidElement)(e)&&e.type===tm.Footer);return(0,a.jsxs)("div",{className:(0,b.Z)("flex flex-col w-full h-full max-h-full bg-bg-200",{hidden:!p&&!L}),children:[(0,a.jsxs)("div",{className:"relative flex-1 flex flex-col overflow-hidden",children:[p&&(0,a.jsxs)("div",{className:"flex-none flex items-center border-b-0.5 border-border-300 sticky top-0 z-10",children:[(0,a.jsx)("div",{className:"flex items-center flex-1 pl-1.5 gap-1.5",children:m.get("editor_changes_title","")}),(0,a.jsx)("div",{className:"flex gap-2 items-center p-2",children:(0,a.jsxs)(eY.Lt,{unstyledTrigger:!0,trigger:X,align:"end",children:[(0,a.jsx)(eY.hP,{onSelect:()=>{j(),K(v).finally(w)},children:(0,a.jsx)($,{Icon:eQ.J,title:m.get("editor_changes_save_cta",""),description:m.get("editor_changes_save_description","")})}),(0,a.jsx)(eY.hP,{onSelect:Y,children:(0,a.jsx)($,{Icon:eQ.J,title:m.get("editor_changes_apply_cta",""),description:m.get("editor_changes_apply_description","")})}),(0,a.jsx)(eY.u2,{}),(0,a.jsx)(eY.hP,{onSelect:()=>{y(),w()},children:(0,a.jsx)($,{Icon:ek.X,title:m.get("editor_changes_decline_cta",""),description:m.get("editor_changes_decline_description","")})})]})})]}),(0,a.jsx)("div",{className:(0,b.Z)("flex-1 flex min-h-0 w-full flex-col",p&&"p-3 gap-3 overflow-y-scroll"),children:I.map(e=>(0,a.jsx)("div",{className:(0,b.Z)("w-full",p?"flex-none overflow-hidden border-border-400 border rounded-xl":"flex h-full",{hidden:p&&!v.includes(e)||!p&&n!==e}),children:(0,a.jsx)(td,{directoryName:t,isStreaming:s,changesMode:p,selectedContentId:e,saveContent:V,onCreateEditor:W,canEdit:!Z,latestHash:A,fetchFileContent:d,listFiles:u,onOpen:O,onClose:D,onCreateNewFile:H,openedFiles:I})},e))})]}),ee,(0,a.jsx)(eX.u_,{isOpen:C,onClose:()=>{M(!1),S("")},title:m.get("editor_new_file_title","Create New File"),modalSize:"sm",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 mt-3",children:[(0,a.jsx)(eV.oi,{autoFocus:!0,value:k,onChange:e=>S(e.target.value),onKeyDown:e=>{"Enter"===e.key&&k&&(H(k),M(!1),S(""))},placeholder:m.get("editor_new_file_placeholder","Enter file name")}),(0,a.jsxs)(eX.dm,{children:[(0,a.jsx)(ew.z,{variant:"secondary",onClick:()=>{M(!1),S("")},children:m.get("editor_new_file_cancel","Cancel")}),(0,a.jsx)(ew.z,{variant:"primary",disabled:!k,onClick:()=>{H(k),M(!1),S("")},children:m.get("editor_new_file_create","Create")})]})]})})]})};tm.Footer=e=>{let{children:t,className:s}=e;return(0,a.jsx)(ey.$G,{className:s,children:t})};let tx=(e,t,s)=>{(0,E.useEffect)(()=>{let n=n=>{n.metaKey&&"s"===n.key&&(n.preventDefault(),n.shiftKey?e():s&&t([s]))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,t,s])};function th(e,t){let{projectUuid:s,directoryUuid:n}=(0,Q.Xp)(t);return(0,Q.wq)(e,s,n)}async function tg(e,t,s){let n=th(e,t);return await (0,Q.cn)(n,t,s),"NewFileCreated"}async function tp(e,t){try{let s=th(e,t);return await (0,Q._I)(s,t),"FileDeleted"}catch(e){return"NoChange"}}async function tv(e,t,s){let{isDeletedFile:n,content:a,baseContent:i}=s,{file:l}=(0,Q.sy)(e,t);if(l){if(n)return await tp(e,t);{if(!a||!i)throw Error("Content and base content is required for existing file");let s=await (0,eu.Jl)(e,t);return s&&i!==s&&!confirm("The file content has changed since you’ve last edited. Do you want to overwrite it?")?"NoChange":(await (0,Q.NC)(l,a),"ExistingFileEdited")}}if(n)throw Error("File to delete does not exist");if(void 0===a)throw Error("Content is required for new file");return await tg(e,t,a)}var tj=s(85017);let ty=e=>{let{isStreaming:t,directoryUri:s,selectUri:n,onClose:i,suggestedChanges:l}=e,{track:r}=(0,eK.z$)(),{addError:o}=(0,ej.e)(),{openedFiles:c,projectDocs:d,projectUuid:u,syncedDirectories:f}=(0,ed.b)(),{mutateAsync:m}=(0,F.u3)(u),{mutateAsync:x}=(0,F.Zy)(u),{mutateAsync:h}=(0,F.ER)(u),{directoryUuid:g,directoryName:p,pathComponents:v}=(0,E.useMemo)(()=>{if(!s)return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]};try{return(0,Q.Xp)(s)}catch(e){return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]}}},[s]),j=(0,E.useMemo)(()=>v.length>1||1===v.length&&""!==v[0]?s:void 0,[s,v]),y=(0,E.useCallback)(async e=>{if(!(0,Q.Wx)(e))throw Error("Not a local file: ".concat(e));await (0,eu.xF)(f,d,m,x,e)},[f,d,m,x]),b=(0,E.useCallback)(async e=>{if(!(0,Q.Wx)(e))throw Error("Not a local file: ".concat(e));if(j===e){let t=c.find(t=>t!==e);if(t)n(t);else{let{projectUuid:t,directoryUuid:s,directoryName:a}=(0,Q.Xp)(e);n("file://".concat(t,"/").concat(s,"/").concat(a,"/"))}}await (0,eu.cM)(d,e,h)},[j,d,h,c,n]),w=(0,E.useCallback)(async(e,t)=>{if(!(0,Q.Wx)(e))throw Error("Not a local file: ".concat(e));try{let s=await tv(f,e,t);if(r({event_key:"harmony.file.saved",save_result:s}),"NewFileCreated"===s){let{directoryUuid:t}=(0,Q.Xp)(e),s=f.find(e=>e.uuid===t);s&&await (0,tj.U4)(s),await y(e)}else"FileDeleted"===s&&await b(e);return"NoChange"!==s}catch(t){if(t&&"object"==typeof t&&"name"in t&&(null==t?void 0:t.name)==="AbortError")throw t;return o((0,a.jsxs)(a.Fragment,{children:["Unable to save"," ",(0,a.jsx)("span",{className:"font-bold ml-2",children:$(e)})]})),!1}},[f,r,y,b,o]),_=(0,E.useMemo)(()=>Array.from(new Set([...c,...Array.from(l.values()).flat().filter(e=>"create"===e.type).map(e=>e.contentId)])),[c,l]),N=(0,E.useCallback)(async e=>{let t=new Map;for(let s of _)try{let n=e.get(s);if(!n){q.v("No save options found for contentId ".concat(s,". Skipping save.")),t.set(s,!1);continue}let a=await w(s,n);t.set(s,a)}catch(e){q.v("Error handling file ".concat(s,":"),e),t.set(s,!1)}for(let e of f)await (0,tj.U4)(e);return t},[_,w,f]),C=(0,E.useCallback)(async e=>{if(!(0,Q.Wx)(e))throw Error("Not a local file: ".concat(e));try{var t;return null!==(t=await (0,eu.Jl)(f,e))&&void 0!==t?t:void 0}catch(e){return}},[f]),M=(0,E.useCallback)(async()=>{if(!g)throw Error("No directoryUuid");let e=await (0,tj.sN)(g);if(!e)throw Error("No syncedDirectory");return(await (0,Q.O)(e)).map(e=>e.uri)},[g]);return(0,a.jsx)(tm,{directoryName:null!=p?p:"",isStreaming:t,selectedContentId:j,onClose:i,openedFiles:_,onOpen:y,onSaveContent:w,onSaveAllContents:N,onCloseFile:b,fetchFileContent:C,listFiles:M,children:(0,a.jsx)(tm.Footer,{children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(eq.n,{projectUuid:u,size:"small",tooltipContent:"Total code included in context is currently limited to Claude’s maximum context window size."})})})})};var tb=s(74550),tw=s(69735),t_=s(49167),tN=s(50106),tC=s(21535),tM=s(22027),tk=s(86518);let tS=e=>{let{type:t,size:s,className:n,isLoading:i=!1}=e;return(0,a.jsx)("div",{className:(0,b.Z)("bg-bg-100 text-text-500 flex items-center justify-center rounded-l-[inherit]","default"===s&&"w-14","sm"===s&&"w-11",n),children:i?(0,a.jsx)(te.Loading,{size:"sm"}):(0,a.jsx)(()=>{switch(t){case v.JP.Markdown:return(0,a.jsx)(tN.X,{size:24});case v.JP.Svg:return(0,a.jsx)(tC.j,{size:24});case v.JP.Html:return(0,a.jsx)(tM.T,{size:24});case v.JP.Code:case v.JP.Text:default:return(0,a.jsx)(tk.E,{size:24})}},{})})};var tE=s(98555);let tz=e=>{let{artifact:t,onClick:s,size:n="default"}=e,i=(0,tE.t)(),l=(0,a.jsx)(I.Z,{defaultMessage:"Click to open {artifactType} • {versionCount, plural, one {# version} other {# versions}}",id:"fBoEKmAB/j",values:{artifactType:i[t.type],versionCount:t.versions.length}});return(0,a.jsx)(tI,{previewContent:(0,a.jsx)(tS,{type:t.type,size:n}),title:t.title||(0,a.jsx)(I.Z,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}),metaContent:l,onClick:s,size:n,index:0})},tI=e=>{let{previewContent:t,title:s,metaContent:n,size:i,onClick:l,onRemove:r,index:o}=e,c=(0,z.Z)(),d=l?"button":"div";return(0,a.jsxs)("div",{className:(0,b.Z)("relative","sm"===i&&"max-w-[16rem]"),children:[r&&(0,a.jsx)("button",{className:"bg-bg-000 hover:bg-bg-300 shadow-element absolute right-0 top-0 z-10 -translate-y-2 translate-x-2 cursor-pointer rounded-full p-1",onClick:e=>{e.stopPropagation(),r(o)},children:(0,a.jsx)(ek.X,{size:11,weight:"bold"})}),(0,a.jsxs)(d,{className:(0,b.Z)("border-0.5 border-border-300 bg-bg-000 flex flex-1 items-stretch overflow-hidden rounded-lg text-left transition-all","default"===i&&"w-full",!r&&"hover:border-border-200 hover:drop-shadow-sm",!r&&l&&"active:scale-[0.9875]"),onClick:l,disabled:!l,"aria-label":c.formatMessage({defaultMessage:"Preview contents",id:"hmKJSoIQ4a"}),children:[t,(0,a.jsxs)("div",{className:(0,b.Z)("padding min-w-0 flex-1 pl-3 pr-2","default"===i&&"py-3","sm"===i&&"py-2"),children:[(0,a.jsx)("div",{className:(0,b.Z)("break-words text-sm font-medium leading-tight","default"===i&&"line-clamp-2 font-medium","sm"===i&&"line-clamp-1"),children:s}),n&&(0,a.jsx)("div",{className:"text-text-400 line-clamp-1 text-xs",children:n})]})]})]})};var tZ=s(52165),tT=s(56971),tF=s(45571),tR=s(62576),tA=s(84927),tL=s(62676),tO=s(6092),tD=s(26608),tP=s(74884);let tU=e=>{let{directoryUri:t,removeSyncedDirectory:s,isExpanded:n,setIsExpanded:i}=e,{directoryName:l}=(0,Q.Xp)(t),{files:r}=(0,ed.b)(),o=r.filter(e=>(0,Q.zE)(e)&&e.uri.startsWith(t)).length,c=e=>{e.stopPropagation(),i(e=>!e)};return(0,a.jsxs)("div",{className:(0,b.Z)("group flex items-center gap-2 rounded-lg py-0.5 transition-colors ","lg:hover:bg-bg-500/10"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1 text-left pl-2",onClick:c,children:[(0,a.jsx)(ew.z,{variant:"unstyled",size:"icon_xs",onClick:c,children:n?(0,a.jsx)(tL.P,{size:16}):(0,a.jsx)(tO.g,{size:16})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1 flex flex-col gap-0.5",children:[(0,a.jsx)("div",{className:"line-clamp-2 break-words text-sm",children:l}),(0,a.jsx)("p",{className:"text-xs text-text-400",children:(0,a.jsx)(I.Z,{defaultMessage:"{count, plural, one {# file} other {# files}}",id:"Lf81FX5U/k",values:{count:o}})})]})]}),(0,a.jsx)("div",{className:(0,b.Z)("transition-opacity group-hover:opacity-100","lg:opacity-0"),children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(p.u,{tooltipContent:"Remove directory",children:(0,a.jsx)(ew.z,{size:"icon_sm",variant:"ghost",onClick:()=>s(t),"aria-label":"Remove directory",children:(0,a.jsx)(tD.r,{size:16})})})})})]})},tB=e=>{let{file:t,onSelect:s,closeFile:n}=e,{pathComponents:i}=(0,Q.Xp)(t);return(0,a.jsxs)("div",{className:"group flex items-center flex-1 pl-8 lg:pr-3",children:[(0,a.jsxs)(ew.z,{size:"unset",variant:"unstyled",className:"flex items-center gap-2 flex-1 w-full !justify-start",onClick:s,children:[(0,a.jsx)(tP.E,{}),(0,a.jsx)("div",{className:"text-sm text-text-200 flex items-center gap-[1px]",children:i.map((e,t)=>{let s=i.length-1===t;return(0,a.jsxs)(E.Fragment,{children:[(0,a.jsx)("span",{className:s?"":"text-text-500",children:e},e),!s&&(0,a.jsx)("span",{className:"text-text-400",children:"/"})]},"".concat(e,"-").concat(t))})})]}),(0,a.jsx)("div",{className:(0,b.Z)("transition-opacity group-hover:opacity-100 flex items-center gap-2","lg:opacity-0"),children:(0,a.jsx)(p.u,{tooltipContent:"Close file",children:(0,a.jsx)(ew.z,{size:"icon_sm",variant:"ghost",onClick:n,"aria-label":"Close file",children:(0,a.jsx)(ek.X,{size:16})})})})]})},tH=e=>{let{directory:t,removeSyncedDirectory:s,closeFile:n,onSelect:i}=e,[l,r]=(0,E.useState)(!1),{projectDocs:o}=(0,ed.b)(),c=(0,E.useMemo)(()=>o.filter(e=>(0,eu.lz)(e,t)),[t,o]);return(0,a.jsxs)(w.E.li,{className:"overflow-hidden",exit:{height:0,opacity:0},animate:{height:"auto",opacity:1},children:[(0,a.jsx)(tU,{directoryUri:t.uri,removeSyncedDirectory:s,isExpanded:l,setIsExpanded:r}),(0,a.jsx)(eI.M,{children:l&&c.length>0&&(0,a.jsx)(w.E.ul,{className:"flex flex-col",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:c.map((e,t)=>(0,a.jsx)(w.E.li,{className:"overflow-hidden flex items-center gap-2 py-2 rounded-lg lg:hover:bg-bg-500/10",initial:{opacity:0,y:-2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{delay:.025*t},children:(0,a.jsx)(tB,{file:e.file_name,onSelect:()=>null==i?void 0:i(e.file_name),closeFile:()=>n(e.file_name)})},e.uuid))})})]},t.uri)},tJ=e=>{let{projectUuid:t,syncedDirectories:s,removeSyncedDirectory:n,onSelect:i}=e,{projectDocs:l}=(0,ed.b)(),{mutateAsync:r}=(0,F.ER)(t),o=(0,E.useCallback)(async e=>{await (0,eu.cM)(l,e,r)},[l,r]);return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(tH,{directory:e,removeSyncedDirectory:n,closeFile:o,onSelect:i},e.uri))})};function tW(e){let{dispatchChatResource:t}=e,{projectDocs:s,projectUuid:n,setFiles:i,syncedDirectories:l,setSyncedDirectories:r}=(0,ed.b)(),{mutateAsync:o}=(0,F.ER)(n);return(0,a.jsx)(tJ,{projectUuid:n,syncedDirectories:l,removeSyncedDirectory:async e=>{let t=await (0,eu.wC)(l,s,o,e);r(()=>t),i(await (0,eu.bE)(n))},onSelect:e=>{t({type:"SELECT_SYNCED_DIRECTORY",id:e})}})}let tG=e=>{let{projectUuid:t,dispatchChatResource:s,docUpdates:n}=e,[i,{open:l,close:r}]=(0,e5.q)(!1),{syncedDirectories:o}=(0,ed.b)(),{data:c}=(0,R.Yc)(t);return c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:c.is_harmony_project?(0,a.jsx)(I.Z,{defaultMessage:"Local code",id:"kQFHMn6wNL"}):(0,a.jsx)(I.Z,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,a.jsxs)("div",{className:(0,b.W)("border-border-400 rounded-lg border",c.is_harmony_project?"px-1 pt-0.5 pb-2":"px-3 py-4"),children:[!c.is_harmony_project&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(k.default,{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,a.jsx)(tC.j,{size:16,className:"text-text-300 shrink-0"}),(0,a.jsx)("div",{className:"font-tiempos text-text-200 leading-tight tracking-tight",children:c.name})]}),(0,a.jsx)("div",{children:(0,a.jsx)(tA.H,{project:c,className:"text-text-400 text-xs"})})]}),(0,a.jsx)("ul",{className:"mt-2 flex flex-col",children:o.length>0?(0,a.jsx)(tW,{dispatchChatResource:s}):(0,a.jsx)(tR.U,{isEditable:!1,project:c,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]}),""]}):null};function tq(e){let{conversationUUID:t,onClose:s,projectUuid:n}=e,{allModelOptions:i}=(0,c.uL)(),{chatResourceState:{artifacts:l,attachments:r,files:d,syncSources:u,docUpdates:f},dispatchChatResource:m}=(0,J.Y)(),x=(0,o.wN)(t),h=i.find(e=>e.model===x),{modelConfig:g}=(0,c.Ve)(x),p=g.image_in,{imageFiles:v,sanitizedDocumentFiles:y,blobFiles:b}=(0,E.useMemo)(()=>d.reduce((e,t)=>{switch(t.file_kind){case eg.Y.Image:e.imageFiles.push(t);break;case eg.Y.Blob:e.blobFiles.push(t);break;case eg.Y.SanitizedDocument:e.sanitizedDocumentFiles.push(t)}return e},{imageFiles:[],blobFiles:[],sanitizedDocumentFiles:[]}),[d]),w=Object.values(l),{value:_}=(0,j.FL)("conversation_export"),N=(0,a.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-5 text-center",children:[(0,a.jsx)("div",{className:"font-tiempos mb-1",children:(0,a.jsx)(I.Z,{defaultMessage:"No content added yet",id:"KWvxczfvCc"})}),(0,a.jsx)("div",{className:"text-text-300 mb-1 text-xs",children:p?(0,a.jsx)(I.Z,{defaultMessage:"Add images, PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"HJx5jgEsVM"}):(0,a.jsx)(I.Z,{defaultMessage:"Add PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"J0WpDuvvlE"})})]});return(0,a.jsx)(t_.$,{children:(0,a.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,a.jsxs)("div",{className:"flex items-center draggable pl-7 md:pl-1 pr-0.5",children:[(0,a.jsx)("h2",{className:"font-styrene-display flex-1 text-lg font-medium",children:(0,a.jsx)(I.Z,{defaultMessage:"Chat controls",id:"nBvhDBTi6q"})}),(0,a.jsx)(ew.z,{variant:"ghost",size:"icon",className:"-mr-2",onClick:s,children:(0,a.jsx)(ek.X,{size:20})})]}),h&&(0,a.jsxs)("div",{className:"my-2",children:[(0,a.jsx)("div",{className:"text-text-200 text-lg",children:(0,a.jsx)(tZ.u,{model:h})}),(0,a.jsxs)("p",{className:"text-text-300 text-sm",children:[h.description,"\xa0",(0,a.jsx)("a",{className:"hover:text-text-000 underline",href:"https://www.anthropic.com/product",target:"_blank",rel:"noopener",children:(0,a.jsx)(I.Z,{defaultMessage:"Learn more",id:"TdTXXf940t"})})]})]}),w.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,a.jsx)(I.Z,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,a.jsx)("ul",{className:"mt-2 flex flex-col gap-2",children:w.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(tz,{artifact:e,onClick:()=>m({type:"SELECT_ARTIFACT",id:e.id})})},"artifact-".concat(t)))})]}),n&&(0,a.jsx)(tG,{projectUuid:n,dispatchChatResource:m,docUpdates:f}),(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,a.jsx)(I.Z,{defaultMessage:"Content",id:"Jq3FDzj0/T"})}),v.length+b.length+y.length+r.length+u.length>0?(0,a.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[[...v,...b,...y].map((e,t)=>(0,a.jsx)(tw.mB,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),r.map((e,t)=>(0,a.jsx)(tw.mB,{size:"stretch",file:e,handleClick:()=>m({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),u.map(e=>(0,a.jsx)(tT.n4,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]}):N,_&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-text-300 mb-2 mt-5 text-sm font-medium",children:(0,a.jsx)(I.Z,{defaultMessage:"Export conversation",id:"GZQU9SwGHT"})}),(0,a.jsx)(tF.Dy,{conversationUUID:t})]})]})})}let tK=e=>{let{docUuid:t,projectUuid:s,goBack:n,onClose:i}=e,{data:l}=(0,F.tR)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:eg.i.UserUpload};return(0,a.jsx)(tb.c,{attachment:r,goBack:n,onClose:i})},tV=(0,E.memo)(function(e){let{conversationUUID:t,onClose:s,isStreaming:n,projectUuid:i,sendMessage:l,isOpen:r}=e,{activeOrganization:o}=(0,f.t)(),{addError:c}=(0,ej.e)(),{chatResourceState:{selectedItem:d,artifacts:u,activeMessageUUID:m,docUpdates:x,attachments:h,fileEdits:g,files:p},dispatchChatResource:v}=(0,J.Y)(),{value:y}=(0,j.FL)("apps_use_turmeric"),b=null==o?void 0:o.uuid,w=(0,E.useCallback)(e=>v({type:"SELECT_SYNCED_DIRECTORY",id:e}),[v]),_=(0,E.useCallback)(e=>(0,ev.C)({prompt:e,appsUseTurmeric:y,orgUuid:b,onRateLimitError:()=>{c((0,a.jsx)(I.Z,{defaultMessage:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets.",id:"5Ocu9uCFLz"}))}}),[y,b,c]),N=(0,ep.i)(h,p,b,i),C=(0,E.useMemo)(()=>({claudeComplete:_,getFile:N}),[_,N]),M=(0,E.useCallback)(()=>{s()},[s]),k=(0,E.useCallback)(e=>{(null==d?void 0:d.type)==="artifact"&&v({type:"SELECT_ARTIFACT",id:d.id,versionUUID:e})},[d,v]),{changesMode:S}=(0,B.s)(),z=(0,E.useCallback)(e=>v({type:"SELECT_DOC",id:e}),[v]),Z=(0,E.useCallback)(()=>v({type:"CLEAR_SELECTED"}),[v]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ey.K0,{isStreaming:n,artifact:(null==d?void 0:d.type)!=="artifact"||S?void 0:u[d.id],selectedArtifactMessageUUID:m,selectedArtifactVersionUUID:(null==d?void 0:d.type)==="artifact"?d.versionUUID:void 0,setSelectedArtifactVersionUUID:k,onClose:s,projectUuid:i,selectDoc:z,sendMessage:l,richSandboxCapabilities:C,isOpen:r}),i&&(0,a.jsx)(ty,{isStreaming:n,directoryUri:d&&"id"in d?d.id:void 0,selectUri:w,onClose:M,suggestedChanges:g}),(null==d?void 0:d.type)==="artifact"&&u[d.id]?null:(null==d?void 0:d.type)==="syncedDirectory"||S?null:(null==d?void 0:d.type)==="attachment"?(0,a.jsx)(tb.c,{goBack:()=>v({type:"CLEAR_SELECTED"}),attachment:d.attachment,onClose:s}):(null==d?void 0:d.type)==="compass"?(0,a.jsx)(eB,{data:d.data,onClose:s,goBack:Z}):i&&(null==d?void 0:d.type)==="doc"?(0,a.jsx)(tK,{docUuid:d.id,projectUuid:i,onClose:s,goBack:()=>v({type:"CLEAR_SELECTED"})}):(0,a.jsx)(tq,{conversationUUID:t,onClose:s,projectUuid:i})]})});var tY=s(5751);function tX(e){let{conversationUuid:t,message:s}=e,n=(0,S.useRouter)(),i=(0,ej.e)(),[l,r]=(0,E.useState)(!1);return(0,a.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-styrene z-10 p-6 ",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,a.jsx)("div",{className:"text-lg",children:(0,a.jsx)(I.Z,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(ew.z,{onClick:()=>n.push("/new"),children:(0,a.jsx)(I.Z,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,a.jsx)(ew.z,{variant:"secondary",onClick:()=>r(!0),children:(0,a.jsx)(I.Z,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,a.jsx)(tY.r,{conversationUuid:t,message:s,requestedFeedbackType:"chat_ended",setRequestedFeedbackType:()=>{},isOpen:l,onClose:()=>{r(!1)},onSuccess:()=>i.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var tQ=s(22639),t$=s(7418),t0=s(5362),t1=s(98731),t2=s(5492),t5=s(81353),t3=s(8571),t4=s(6385),t6=s(59016);function t7(){let e=(0,n._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return t7=function(){return e},e}let t8=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],t9=e=>{let{long:t}=e;return(0,a.jsx)("a",{className:"underline",href:t4.jW,target:"_blank",rel:"noreferrer",children:t?(0,a.jsx)(I.Z,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,a.jsx)(I.Z,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},se={consumer_restricted_mode:[{isDismissible:!1,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,a.jsx)(t9,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,a.jsx)(t9,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.Z,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,a.jsx)(t9,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(I.Z,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(I.Z,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(I.Z,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function st(e){let{isClaudeDot:t,content:s,isDismissible:n,handleDismiss:i}=e;return(0,a.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,a.jsx)(sn,{$isFloating:t,children:(0,a.jsxs)("div",{className:"items-top flex justify-between",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:s}),n&&i&&(0,a.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,a.jsx)(ek.X,{size:24})})]})})})}function ss(e){let{conversationUuid:t}=e,s=(0,eK.z$)(),n=(0,t3.Zx)(),{account:i,activeOrganization:l}=(0,f.t)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:c}=(0,t6.CQ)(),{data:d}=(0,t6.$r)(null==l?void 0:l.uuid),u=(0,t3.mX)().ipCountry,m=(null==d?void 0:d.active_flags)&&(null==d?void 0:d.active_flags.map(e=>e.type)),{shownFlagType:x,shownFlagDetails:h}=function(e,t){let s=t8.findIndex(e=>null==t?void 0:t.includes(e)),n=t8[s];if(!n)return{shownFlagType:null,shownFlagDetails:null};let a=se[n].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===a.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:n,shownFlagDetails:a[0]}}(u,m);if((0,E.useEffect)(()=>{r&&o&&x&&s.track({event_key:"ts.banner.shown",flag_type:x,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,x,t,r,o,u]),!x||!h)return;let{isDismissible:g,content:p}=h,v=async()=>{if(!g)return;let e=[x];"consumer_second_warning"===x&&(null==m?void 0:m.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>c({flagType:e})))};return(0,a.jsx)(st,{isClaudeDot:n,content:p,isDismissible:g,handleDismiss:v})}let sn=h.q.div(t7(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var sa=s(13935),si=s(76203),sl=s(9014),sr=s(52884),so=s(14584),sc=s(56685);let sd=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],su=new Map([["apps_and_websites",sa.P],["documents_and_templates",si.$],["games",sl.g],["productivity_tools",sr.B],["creative_projects",so.Y],["quiz_or_survey",sc.b],["start_from_scratch",e4.F]]),sf=e=>{var t;let{selectedLabel:s,disabled:n}=e,i=(0,z.Z)(),{track:l}=(0,eK.z$)(),r=new Map([["apps_and_websites",i.formatMessage({defaultMessage:"Apps and Websites",id:"YGAqByCKVC"})],["documents_and_templates",i.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",i.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",i.formatMessage({defaultMessage:"Productivity Tools",id:"NGDnpkwlJC"})],["creative_projects",i.formatMessage({defaultMessage:"Creative Projects",id:"9pYbauoGRg"})],["quiz_or_survey",i.formatMessage({defaultMessage:"Quiz or Survey",id:"sO8uEgy+Hx"})],["start_from_scratch",i.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),o=new Map(Array.from(r,e=>e.reverse())),{sendTransparentMessage:c}=(0,tQ.r)(),d=null!==(t=o.get(null!=s?s:""))&&void 0!==t?t:"default",u=async e=>{r.has(e)&&(l({event_key:"artifact.studio.create_mode_selected",create_mode:e}),await c(r.get(e)))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-claude-message pl-2 mt-1",children:(0,a.jsx)(I.Z,{defaultMessage:"Let’s get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-center w-full",children:sd.map(e=>{let t=su.get(e);return(0,a.jsx)("div",{className:(0,b.Z)("relative w-full h-28 p-3 text-sm bg-bg-000 rounded-xl transition-colors",d===e&&"border border-accent-secondary-100 text-accent-secondary-100 font-medium",("default"!==d&&d!==e||"default"===d&&n)&&"text-text-500","default"===d&&!n&&"border border-border-300 text-text-300 hover:border-accent-secondary-100 hover:text-accent-secondary-100 hover:font-medium cursor-pointer"),onClick:async()=>{"default"!==d||n||await u(e)},children:(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)("span",{children:r.get(e)}),(0,a.jsx)("div",{className:"absolute bottom-3 right-3 text-inherit",children:t&&(0,a.jsx)(t,{size:24,weight:"light"})})]})},e)})})]})},sm=e=>{var t,s,n,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:c,invalidator:d}=e,[u,f]=(0,E.useState)(0),m=(0,E.useCallback)(()=>{var e,t,s,n;let a=(null===(e=l.lastAssistantMessage.current)||void 0===e?void 0:e.clientHeight)||0,i=(null===(t=l.lastHumanMessage.current)||void 0===t?void 0:t.clientHeight)||0,r=(null===(s=l.chatInput.current)||void 0===s?void 0:s.clientHeight)||0,o=(null===(n=l.extras.current)||void 0===n?void 0:n.clientHeight)||0,c=Math.max(window.innerHeight-i-a-o-r-110,0);c!==u&&f(c)},[l,u]);return(0,E.useLayoutEffect)(()=>{m()},[d,m,null===(t=l.lastAssistantMessage.current)||void 0===t?void 0:t.clientHeight,null===(s=l.lastHumanMessage.current)||void 0===s?void 0:s.clientHeight,null===(n=l.extras.current)||void 0===n?void 0:n.clientHeight,null===(i=l.chatInput.current)||void 0===i?void 0:i.clientHeight]),(0,E.useLayoutEffect)(()=>(window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)),[m]),(0,E.useLayoutEffect)(()=>{r&&(setTimeout(()=>{var e;null===(e=c.current)||void 0===e||e.scrollToBottomIfPinned("smooth")},0),o(!1))},[r,o,c]),(0,E.useEffect)(()=>{var e;null===(e=c.current)||void 0===e||e.scrollToBottomIfPinned("instant")},[c]),(0,a.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function sx(){return(0,a.jsx)(w.E.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-500 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,a.jsxs)("h2",{className:"font-tiempos leading-12 flex flex-col items-center justify-center gap-2 text-2xl font-medium tracking-tighter sm:flex-row sm:text-3xl",children:[(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(g.p,{state:"waiting"})}),(0,a.jsx)(I.Z,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var sh=s(72590);let sg="/Spark/",sp=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],sv="".concat(sg,"/Check.svg"),sj=Z.z.object({changeTitle:Z.z.boolean().optional(),titleDelayMs:Z.z.number().optional(),changeFavicon:Z.z.boolean().optional(),faviconDelayMs:Z.z.number().optional(),playSound:Z.z.boolean().optional()}),sy={},sb=()=>{let e=(0,E.useRef)(null),t=(0,E.useRef)(!1);(0,E.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,E.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null===(s=e.current)||void 0===s||s.play()}}},[]),n=(0,E.useCallback)(()=>{t.current=!1},[]);return(0,E.useMemo)(()=>({playSound:s,resetSound:n}),[s,n])},sw=(e,t,s)=>{let n=(0,E.useRef)(null),a=(0,E.useCallback)(()=>{n.current&&(clearInterval(n.current),n.current=null),document.title="Working on it..."},[]),i=(0,E.useCallback)(()=>{if(n.current)return;let t=0;n.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,E.useCallback)(()=>{n.current&&(clearInterval(n.current),n.current=null),document.title=t},[t]);return(0,E.useMemo)(()=>({setThinkingTitle:a,setReceivedTitle:i,resetTitle:l}),[a,i,l])},s_=e=>{let t=(0,E.useRef)(null),s=(0,E.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),n=(0,E.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),a=(0,E.useCallback)(()=>{if(t.current)return;let n=0;t.current=setInterval(()=>{s("".concat(sg,"/").concat(sp[n],".svg")),n=(n+1)%sp.length},e)},[e,s]),i=(0,E.useCallback)(()=>{n(),s(sv)},[s,n]);return(0,E.useMemo)(()=>({setWritingFavicon:a,setCompleteFavicon:i,resetFavicon:n}),[a,i,n])},sN=(e,t,s)=>{let n=(0,j.Zr)("claude_ai_tabbed_out_notifications","features",sy,sj),a="visible"===(0,sh.x)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=sw(["Ready to chat",e],e,n.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:c,resetFavicon:d}=s_(n.faviconDelayMs||100),{playSound:u,resetSound:f}=sb(),m=(0,E.useRef)(!1);(0,E.useEffect)(()=>{let e=t&&s,x=!t&&s,h=!t&&!s;e&&!m.current&&(m.current=!0);let g=h&&m.current;if(g&&(m.current=!1),a){n.changeTitle&&r(),n.changeFavicon&&d();return}n.changeTitle&&(e||x?i():g&&l()),n.changeFavicon&&(x?o():g&&(c(),m.current=!1)),n.playSound&&(e?f():g&&u())},[n,t,s,a,i,l,r,o,c,d,u,f])};var sC=s(90359),sM=s(64452);function sk(){let e=(0,n._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return sk=function(){return e},e}let sS=()=>{let[e,t]=(0,E.useState)(""),s=(0,z.Z)(),n=(0,E.useMemo)(()=>[s.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),s.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),s.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[s]),i=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[s]),l=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[s]);return(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(n[Math.floor(Math.random()*n.length)])},5e3);return()=>clearTimeout(e)},[n]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(i)},15e3);return()=>clearTimeout(e)},[i]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(l)},3e4);return()=>clearTimeout(e)},[l]),(0,a.jsx)(w.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-tiempos text-text-300 ml-2 pb-1.5 text-sm italic",children:e})};function sE(e){var t,s,n,h,w,_,q,K,V,Y,X,$,ee,et,es;let{changeDisplayedConversationPath:ea,conversationTitle:ec,conversationUUID:eg,editMessage:ep,isStreaming:ev,isLoading:ej,messages:ey,name:eb,onRetry:ew,onSend:e_,customFileUploadHandler:eN,projectUuid:eC,setPersonalizedStyleCallback:eM,onToolAllow:ek}=e,{account:eS,activeOrganization:eE}=(0,f.t)(),{selectedTier:ez}=(0,x.i)(),eI=(0,m.T)(),eZ=(0,z.Z)(),{value:eT}=(0,j.FL)("new_scroll_behavior"),eF=(0,E.useRef)(null),eR=(0,E.useRef)();eR.current=null===(t=ey[ey.length-1])||void 0===t?void 0:t.uuid;let{projectHasHarmony:eA}=(0,er.Y)(eC),{openedFiles:eL,projectDocs:eO}=(0,ed.b)(),{getInstance:eD}=(0,B.s)(),{chatResourceState:eP,dispatchChatResource:eU}=(0,J.Y)(),{mutateAsync:eB}=(0,F.u3)(eC),{mutateAsync:eH}=(0,F.Zy)(eC),{serverLastChatMessageWarningProps:eJ,updateServerLastChatMessageWarningPropsForNewMessage:eW}=function(e,t){let[s,n]=(0,E.useState)(null),a=function(e){let{activeOrganization:t}=(0,f.t)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:n}=(0,t0.uC)(s,"POST",{meta:{noToast:!0}});return(0,E.useCallback)(async e=>{let t=await n(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[n])}(e),i=(0,E.useCallback)(e=>{async function t(){try{n(await a(e))}catch(e){}}n(null),t()},[a]),l=(0,E.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==r.QC?s:null}})},[i]);return function(e){let{chatMessages:t,onLastMessageLoaded:s}=e,n=(0,E.useRef)(t.filter(e=>"human"===e.sender).pop());(0,E.useEffect)(()=>{if(!n.current)return;let e=(0,t1.K)(n.current);e&&s({uuid:n.current.uuid,messageText:e})},[s])}({chatMessages:t,onLastMessageLoaded:(0,E.useCallback)(e=>{let{uuid:t,messageText:s}=e;i({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[i])}),{serverLastChatMessageWarningProps:s,updateServerLastChatMessageWarningPropsForNewMessage:l}}(eg,ey),{setSandboxState:eG}=(0,l.r)(),eq=(0,S.useSearchParams)(),[eK,eV]=(0,E.useState)(!1),[eY,eX]=(0,E.useState)(null),eQ={lastAssistantMessage:(0,E.useRef)(null),lastHumanMessage:(0,E.useRef)(null),chatInput:(0,E.useRef)(null),extras:(0,E.useRef)(null),extraSpace:(0,E.useRef)(null)},e$=(0,eh.g)(),e0=(0,E.useMemo)(()=>{},[e$,null==eE?void 0:eE.uuid,eg]),e1=(0,E.useRef)(null),e2=(0,E.useCallback)(async e=>{let{prompt:t,attachments:s,files:n,syncSources:a,personalized_style:i,compass_mode:l}=e;if(ev)return;eU({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eW({messageText:t,parentMessageUuid:eR.current}),eG(eg,{conversationFiles:[...eP.files,...n],allAttachments:[...eP.attachments,...s],projectUuid:eC});let o={prompt:t,attachments:s,files:n,syncSources:a,rethrowErrors:!0,parent_message_uuid:eR.current||r.QC,personalized_style:i,org_type_override:null!=ez?ez:void 0,compass_mode:l};eV(!0),await e_(o)},[ev,eU,eW,eG,eg,eP.files,eP.attachments,e_,eC,ez]),e5=(0,E.useCallback)(async()=>{eA&&eC&&await (0,eu.ec)(eL,eC,eO,eB,eH,eD)},[eA,eL,eC,eO,eB,eH,eD]),e3=(0,E.useCallback)(async(e,t)=>{eU({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),await e5(),eG(eg,{conversationFiles:eP.files,allAttachments:eP.attachments,projectUuid:eC}),ew(e,t)},[eU,e5,eG,eg,eP.files,eP.attachments,ew,eC]),e4=(0,E.useCallback)(async()=>{if(ev)return;let e=eZ.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await e_({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eR.current||r.QC})},[eZ,ev,eR,e_]),e6=(0,E.useCallback)(async(e,t)=>{ep&&(eU({type:"CLEAR_SELECTED"}),await e5(),ep(e,t),eW({messageText:t,parentMessageUuid:e.parent_message_uuid}))},[e5,eU,ep,eW]),e8=(0,E.useMemo)(()=>(0,M.Z)(),[]);(0,E.useEffect)(()=>(e8.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;e3(t,s)}),e8.on("edit",e=>{let{message:t,text:s}=e;e6(t,s)}),()=>{e8.off("retry"),e8.off("edit")}),[e8,e3,e6]);let[e9,te]=(0,E.useState)("");(0,E.useEffect)(()=>{ev||te(ey.map(e=>(0,i.OD)(e)).join(" "))},[ey,ev]);let tt=(0,u.c)(e9),{files:ts,attachments:tn,artifacts:ta}=eP,{isDrawerExpanded:ti,setIsDrawerExpanded:tl}=(0,e7.b)(),tr=(0,E.useCallback)(()=>{eU({type:"CLEAR_SELECTED"}),tl(!0)},[eU,tl]),to=(0,E.useCallback)(()=>{tl(!1)},[tl]),tc=(0,sM.D)(ey);(0,E.useEffect)(()=>{eU({type:"UPDATE_FILES",files:tc})},[tc,eU]),(0,E.useEffect)(()=>{eU({type:"UPDATE_ATTACHMENTS",attachments:ey.flatMap(e=>e.attachments)})},[eU,ey]),(0,E.useEffect)(()=>{eU({type:"UPDATE_SYNC_SOURCES",syncSources:ey.flatMap(e=>e.sync_sources)})},[eU,ey]);let td=(0,E.useCallback)(e=>{tr(),eU({type:"SELECT_ATTACHMENT",attachment:e})},[eU,tr]),tu=(0,E.useMemo)(()=>!!((null==eI?void 0:eI.preview_feature_uses_artifacts)||ey.some(e=>em(e))),[eI,ey]),tf=(0,E.useCallback)((e,t,s)=>{tr(),eU({type:"SELECT_ARTIFACT",id:e,versionUUID:s}),eU({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[eU,tr]),tm=ey[ey.length-1];(0,E.useEffect)(()=>{if(!tu)return;let e={};ey.forEach(t=>{(0,v.HZ)(t).forEach(t=>{var s,n,a;let{id:i,currentVersion:l,type:r,title:o,language:c}=t,d=(0,v.tE)(l,null===(a=e[i])||void 0===a?void 0:null===(n=a.versions)||void 0===n?void 0:null===(s=n.slice(-1)[0])||void 0===s?void 0:s.resultState),u={...l,resultState:d};e[i]?e[i].versions.push(u):e[i]={id:i,type:r||"document",title:o||"Untitled",language:c||void 0,versions:[u]}})}),eU({type:"UPDATE_ARTIFACTS",artifacts:e})},[ey,tu,tm,eU]);let tx=tm?(0,v.HZ)(tm):[],th=null!==(ee=N()(tx))&&void 0!==ee?ee:null,tg=null!==(et=null==th?void 0:th.id)&&void 0!==et?et:null,tp=(0,E.useRef)({lastOpenedArtifactId:null});(0,E.useEffect)(()=>{let e=tp.current.lastOpenedArtifactId===tg;ev&&tg&&!e&&(tp.current.lastOpenedArtifactId=tg,tf(tg))},[ev,tg,tf]),(0,E.useEffect)(()=>{let e=eq.get("artifactId");e&&(tr(),eU({type:"SELECT_ARTIFACT",id:e}))},[]),function(e){let{lastMessage:t,projectUuid:s}=e,{getInstance:n,setMergeState:a,rejectAllChanges:i}=(0,B.s)(),{projectHasHarmony:l}=(0,er.Y)(s),{dispatchChatResource:o}=(0,J.Y)(),c=(0,E.useRef)(""),d=(0,E.useRef)(0),u=(0,E.useRef)(!1),f=(0,E.useMemo)(()=>{var e;return(null==t?void 0:null===(e=t.content)||void 0===e?void 0:e.filter(e=>"tool_use"===e.type&&["str_replace","update_file","create_file","delete_file"].includes(e.name)))||[]},[null==t?void 0:t.content]),m=(0,E.useCallback)((e,t)=>{if("tool_use"!==e.type)return null;let s=e.partial_json?(0,H.g)(e.partial_json||""):e.input;if(!s||"object"!=typeof s)return null;let a=eo.safeParse(s);if(!a.success)return null;let i=a.data.path;if(!(0,Q.Wx)(i))return null;switch(e.name){case"str_replace":return{contentId:i,changeType:"edit",state:{currentContent:t,changes:[{type:"edit",contentId:i,originalHash:a.data.original_hash||"",oldStr:a.data.old_str||"",newStr:a.data.new_str||""}]}};case"update_file":{let e=n(i),s=null==e?void 0:e.view;if(!s)return null;let l={type:"update",contentId:i,originalHash:a.data.original_hash||"",newText:a.data.file_text||""};return ei(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]}}}case"create_file":{let e={type:"create",contentId:i,newText:""},s=n(i);return(null==s?void 0:s.view)&&ei(s.view,{...e,newText:a.data.file_text||""}),{contentId:i,changeType:e.type,state:{currentContent:t,changes:[]},suggestedChange:e}}case"delete_file":{let e=n(i),s=null==e?void 0:e.view,l={type:"delete",contentId:i,originalHash:a.data.original_hash||""};return s&&ei(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]},suggestedChange:l}}default:return null}},[n]),x=(0,E.useCallback)((e,t)=>{let s=n(e),i=null==s?void 0:s.view;i&&(a(e,{isActive:!0,diffSource:t.currentContent}),t.changes.length>0&&function(e,t,s){let n=s;if(t.forEach(e=>{let{oldStr:t,newStr:s}=e;n=n.replace(t,s)}),n!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:n},annotations:[G.YW.addToHistory.of(!1)]});try{en(e,(0,W.gO)(e.state).toString(),!0)}catch(e){}}}(i,t.changes,t.currentContent))},[n,a]);(0,E.useEffect)(()=>{if(!l||!(null==t?void 0:t.content)||(null==t?void 0:t.uuid)!==r.FC)return;f.length>0&&0===d.current&&!u.current?(i(),o({type:"UPDATE_FILE_EDITS",edits:new Map}),u.current=!0):0===f.length&&(u.current=!1),d.current=f.length;let e=f.map(e=>{if("tool_use"!==e.type)return"";let{name:t,partial_json:s,input:n}=e;return"".concat(t,":").concat(s||JSON.stringify(n))}).join("|");if(e===c.current)return;c.current=e;let s=new Map;f.reduce((e,t)=>{if("tool_use"!==t.type)return e;let a=t.partial_json?(0,H.g)(t.partial_json||""):t.input;if(!a||"object"!=typeof a)return e;let i=eo.safeParse(a);if(!i.success)return e;let l=i.data.path;if(!(0,Q.Wx)(l))return e;let r=n(l),o=m(t,r?(0,el.li)(r):"");if(!o)return e;if(o.suggestedChange){let e=s.get(o.contentId)||[];s.set(o.contentId,[...e,o.suggestedChange])}let c=e.get(o.contentId);return c?e.set(o.contentId,{currentContent:c.currentContent,changes:[...c.changes,...o.state.changes]}):(e.set(o.contentId,o.state),e)},new Map).forEach((e,t)=>{x(t,e)}),s.size>0&&o({type:"UPDATE_FILE_EDITS",edits:s})},[l,f,m,x,t,i,o,n])}({lastMessage:tm,projectUuid:eC});let tv=ev&&tm&&tm.content?tm.content[tm.content.length-1]:void 0,tj=ev&&(!tm||!(null===(s=tm.content)||void 0===s?void 0:s[0])&&0===tm.attachments.length&&0===tm.files.length&&0===tm.files_v2.length),ty=tv&&("tool_use"===tv.type||"tool_result"===tv.type),tb=(0,E.useMemo)(()=>{if(tm)return function(e){let t=ex(e);if(!t)return;let s=t.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:n}=ef.Xd.safeParse(s);return null==n?void 0:n.task_id}(tm)},[tm]),tw=!ev&&void 0!==tb,{compassStatus:t_}=(0,P.Oz)({organizationUUID:null==eE?void 0:eE.uuid,conversationUUID:eg,taskId:tb,isShared:!1,enabled:tw}),tN=(0,E.useMemo)(()=>{if(!tm)return!1;let e=ex(tm);return!!(e&&!e.is_error&&(0,y.Ml)(null==t_?void 0:t_.status)&&!em(tm))},[tm,t_]),tC=(0,U.Qc)(),tM=(0,U.NF)(),{value:tk}=(0,j.FL)("compass_enable_notifications_web"),tS=(0,E.useMemo)(()=>tj?"thinking":ty||tN?"shimmer":ev?"writing":"static",[tj,ty,ev,tN]);sN(ec,tj,ev);let{getCreateParamsForConvo:tE}=(0,d.b)();(0,E.useEffect)(()=>{if(ej)return;let e=tE(eg);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&e2(e)},[eg,e2,tE,ej]);let{data:tz}=(0,R.Yc)(eC),tI=(0,L.U)(),tZ=(0,A.nR)(eC),{publishedArtifactsByMessageUuid:tT}=(0,T.L1)({includeDeletedArtifacts:!0}),{mutate:tF,isPending:tR}=(0,i.gK)(eg),tA=(0,d.w)(),tL=(0,E.useCallback)((e,t)=>{eU({type:"CLEAR_SELECTED"}),null==ea||ea(e,t)},[ea,eU]),tO=(0,o.wN)(eg);(0,t$.j)(eg);let tD=null==tm?void 0:null===(n=tm.content)||void 0===n?void 0:n.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),{activeModelOptions:tP}=(0,c.uL)(),tU=Z.z.array(Z.z.string()),tB=(0,j.Zr)("invite_contest_name","model_prefixes",[],tU),{data:tH}=(0,i.m)();(0,E.useEffect)(()=>{var e,t;if(!ev&&2===ey.length&&(null===(e=ey[0])||void 0===e?void 0:e.sender)==="human"&&(null===(t=ey[1])||void 0===t?void 0:t.sender)==="assistant"&&tB.some(e=>null==tO?void 0:tO.startsWith(e))&&tH&&tH.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUUID:eg,model:tO}});window.dispatchEvent(e)}},[ev,ey,tO,eg,tB,tH]);let tJ=(0,E.useMemo)(()=>{let e=eZ.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tP.find(e=>e.model===tO);if(!t||!t.knowledgeCutoff)return e;let s=C.ou.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return eZ.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:eZ.locale});return eZ.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tO,tP,eZ]),tW=(0,E.useMemo)(()=>ta,[!ev&&ta]),tG=ti&&eP.selectedItem?eP.selectedItem:void 0,tq=(0,E.useCallback)(e=>(0,a.jsx)(sC.P,{...e,conversationUUID:eg,artifacts:tW,onOpenArtifact:tu?tf:void 0,onAllow:e.isLastMessage&&!e.toolResult?ek:void 0,selectedDrawerItem:tG}),[eg,tW,tu,tf,ek,tG]),tK=(0,E.useCallback)(()=>{eX({})},[]),tY=(0,E.useMemo)(()=>({id:eg,messagesSoFar:ey.length,tokensSoFar:tt,files:ts,attachmentsSoFar:tn.length,isSampling:ev,isStoppingSampling:tR,model:tO,projectKnowledgebaseTokens:null!=tZ?tZ:0,conversationSettings:eI}),[tn.length,eI,tt,eg,ts,tR,ev,ey.length,tO,tZ]),t3=(0,E.useMemo)(()=>tm&&"assistant"===tm.sender&&tm.content&&tm.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[tm]),t4=(0,E.useCallback)(()=>{tF()},[tF]);return eS?(0,a.jsx)(t2.g,{autoscrollDisabled:eT||0===ey.length,autoscrollRef:eF,mainElement:(0,a.jsx)(tQ.x,{conversation:tY,projectUuid:eC,onSend:e2,onCreate:tA,onStopSampling:t4,setPersonalizedStyleCallback:eM,customFileUploadHandler:e0||eN,children:(0,a.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,a.jsx)(ss,{conversationUuid:eg}),ej?(0,a.jsx)(sz,{className:"pt-2",children:(0,a.jsx)(D.U,{})}):0===ey.length?(0,a.jsx)(a.Fragment,{children:(null==tY?void 0:null===(h=tY.conversationSettings)||void 0===h?void 0:h.create_mode)?(0,a.jsx)(sz,{className:"pt-1",children:(0,a.jsx)(sf,{})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(sx,{}),(0,a.jsx)(sz,{})]})}):(0,a.jsxs)(sz,{className:"pt-1",children:[(null==tY?void 0:null===(w=tY.conversationSettings)||void 0===w?void 0:w.create_mode)&&(0,a.jsx)(sf,{selectedLabel:(null==ey?void 0:null===(K=ey[0])||void 0===K?void 0:null===(q=K.content)||void 0===q?void 0:null===(_=q[0])||void 0===_?void 0:_.type)==="text"?null==ey?void 0:null===(X=ey[0])||void 0===X?void 0:null===(Y=X.content)||void 0===Y?void 0:null===(V=Y[0])||void 0===V?void 0:V.text:void 0,disabled:ey.length>0}),(0,a.jsx)(t5.w,{renderToolUseCell:tq,children:ey.map((e,t)=>(0,a.jsx)(D.J,{lastHumanMessageRef:eQ.lastHumanMessage,lastAssistantMessageRef:eQ.lastAssistantMessage,previousMessage:t>0?ey[t-1]:void 0,message:e,conversationUUID:eg,conversationSettings:eI,isStreaming:ev,isLastMessage:t===ey.length-1,isLastHumanMessage:t===ey.length-2,isFirstAssistantMessage:1===t&&"assistant"===e.sender,messageWarningProps:t===ey.length-1&&eJ||void 0,onOpenArtifact:tu?tf:void 0,selectAttachment:td,changeDisplayedConversationPath:tL,editable:!0,publishedArtifacts:null==tT?void 0:tT[e.uuid],onResize:tK,actionEmitter:e8,onSendContinue:e4,isResearchPending:tN},t))}),(0,a.jsx)("div",{ref:eQ.extras,children:(0,a.jsxs)("div",{className:(0,b.Z)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",ev&&"-translate-y-2.5"),children:[(0,a.jsx)("div",{className:"p-1 -translate-x-px",children:(0,a.jsx)(g.p,{state:tS})}),2===ey.length&&ev&&(null===($=ey[1])||void 0===$?void 0:$.content)&&0===ey[1].content.length?(0,a.jsx)(sS,{}):null,(0,a.jsx)("div",{className:(0,b.Z)("text-text-400 pt-5 flex-1 text-right text-[0.65rem] leading-[0.85rem] tracking-tighter sm:text-[0.75rem]",ev&&"pointer-events-none"),children:tN&&tk?(0,a.jsx)("div",{className:"inline-block select-none",children:"default"===tC?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:(0,a.jsx)(I.Z,{defaultMessage:"Research takes time. Claude can let you know when it’s done.",id:"sPgKzf0LZ9"})}),(0,a.jsx)("button",{onClick:tM,className:"text-text-300 hover:text-text-200 underline",children:(0,a.jsx)(I.Z,{defaultMessage:"Enable notifications",id:"AIUVfaT9og"})})]}):(0,a.jsx)(I.Z,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,a.jsx)(p.u,{tooltipContent:tJ,side:"bottom",disableHoverableContent:!0,className:"max-w-96",children:(0,a.jsx)(k.default,{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,b.Z)("inline-block underline-offset-2 transition-opacity hover:underline select-none",!ev&&"opacity-100 duration-700",ev&&"opacity-0 duration-0"),children:t3?(0,a.jsx)(I.Z,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,a.jsx)("br",{className:"block sm:hidden"})}}):(0,a.jsx)(I.Z,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,a.jsx)("br",{className:"block sm:hidden"})}})})})})]})}),eT&&(0,a.jsx)(sm,{newMessageSent:eK,setNewMessageSent:eV,scrollRefs:eQ,scrollContainerRef:eF,invalidator:eY})]}),(null==tY?void 0:null===(es=tY.conversationSettings)||void 0===es?void 0:es.create_mode)&&0===ey.length?null:tD?(0,a.jsx)("div",{ref:eQ.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,a.jsx)(tX,{conversationUuid:eg,message:tm})}):(0,a.jsx)("div",{ref:eQ.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,a.jsx)(O.x,{ref:e1,placement:"bottom",disabled:ej})})]})}),drawerElement:(0,a.jsx)(tV,{conversationUUID:eg,isOpen:ti,onClose:to,isStreaming:ev,projectUuid:eC,sendMessage:e2}),isDrawerOpen:ti,headerProps:{conversationUUID:eg,name:eb,project:tI?tz:void 0,controlsSidebarIsOpen:ti,closeControlsSidebar:to,openControlsSidebar:tr,isStreaming:ev}}):null}let sz=h.q.div(sk())},32420:function(e,t,s){"use strict";s.d(t,{E$:function(){return f},Nt:function(){return r},ZX:function(){return d},o_:function(){return o},wv:function(){return m}});var n=s(27573),a=s(10607),i=s(68425),l=s(7653);let r=(e,t)=>!(!["thinking","tool_use","tool_result"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","dolphin","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),o=e=>"tool_result"!==e.type,c=l.createContext({}),d=()=>(0,l.useContext)(c),u=e=>{let[t,s]=(0,l.useState)(void 0),a=(0,l.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:s}),[t,s]);return(0,n.jsx)(c.Provider,{value:a,children:e.children})},f=e=>{let{children:t,isFirstBlockOfMessage:s,isLastBlockOfMessage:l,isStreaming:r}=e;return(0,n.jsx)(i.E.div,{initial:{opacity:r?0:1},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,a.Z)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-styrene leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",s?"mt-2":"mt-3",l?"mb-2":"mb-3"),children:(0,n.jsx)(u,{children:t})})},m=e=>{let{icon:t,isExpanded:s,isFirstItem:i,isLastItem:l,isActive:r,children:o}=e,c={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,n.jsxs)("div",{className:(0,a.Z)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":s},{"hover:bg-always-black hover:bg-opacity-[0.03]":!s}),children:[(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,n.jsx)("div",{className:(0,a.Z)("transition-all w-[1px]",{"bg-border-300":!i}),style:c}),(0,n.jsx)("div",{className:(0,a.Z)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[$16px]":!!t}),children:null!=t?t:(0,n.jsx)("div",{className:(0,a.Z)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,n.jsx)("div",{className:(0,a.Z)("transition-all grow w-[1px]",{"bg-border-300":!l}),style:c})]}),(0,n.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},90359:function(e,t,s){"use strict";s.d(t,{P:function(){return $}});var n=s(27573),a=s(87033),i=s(10228),l=s(7653),r=s(2949),o=s(46200),c=s(49454),d=s(45790);let u=()=>(0,n.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,n.jsx)(c.k,{size:24}),(0,n.jsx)("p",{className:"font-styrene ml-3 text-sm",children:(0,n.jsx)(d.Z,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var f=s(8392),m=s(59821),x=s(1133),h=s(98649),g=s(7992),p=s(41270),v=s(30833);let j=p.z.object({url:p.z.string()}),y=e=>{let t;let{input:s,toolResult:a,isStreaming:i}=e,r=null==a?void 0:a.is_error,[o,c]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.d2.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(a);return null==e?void 0:e[0]},[r,a]),p=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let s of e.content)if("text"===s.type){let e=h.sv.safeParse(JSON.parse(s.text));e.success&&t.push(e.data)}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.QQ.safeParse(e);if(!t.success)return null;{let e=h.sv.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(a);return null==e?void 0:e[0]},[r,a]),y=function(e){switch(e){case"INVALID_URL":return(0,n.jsx)(d.Z,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,n.jsx)(d.Z,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,n.jsx)(d.Z,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,n.jsx)(d.Z,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,n.jsx)(d.Z,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,n.jsx)(d.Z,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,n.jsx)(d.Z,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,n.jsx)(d.Z,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==p?void 0:p.error_type),{data:b}=j.safeParse(s);if(!b)return;let w=b.url,_=(null==u?void 0:u.title)||w,N=(0,x.Ly)(w);return t=i?N?(0,n.jsx)(d.Z,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:N}}):(0,n.jsx)(d.Z,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,n.jsx)(d.Z,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}):(0,n.jsx)(d.Z,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.hZ,{isError:r,errorMessage:y,text:t,secondaryText:i?void 0:N,handleClick:()=>c(!0),icon:(0,n.jsx)(m.s,{fadeInOnLoad:!0,url:w,size:16}),secondaryIcon:(0,n.jsx)(g.O,{size:16,className:"text-text-300"}),...e}),(0,n.jsx)(f.o,{isOpen:o,url:w,onClose:()=>c(!1),onConfirm:()=>{window.open(w,"_blank"),c(!1)}})]})};var b=s(67677),w=s(32006),_=s(22027),N=s(68425),C=s(2230),M=s.n(C),k=s(40950),S=s(56971),E=s(65499);function z(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let I=e=>{let{isExpanded:t,toolName:s,results:a}=e;return(null==a?void 0:a.length)?(0,n.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,n.jsx)(T,{results:a,isExpanded:t}):(0,n.jsx)(F,{results:a,isExpanded:t})}):null},Z={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},T=e=>{let{isExpanded:t,results:s}=e;return(0,n.jsx)(n.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,n.jsx)(N.E.div,{variants:Z,children:(0,n.jsx)(b.s,{disabled:!t,icon:(0,n.jsx)(m.s,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!==(s=e.knowledge.url)&&void 0!==s?s:void 0})},e.knowledge.url):null})})},F=e=>{let{isExpanded:t,results:s}=e;return(0,n.jsx)(n.Fragment,{children:s.map(e=>(0,n.jsx)(N.E.div,{variants:Z,children:(0,n.jsx)(A,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},R=e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.nC)();return(0,r.MN)()?s?t?i.co.ACCESS_DENIED:i.co.READY:i.co.UNAUTHENTICATED:i.co.DISABLED},A=e=>{let{disabled:t,knowledge:s}=e,a=R({isError:!s});return(0,n.jsx)(S.dF,{syncSourceType:i.Fg.GDRIVE,syncStatus:a,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},L=p.z.object({query:p.z.string(),n:p.z.number().int().optional()}),O=e=>{var t;let{toolName:s,syncSourceType:a,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:c}=i,{isExpanded:d,setIsExpanded:u,snappyTransition:f}=(0,E.g)(!1,c),m=(0,k.Z)(),x=null==r?void 0:r.is_error,g=x?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:z(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return M()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),n=(Array.isArray(s)?s.map(e=>{let t=h.d2.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:z(e),knowledge:e}));return M()(n,e=>e.uuid)}catch(e){return[]}}(r),{data:p}=L.safeParse(l),j="web_search"===s?m.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):m.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!p)return;let y=m.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!==(t=null==g?void 0:g.length)&&void 0!==t?t:0}),b=!g&&o?j:p.query;return(0,n.jsx)(v.qd,{isExpandingDisabled:!!o,isExpanded:d,setIsExpanded:u,isError:x,text:b,secondaryText:o?void 0:y,icon:"web_search"===s?(0,n.jsx)(_.T,{size:16}):!!a&&(0,n.jsx)(w.j0,{type:a,size:14}),...i,children:(0,n.jsx)(v.jE,{isExpanded:d,snappyTransition:f,isScrollable:!0,children:!x&&!!(null==g?void 0:g.length)&&(0,n.jsx)(I,{isExpanded:d,toolName:s,results:g})})})};var D=s(81389);s(27218),p.z.object({prompt:p.z.string()});var P=s(50110),U=s(2210),B=s(82083),H=s(10607);function J(e){var t,s,a,i;let{input:r,toolResult:o,isStreaming:c,isLastMessage:d,onOpenArtifact:u,publishedArtifacts:f,artifacts:m,message:x,artifactCellType:h,selectedArtifactId:g,selectedArtifactVersion:p,isFirstBlockOfMessage:v,isLastBlockOfMessage:j}=e,y=B.kE.parse(r),b=d&&c,{versions:w,..._}=null!==(a=m[null!==(s=y.id)&&void 0!==s?s:""])&&void 0!==a?a:{},N=(0,l.useMemo)(()=>{let e=null==w?void 0:w.findIndex(e=>e.uuid===y.version_uuid);if(-1!==e)return e},[w,y.version_uuid]),C=null===(t=null!==(i=y.content)&&void 0!==i?i:y.new_str)||void 0===t?void 0:t.slice(0,250),M={isClosed:void 0!==o,..._,...y},k=g===M.id&&p===y.version_uuid,S="individual_cell_create"===h||"multi_edit_not_last"!==h;return(0,n.jsx)("div",{className:(0,H.Z)(S&&(v?"pt-2":"pt-3"),S&&(j?"pb-2":"pb-3"),"multi_edit_not_last"===h&&"h-0"),children:(0,n.jsx)(U.qK,{versionNum:N?N+1:void 0,preview:C,versionCount:null==w?void 0:w.length,properties:M,isStreaming:c,isEdit:"individual_cell_create"!==h,isNotLastEdit:"multi_edit_not_last"===h,isLastMessage:d,onOpenArtifact:e=>{u&&u(e,x.uuid,y.version_uuid)},publishedArtifacts:b?U.EY:f,isExpanded:k})})}var W=s(21273);s(70354);var G=s(66829),q=s(32313),K=s(45144),V=s(14395);let Y=e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,K.Tb)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}},X=p.z.object({code:p.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),Q=e=>{var t;let{input:s,toolResult:a,isStreaming:i,groupItemKey:r}=e,o=(0,k.Z)(),{isExpanded:c,setIsExpanded:d,snappyTransition:u}=(0,E.g)(i,r),f=null!==(t=X.parse(s).code)&&void 0!==t?t:"",{toolResultLogs:m,toolResultErrors:x}=(0,l.useMemo)(()=>a?Y(a):{toolResultLogs:"",toolResultErrors:""},[a]);return(0,n.jsx)(v.qd,{isExpanded:c,setIsExpanded:d,icon:(0,n.jsx)(q.d,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,n.jsx)(v.jE,{isExpanded:c,snappyTransition:u,isScrollable:!0,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,n.jsx)(V.O,{language:"javascript",code:f}),(0,n.jsx)(V.O,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:m}),!!x&&(0,n.jsx)(V.O,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:x,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};function $(e){let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:c,input:d,message:f,onOpenArtifact:m,publishedArtifacts:x,toolResult:h,artifacts:g,onAllow:p,artifactCellType:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,conversationUUID:w,selectedDrawerItem:_,isShared:N,displayData:C,context:M,renderMode:k=P.G.Standard,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z}=e,I=(0,r.$Z)(),Z=(0,o.uH)(),T=(0,a.FL)("pumpernickel_enabled"),{value:F}=(0,a.FL)("prism_enabled"),R={input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,renderMode:k,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z};if("end_conversation"===c)return(0,n.jsx)(u,{});let A=(null==_?void 0:_.type)==="artifact"?_:void 0,L=!!h&&!!_&&"compass"===_.type&&_.data.toolUseId===h.tool_use_id;switch(c){case"artifacts":return(0,n.jsx)(J,{input:d,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:m,publishedArtifacts:x,artifacts:g,message:f,artifactCellType:v,selectedArtifactId:null==A?void 0:A.id,selectedArtifactVersion:null==A?void 0:A.versionUUID,isFirstBlockOfMessage:j,isLastBlockOfMessage:b});case"dolphin":return(0,n.jsx)(n.Fragment,{});case"repl":return(0,n.jsx)(Q,{...R});case"drive_search":if(!I)break;return(0,n.jsx)(O,{syncSourceType:i.Fg.GDRIVE,toolName:c,...R});case"web_search":if(!Z)break;return(0,n.jsx)(O,{toolName:c,...R});case"web_fetch":return(0,n.jsx)(y,{...R});case"launch_extended_search_task":return(0,n.jsx)(D.DY,{toolUseId:t,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,conversationUUID:w,toolResult:h,isShared:N,isExpanded:L,isStreaming:l,context:M})}return T&&(0,W.vn)(C)?(0,n.jsx)(W.ii,{...C,toolName:c,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,renderMode:k,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z}):(0,n.jsx)(G.G,{toolName:c,integrationIcon:null==C?void 0:C.integrationIcon,...R})}p.z.object({returncode:p.z.number().int(),stdout:p.z.string(),stderr:p.z.string()})},14395:function(e,t,s){"use strict";s.d(t,{O:function(){return m}});var n=s(27573),a=s(61995),i=s(20147),l=s(70354),r=s(32737),o=s(17582),c=s(10607),d=s(40950),u=s(45790),f=s(41668);let m=e=>{let{className:t,code:s,codeTagProps:l,language:r,title:d}=e,{codeStyle:u}=(0,i.o)(),{didCopy:m,copyToClipboard:h}=(0,o.m)();return(0,n.jsxs)("div",{className:(0,c.Z)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,n.jsx)(x,{language:r,title:d,handleCopy:()=>{h(s)},didCopy:m}),(0,n.jsx)(f.Z,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:l,language:r,PreTag:"div",style:u,renderer:a.S,wrapLongLines:!0,children:s})]})},x=e=>{let{handleCopy:t,didCopy:s,language:a,title:i}=e,f=(0,d.Z)();return(0,n.jsxs)("div",{className:"flex justify-between items-center h-3",children:[(0,n.jsx)("p",{className:(0,c.Z)("text-text-300 text-[0.6875rem]",i?"font-styrene font-medium":"font-mono font-[450]"),children:i||a}),(0,n.jsx)(r.u,{side:"bottom",tooltipContent:(0,n.jsx)(u.Z,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),children:(0,n.jsx)(l.z,{"aria-label":f.formatMessage({defaultMessage:"Copy to clipboard",id:"aCdAsIsVv0"}),size:"icon_sm",variant:"ghost",className:"!-mr-1 !w-6 !h-6",onClick:t,children:(0,n.jsx)(o.f,{didCopy:s,size:12,className:"text-text-500"})})})]})}},30833:function(e,t,s){"use strict";s.d(t,{hZ:function(){return g},jE:function(){return h},qd:function(){return p}});var n=s(27573),a=s(39418),i=s(43566),l=s(32737),r=s(28386),o=s(30070),c=s(96346),d=s(10607),u=s(68425),f=s(7653),m=s(50110),x=s(32420);let h=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:i,children:l,className:o,onTransitionEnd:c,collapsesHalfway:m,setIsExpanded:x}=e,h=(0,f.useRef)(t),g=!!(m&&!t&&x),p=m&&!t;return(0,n.jsx)(u.E.div,{className:(0,d.Z)("overflow-hidden shrink-0",!t&&g&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:h.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:m?.6:0,height:m?72:0}},whileHover:{opacity:1},transition:i?{ease:r.J.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:c,onClick:g?()=>x(!0):void 0,children:(0,n.jsx)(a.I,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,d.Z)("h-full",s&&"!max-h-[238px]",o,p&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l})})},g=e=>{let{handleClick:t,isDisabled:s,isExpanded:a,isStreaming:r,isError:c,errorMessage:f,icon:h,text:g,secondaryIcon:p,secondaryText:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,className:b,wrapperClassName:w,children:_,renderMode:N=m.G.Standard,isFirstItemInGroup:C,isLastItemInGroup:M}=e,k=s||!t,S=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{onClick:t,className:(0,d.Z)("group/row flex flex-row items-center justify-between gap-4 transition-colors duration-200 rounded-lg text-text-300 hover:text-text-200 h-[2.625rem] py-2 px-3",k?"cursor-default":"cursor-pointer hover:text-text-000",b),disabled:k,children:[(0,n.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[h&&N!==m.G.TimelineGroup&&(0,n.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:h}),(0,n.jsx)("div",{className:"relative bottom-[0.5px] font-styrene text-[0.875rem] text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:r?(0,n.jsx)(i.g,{children:g}):g})]}),(0,n.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:c?(0,n.jsx)(l.u,{tooltipContent:f,align:"center",children:(0,n.jsx)(o.v,{size:16,className:"text-danger-000"})}):(0,n.jsxs)(n.Fragment,{children:[!!v&&(0,n.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-styrene text-[0.75rem] leading-tight shrink-0 whitespace-nowrap",children:v}),p]})})]},r?"streaming":"non-streaming"),_]});return N===m.G.TimelineGroup?(0,n.jsx)(x.wv,{icon:h,isExpanded:a,isFirstItem:!!C,isLastItem:!!M,isActive:r&&y&&M,children:S}):(0,n.jsx)(u.E.div,{initial:{opacity:r?0:1},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,d.Z)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-styrene leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!a&&"hover:bg-bg-000 hover:shadow-sm",j?"mt-2":"mt-3",y?"mb-2":"mb-3",a&&"bg-bg-000 shadow-sm",w),children:S})},p=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...a}=e,{isExpanded:i,isError:l}=a,r=t||l;return(0,n.jsx)(g,{...a,isDisabled:r,handleClick:()=>s(!i),secondaryIcon:r?void 0:(0,n.jsx)(c.p,{className:(0,d.Z)("relative bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",i?"-rotate-180":"rotate-0",r&&"opacity-15"),size:12})})}},21273:function(e,t,s){"use strict";s.d(t,{AQ:function(){return y},ii:function(){return v},vn:function(){return p}});var n=s(27573),a=s(53392),i=s(59821),l=s(67677),r=s(32006),o=s(94606),c=s(10228),d=s(22027),u=s(10607),f=s(68425),m=s(40950),x=s(14395),h=s(30833),g=s(65499);function p(e){return!!e&&!!e.integrationName&&Object.values(e).some(e=>!!e)}function v(e){var t,s,a;let i,{integrationName:l,icon:r,integrationIcon:o,message:c,result:d,isStreaming:u,isError:f,isExpandingDisabled:x,isFirstBlockOfMessage:p,isLastBlockOfMessage:v,wrapperClassName:j,contentClassName:N,defaultExpanded:C=!1,toolName:M,renderMode:k,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z}=e,I=(0,m.Z)(),{isExpanded:Z,setIsExpanded:T}=(0,g.g)(C,S),F=!!d&&!x&&!u&&("rich_content"!==d.type||(null===(t=d.content)||void 0===t?void 0:t.length)>0);return i=d?"rich_content"===d.type?I.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!==(a=null===(s=d.content)||void 0===s?void 0:s.length)&&void 0!==a?a:0}):"JSON":void 0,(0,n.jsx)(h.qd,{isError:f,isExpandingDisabled:!F,isExpanded:Z,setIsExpanded:T,isStreaming:!!u,text:null!=c?c:u?I.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):I.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:u?void 0:i,icon:r||(0,n.jsx)(y,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:p,isLastBlockOfMessage:v,wrapperClassName:j,renderMode:k,isFirstItemInGroup:E,isLastItemInGroup:z,children:(0,n.jsxs)(h.jE,{isExpanded:Z,snappyTransition:!0,isScrollable:!0,className:N,children:[F&&(null==d?void 0:d.type)==="rich_content"&&(0,n.jsx)(b,{disabled:!Z||u,result:d,integrationName:l,toolName:M}),F&&(null==d?void 0:d.type)==="table"&&(0,n.jsx)(w,{result:d}),F&&(null==d?void 0:d.type)==="json_block"&&(0,n.jsx)(_,{result:d})]})})}let j=["Google Calendar","Gmail","Google Drive","Search Project Knowledge"],y=e=>{let{canShowLetterIcon:t,integrationName:s,toolName:l,iconUrl:u,size:f=16}=e;switch(s){case"Google Drive":return(0,n.jsx)(r.j0,{type:c.Fg.GDRIVE,size:f});case"Google Calendar":return(0,n.jsx)(r.j0,{type:c.Fg.GCAL,size:f});case"Gmail":return(0,n.jsx)(r.j0,{type:c.Fg.GMAIL,size:f});case"Search Project Knowledge":return(0,n.jsx)(o.p,{size:f})}return(0,n.jsx)(i.s,{fadeInOnLoad:!0,url:u,size:f,fallbackSvg:(s||l)&&t?(0,n.jsx)(a._,{size:f,letter:s||l}):(0,n.jsx)(d.T,{size:f,className:"text-text-500"})})},b=e=>{let{disabled:t,integrationName:s,result:a,toolName:i}=e,r=i?i.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,o=!!s&&j.includes(s)&&2039!==r&&2010!==r;return(0,n.jsx)(f.E.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:a.content.map((e,a)=>{let{title:i,subtitles:r,url:c,resource_type:d,icon_url:u}=e;return(0,n.jsx)(l.s,{disabled:t,icon:o?void 0:(0,n.jsx)(y,{integrationName:s,iconUrl:u}),title:i,subtitles:r,url:c,tag:d},a)})})},w=e=>{let{result:t}=e;return(0,n.jsx)(N,{table:t.table})},_=e=>{let{result:t}=e,s=(0,m.Z)();return(0,n.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,n.jsx)(x.O,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},N=e=>{let{table:t}=e;return(0,n.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[a,i]=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:(0,u.Z)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,n.jsx)("p",{className:"font-medium text-text-300 text-xs",children:a})}),(0,n.jsx)("div",{className:(0,u.Z)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,n.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},66829:function(e,t,s){"use strict";s.d(t,{G:function(){return f},K:function(){return u}});var n=s(27573),a=s(53392),i=s(59821),l=s(27218),r=s(40950),o=s(14395),c=s(30833),d=s(65499);let u=e=>{let{input:t,toolResult:s}=e,a=(0,r.Z)(),{activeOrganization:i}=(0,l.t)(),c=null==i?void 0:i.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,n.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,n.jsx)(o.O,{title:a.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,n.jsx)(o.O,{title:a.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,n.jsx)("img",{src:"/api/".concat(c,"/files/").concat(e.file_uuid,"/preview"),alt:a.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},f=e=>{let{toolName:t,integrationIcon:s,...l}=e,{input:r,toolResult:o,isStreaming:f,groupItemKey:m}=l,{isExpanded:x,setIsExpanded:h,snappyTransition:g}=(0,d.g)(f,m);return(0,n.jsx)(c.qd,{isExpanded:x,setIsExpanded:h,text:t,icon:(0,n.jsx)(i.s,{url:s,fallbackSvg:(0,n.jsx)(a._,{letter:t,size:18}),size:18}),...l,children:(0,n.jsx)(c.jE,{isExpanded:x,snappyTransition:g,isScrollable:!0,children:(0,n.jsx)(u,{input:r,toolResult:o})})})}},65499:function(e,t,s){"use strict";s.d(t,{g:function(){return i}});var n=s(7653),a=s(32420);let i=(e,t)=>{let s=(0,n.useRef)(!!e),[i,l]=(0,n.useState)(!!e),[r,o]=(0,n.useState)(!e),{expandedItemKey:c,setExpandedItemKey:d}=(0,a.ZX)(),u=t&&d,f=(0,n.useCallback)(e=>{u&&d(e?t:void 0),l(e)},[u,d,l,t]),m=u?c===t:i;return(0,n.useEffect)(()=>{!e&&s.current&&setTimeout(()=>{l(!1),setTimeout(()=>{o(!0)},600)},2e3)},[e]),{isExpanded:m,setIsExpanded:f,snappyTransition:r}}},5751:function(e,t,s){"use strict";s.d(t,{r:function(){return h}});var n=s(27573),a=s(28803),i=s(27218),l=s(5984),r=s(70354),o=s(52939),c=s(82083),d=s(88146),u=s(7653),f=s(40950),m=s(45790),x=s(64452);function h(e){var t,s,h,g,p,v;let{conversationUuid:j,message:y,requestedFeedbackType:b,setRequestedFeedbackType:w,isOpen:_,onClose:N,onSuccess:C,showOptions:M=!0}=e,k=(0,f.Z)(),[S,E]=(0,u.useState)(""),{data:z}=(0,a._C)(j),I=null==z?void 0:z.chat_messages.some(e=>(0,c.HZ)(e).length>0),Z=(0,x.D)(null!==(h=null==z?void 0:z.chat_messages)&&void 0!==h?h:[]).length>0,{mutate:T}=(0,a.Ke)(j,y,!!I,{onSuccess:C}),F=(0,u.useId)(),R=null!==(g=null===(t=y.content)||void 0===t?void 0:t.some(e=>"thinking"===e.type))&&void 0!==g&&g,A="raven"===(0,i.b9)(),L=null;return(null==z?void 0:null===(s=z.settings)||void 0===s?void 0:s.enabled_web_search)&&(L=null!==(v=null===(p=y.content)||void 0===p?void 0:p.some(e=>"tool_use"===e.type&&"web_search"===e.name))&&void 0!==v&&v?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("option",{value:"flag/web-over",children:(0,n.jsx)(m.Z,{defaultMessage:"Shouldn’t have searched the web",id:"T+mr27AakV"})}),(0,n.jsx)("option",{value:"flag/web-sources",children:(0,n.jsx)(m.Z,{defaultMessage:"Don’t like the cited sources",id:"MBNotx/VaO"})})]}):(0,n.jsx)("option",{value:"flag/web-under",children:(0,n.jsx)(m.Z,{defaultMessage:"Should have searched the web",id:"CS8kdzupd9"})})),(0,n.jsxs)(o.u_,{isOpen:_,title:k.formatMessage({defaultMessage:"Feedback",id:"Ejhdi47Jk5"}),onClose:N,children:[(0,n.jsxs)("div",{className:"mt-4 flex flex-col",children:[(null==b?void 0:b.includes("flag"))&&M&&(0,n.jsxs)(l.Ph,{className:"my-2 max-w-md",label:k.formatMessage({defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"}),value:b,onChange:e=>{w(e.target.value||"flag")},children:[(0,n.jsx)("option",{value:"flag",children:(0,n.jsx)(m.Z,{defaultMessage:"Select…",id:"q0+99kUbd6"})}),(0,n.jsx)("option",{value:"flag/bug",children:(0,n.jsx)(m.Z,{defaultMessage:"UI bug",id:"0uIYueAyDB"})}),(0,n.jsx)("option",{value:"flag/refusal",children:(0,n.jsx)(m.Z,{defaultMessage:"Overactive refusal",id:"Jl0Mn6yDBI"})}),Z&&(0,n.jsx)("option",{value:"flag/file",children:(0,n.jsx)(m.Z,{defaultMessage:"Poor image understanding",id:"227KYxHrx5"})}),(0,n.jsx)("option",{value:"flag/instructions",children:(0,n.jsx)(m.Z,{defaultMessage:"Did not fully follow my request",id:"2uOw8LgMwG"})}),(0,n.jsx)("option",{value:"flag/facts",children:(0,n.jsx)(m.Z,{defaultMessage:"Not factually correct",id:"topE9Q6MGe"})}),(0,n.jsx)("option",{value:"flag/incomplete",children:(0,n.jsx)(m.Z,{defaultMessage:"Incomplete response",id:"ZNEcy7OM5r"})}),R&&(0,n.jsx)("option",{value:"flag/thoughts",children:(0,n.jsx)(m.Z,{defaultMessage:"Issue with thought process",id:"zOab+24EWo"})}),L,(0,n.jsx)("option",{value:"flag/other",children:(0,n.jsx)(m.Z,{defaultMessage:"Other",id:"/VnDMl81rh"})})]}),(0,n.jsx)("label",{htmlFor:F,className:"text-text-400 mb-2 text-sm",children:(0,n.jsx)(m.Z,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),(0,n.jsx)(l.Kx,{id:F,className:"text-sm",placeholder:(null==b?void 0:b.includes("flag"))?k.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}):k.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),value:S,onChange:e=>{E(e.target.value)}})]}),(0,n.jsx)("p",{className:"text-text-500 mt-3 italic leading-tight",children:(0,n.jsx)("small",{children:(0,n.jsx)(m.Z,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn More</link>",id:"laRJ009b4f",values:{link:e=>(0,n.jsx)(d.default,{target:"_blank",rel:"noopener",href:A?"https://privacy.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback":"https://privacy.anthropic.com/en/articles/10023565-how-does-anthropic-use-submitted-feedback",className:"text-accent-secondary-100 font-medium hover:underline",children:e})}})})}),(0,n.jsxs)(o.dm,{children:[(0,n.jsx)(r.z,{onClick:()=>{b&&(T({type:b,reason:S||void 0}),N())},children:(0,n.jsx)(m.Z,{defaultMessage:"Submit",id:"wSZR47Y5kj"})}),(0,n.jsx)(r.z,{variant:"secondary",onClick:N,children:(0,n.jsx)(m.Z,{defaultMessage:"Cancel",id:"47FYwba+bI"})})]})]})}},67995:function(e,t,s){"use strict";function n(e){let t;try{t=JSON.parse(e)}catch(e){}return t}s.d(t,{I:function(){return n}})},49034:function(e,t,s){"use strict";s.d(t,{z:function(){return y},Q:function(){return j}});var n=s(28803),a=s(51789),i=s(18916),l=s(80762),r=s(87033),o=s(91598),c=s(7653),d=s(51375),u=s(23098),f=s(5161),m=s(51432);async function x(e,t){let s;try{s=await t.callback(e)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}return{is_error:s.isError,content:s.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return h({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw Error("Missing MIME type for embedded resource");return h({mimeType:t.mimeType,base64Data:t.blob})}}}throw Error("Unsupported content type: ".concat(e.type))})}}function h(e){let{mimeType:t,base64Data:s}=e;if(!f.wI[t])throw Error("Unsupported image type: ".concat(t));let n=f.wI[t];return{type:"image",file_name:"".concat((0,m.H)(),".").concat(n),source:{media_type:t,type:"base64",data:s}}}var g=s(93558);async function p(e,t){let s=g.KX.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}else throw Error("Error parsing input: ".concat(s.error.message))}var v=s(67995);function j(){let{mutateAsync:e}=(0,n.fc)(),t=function(){let{executeReplCode:e}=(0,a.r)(),{mcpTools:t}=(0,d.cH)();return(0,c.useCallback)(async(s,n)=>{let a=(0,v.I)(n);if("repl"===s)return await p(a,e);{let e=null==t?void 0:t.find(e=>e.name===s);if(e)return await x(a,e)}},[e,t])}();return(0,c.useCallback)(async function(s,n,a,i){let{overriddenResult:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};l.f("Tools: Using tool ".concat(n," with input ").concat(i));try{let o=null!=r?r:await t(n,i);if(void 0===o){l.f("Tools: Unable to find tool with name ".concat(n));return}l.f("Tools: Result for tool ".concat(n,": ").concat(o)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:a,...o})}catch(i){let t=i instanceof Error?i.message:String(i);l.f("Tools: Error for tool ".concat(n,": ").concat(t)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:a,content:[{type:"text",text:t}]})}},[t,e])}let y=(e,t)=>{let s=(0,o.zO)(),{servers:n}=(0,d.cH)(),{value:a}=(0,i.h)(null!=e?e:{}),{value:l}=(0,r.FL)("tool_use_artifacts_ga"),f=(0,u.PE)(t);return(0,c.useCallback)(()=>{let t=[];for(let s of n)for(let n of s.tools){var i,r;(null==e?void 0:null===(i=e.enabled_mcp_tools)||void 0===i?void 0:i[(0,d.q)(s.uuid,n.name)])!==!1&&t.push({name:n.name,description:null!==(r=n.description)&&void 0!==r?r:n.name,input_schema:n.inputSchema,...(null==s?void 0:s.type)==="remote"&&{mcp_server_uuid:s.uuid}})}let c=null==s?void 0:s[o.lR];return c&&t.push({type:(null==s?void 0:s[o.fs])||"",name:c}),(l||a)&&t.push({type:"artifacts_v0",name:"artifacts"}),a&&t.push({type:"repl_v0",name:"repl"}),f&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[n,null==e?void 0:e.enabled_mcp_tools,a,s,l,f])}},64452:function(e,t,s){"use strict";s.d(t,{D:function(){return i},q:function(){return a}});var n=s(7653);function a(e){let t=[];for(let n of e){var s;for(let e of null!==(s=n.files_v2)&&void 0!==s?s:n.files)"file_kind"in e&&t.push(e)}return t}let i=e=>(0,n.useMemo)(()=>a(e),[e])},81389:function(e,t,s){"use strict";s.d(t,{DY:function(){return P},Xd:function(){return D}});var n=s(27573),a=s(53146),i=s.n(a),l=s(53392),r=s(59821),o=s(5362),c=s(27218),d=s(70354),u=s(52939),f=s(22523),m=s(43566),x=s(28386),h=s(87033),g=s(98649),p=s(30070),v=s(18843),j=s(10607),y=s(68425),b=s(8927),w=s(7653),_=s(40950),N=s(45790),C=s(41270),M=s(51375),k=s(39992),S=s(57860),E=s(89803),z=s(92935),I=s(47216),Z=s(11776);function T(e){let{onCancel:t,onConfirm:s}=e,a=(0,w.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,I.PQ)(),r=(0,Z.j$)({setStyleModalOpenWithScreen:F,setCreateProjectModalIsOpen:F,setGithubModalIsOpen:F,setGmailAuthModalIsOpen:F,setCreatePromptArgumentModalIsOpen:F}),o=(0,z.Ln)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,w.useEffect)(()=>{setTimeout(()=>{a.current&&a.current.focus()})},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(u.u_,{isOpen:!0,modalSize:"2lg",onClose:t,className:"!px-4 !py-6",children:(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("h3",{className:"text-lg font-medium",children:(0,n.jsx)(N.Z,{defaultMessage:"Enable integrations for Claude to use in research",id:"OW3ZJC49V0"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(E.a,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,n.jsx)(S.P,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key,countDisplayVariant:"verbose"},e.key))]}),(0,n.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,n.jsx)(N.Z,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,n.jsx)("a",{href:"https://support.anthropic.com/",className:"underline",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,n.jsxs)("div",{className:"flex flex-row justify-end gap-2 mt-4",children:[(0,n.jsx)(d.z,{variant:"outline",onClick:t,children:(0,n.jsx)(N.Z,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsxs)(d.z,{ref:a,onClick:function(){s({tools:l()})},children:[(0,n.jsx)(N.Z,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,n.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,n.jsx)(k.U,{size:12})})]})]})]})})})}function F(){}var R=s(48894),A=s(47082),L=s(63690),O=s(34236);let D=C.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},C.z.object({task_id:C.z.string()}));function P(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:a=!1,conversationUUID:i,toolResult:l,isShared:r,isExpanded:d=!1,isStreaming:u=!1,context:f}=e,{value:m}=(0,h.FL)("papi_mcp"),{activeOrganization:x}=(0,c.t)(),{dispatchChatResource:p}=(0,A.Y)(),{setIsDrawerExpanded:v}=(0,R.b)(),{decisionState:y,approveTool:b,denyTool:N}=function(e,t,s,n){let[a,i]=(0,w.useState)("pending"),l=!!(e&&t&&n),{isPending:r}=(0,o.WE)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:l}),c=(0,o.uC)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!r),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:a,isStatePending:r,approveTool:(0,w.useCallback)(e=>{let{tools:t}=e;c({tool_use_id:s,is_approved:!0,params:{tools:t}})},[c,s]),denyTool:(0,w.useCallback)(()=>{c({tool_use_id:s,is_approved:!1})},[c,s])}}(null==x?void 0:x.uuid,i,t,u),C=u?"approved"===y:l&&!(null==l?void 0:l.is_error),M=m&&(null==f?void 0:f.tools.length)&&u&&"pending"===y,k=(0,w.useMemo)(()=>{if(!(null==l?void 0:l.content))return;let e=l.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=D.safeParse(e);return null==t?void 0:t.task_id},[null==l?void 0:l.content]),{compassStatus:S,isLoading:E,error:z}=(0,L.Oz)({organizationUUID:null==x?void 0:x.uuid,conversationUUID:i,taskId:k,isShared:r,enabled:C});(0,L.W3)(i,null==S?void 0:S.status);let I=!S,Z=(0,w.useCallback)(()=>{I||(v(!0),p({type:"OPEN_COMPASS_STATUS",data:{conversationUUID:i,organizationUUID:null==x?void 0:x.uuid,isShared:r,toolUseId:null==l?void 0:l.tool_use_id,taskId:k}}))},[I,p,i,null==x?void 0:x.uuid,v,r,l,k]),F=(null==S?void 0:S.status)||g.IN.Starting,O=!!z||!!(null==l?void 0:l.is_error),P=(0,_.Z)(),{title:U,subtitle:J}=(0,w.useMemo)(()=>{let e,t;if(O)return{title:P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})};let s=(null==S?void 0:S.total_sources)||0,n=0===s?P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:s}),a=P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:s}),i=(0,L.MT)(S),l=i||P.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),r=i||P.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(F){case g.IN.Starting:{let t=[P.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),P.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),P.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),P.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),P.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),P.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),P.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),P.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),P.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),P.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),P.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case g.IN.Planning:e=l,t=P.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case g.IN.InitiatingAgents:e=l,t=P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case g.IN.Searching:e=l,t=n;break;case g.IN.CreatingArtifact:e=l,t=P.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case g.IN.Completed:t=a,e=r;break;case g.IN.Cancelled:e=l,t=P.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case g.IN.TimedOut:case g.IN.Failed:e=P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),t=a}return{title:e,subtitle:t}},[P,F,S,O]);return M&&(null==f?void 0:f.use_finegrained_approval)?(0,n.jsx)(T,{onCancel:N,onConfirm:e=>{let{tools:t}=e;b({tools:t})}}):M?(0,n.jsx)(W,{tools:f.tools,onCancel:N,onApprove:()=>{b({tools:[]})}}):(0,n.jsx)("div",{className:(0,j.Z)("my-3",s?"mt-2":"mt-3",a?"mb-2":"mb-3"),children:E?(0,n.jsxs)("div",{className:"w-full p-4 text-text-000 font-styrene rounded-xl border border-border-300 shadow-xs",children:[(0,n.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,n.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,n.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,n.jsxs)("button",{className:(0,j.Z)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-styrene rounded-xl border shadow-xs overflow-hidden",!I&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",d?"!border-accent-secondary-200":"border-border-300"),disabled:I,onClick:Z,children:[(0,n.jsx)(B,{title:U,compassStatus:S,useShimmer:F===g.IN.Starting,isError:O||F===g.IN.Failed||F===g.IN.TimedOut,isExpanded:d}),(0,n.jsx)(H,{subtitle:J,compassStatus:S,isError:F===g.IN.Cancelled,useShimmer:!d&&!!S&&![g.IN.CreatingArtifact,g.IN.Completed,g.IN.Cancelled,g.IN.TimedOut,g.IN.Failed].includes(S.status)})]})})}function U(e){let{className:t,text:s,useShimmer:a}=e,[l,r]=(0,w.useState)(s),[o,c]=(0,w.useState)(!1),[d,u]=(0,w.useState)("");return(0,w.useEffect)(()=>{if(s!==l){u(l),r(s),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[s,l]),(0,n.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,j.Z)("relative overflow-hidden",t)||""),children:[(0,n.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@-webkit-keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-moz-keyframes slideUpFadeOut{0%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}100%{-moz-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-o-keyframes slideUpFadeOut{0%{-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);-moz-transform:translatey(-100%);-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-webkit-keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}}@-moz-keyframes slideUpFadeIn{0%{-moz-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}}@-o-keyframes slideUpFadeIn{0%{-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-o-transform:translatey(0);transform:translatey(0);opacity:1}}@keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);-moz-transform:translatey(100%);-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}}"}),o&&(0,n.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:a?(0,n.jsx)(m.g,{children:d}):d}),(0,n.jsx)("div",{style:o?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:a?(0,n.jsx)(m.g,{children:l}):l})]})}function B(e){let{title:t,isError:s,compassStatus:a,useShimmer:i,isExpanded:l}=e,[r,o]=(0,w.useState)(!1),c=(0,L.PF)(a),d=(0,w.useRef)(c);(0,w.useEffect)(()=>{c&&!d.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),d.current=c)},[c]);let u=!l&&r;return(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,n.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[u&&!!c&&(0,n.jsx)(y.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,n.jsx)(J,{thought:c})}),(0,n.jsx)(b.M,{initial:!1,children:!(u&&c)&&(0,n.jsxs)(y.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:x.J.inOutQuart},className:(0,j.Z)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,n.jsx)(p.v,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,n.jsx)("p",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,n.jsx)(U,{text:t,useShimmer:!!i&&!s})})]})})]}),!!a&&(0,n.jsx)(v.T,{size:12,className:"text-text-500 mt-4"})]})}function H(e){var t,s;let{subtitle:a,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,w.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,L.eB)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return a?(0,n.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,n.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,n.jsx)(L.AS,{hrefs:o})}),(null==l?void 0:l.status)===g.IN.Completed&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(N.Z,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,n.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,n.jsx)(U,{text:a,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,n.jsx)("div",{className:"text-text-500",children:(0,n.jsx)(L.WC,{startedAt:null!==(t=null==l?void 0:l.started_at)&&void 0!==t?t:null,completedAt:null!==(s=null==l?void 0:l.finished_at)&&void 0!==s?s:null})})]})]}):null}function J(e){let{thought:t}=e;return(0,n.jsx)("div",{className:"h-9 w-full",children:(0,n.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,n.jsx)(y.E.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:x.J.inOutBase},children:(0,n.jsx)(L.xL,{thought:t})})})})}function W(e){let{tools:t,onCancel:s,onApprove:a}=e,{servers:i}=(0,M.cH)();return(0,n.jsx)(u.u_,{modalSize:"xl",isOpen:!0,onClose:s,title:(0,n.jsx)(N.Z,{defaultMessage:"Claude may use the following custom integrations while researching",id:"OKJu4YENMc"}),children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 rounded-lg my-4 relative",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4 p-4 max-h-[300px] overflow-y-auto",children:i.map(e=>{let s=t.filter(t=>t.server_uuid===e.uuid).map(e=>e.tool_name),a=e.tools.filter(e=>s.includes(e.name));return a.length?a.map(t=>(0,n.jsx)(f.X2,{className:"!py-0",children:(0,n.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,n.jsx)(r.s,{url:e.url,fallbackSvg:(0,n.jsx)(l._,{letter:e.name,size:30,fontSize:11,className:"shrink-0 font-medium mt-1"}),size:30}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("div",{className:"text-sm font-mono",style:{fontWeight:700},children:t.name}),(0,n.jsx)(O.D,{text:t.description,className:"text-[0.9rem] !text-text-500"})]})]})},t.name)):null})}),(0,n.jsx)("div",{className:"absolute bottom-0 left-2 right-2 h-6 bg-gradient-to-t from-bg-200 to-bg-200/0 pointer-events-none z-10"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-accent-secondary-900 rounded-lg bg-accent-secondary-900/30",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsx)(p.v,{className:"text-accent-secondary-000",size:16,weight:"bold"}),(0,n.jsx)("h4",{className:"text-accent-secondary-000 font-medium",children:(0,n.jsx)(N.Z,{defaultMessage:"You are enabling Claude to retrieve content from your connected apps.",id:"RPQTc1f34V"})})]}),(0,n.jsx)("p",{className:"text-text-300",children:(0,n.jsx)(N.Z,{defaultMessage:"Please ensure you have all appropriate permissions and trust these tools before continuing. <link>Learn more</link> about safely using Research with connected apps.",id:"b86SF7HKhH",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/11175166-about-custom-integrations-using-remote-mcp",target:"_blank",rel:"noopener noreferrer",children:e})}})})]}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(d.z,{variant:"outline",onClick:s,children:(0,n.jsx)(N.Z,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,n.jsx)(d.z,{onClick:a,children:(0,n.jsx)(N.Z,{defaultMessage:"Research with {count, plural, one {# tool} other {# tools}}",id:"H0wjvrIsuM",values:{count:t.length}})})]})]})})}},63690:function(e,t,s){"use strict";s.d(t,{AS:function(){return p},MT:function(){return b},Oz:function(){return y},PF:function(){return N},W3:function(){return j},WC:function(){return M},eB:function(){return v},ii:function(){return w},xL:function(){return k}});var n=s(27573),a=s(28803),i=s(59821),l=s(2210),r=s(5362),o=s(98649),c=s(58183),d=s(10607),u=s(68425),f=s(43290),m=s(7653),x=s(40950),h=s(41270),g=s(22639);function p(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,n.jsx)(u.E.div,{className:(0,d.Z)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,n.jsx)(i.s,{url:e,shouldFillBackground:!0,size:14})},t));return(0,n.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function v(e){let{agents:t,n:s=5}=e,n=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var a;if("web_search"===e.tool_name&&(null===(a=e.output)||void 0===a?void 0:a.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(n.add(e.origin),n.size>=s)return Array.from(n).slice(0,s)}catch(e){}}}return Array.from(n)}function j(e,t){let s=!t||t===o.IN.Completed,n=(0,m.useRef)(s),{mutate:i}=(0,a.T$)(e,{refetchOnSettled:!0});(0,m.useEffect)(()=>{s&&!n.current&&i({settings:{compass_mode:null}}),n.current=s},[i,s,e])}function y(e){var t,s;let{organizationUUID:n,conversationUUID:i,taskId:l,isShared:d,enabled:u}=e,[x,h]=(0,m.useState)(!0),[,p]=(0,m.useState)(0),v=(0,c.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),j=null!==(s=null===(t=v[0])||void 0===t?void 0:t.intervalSeconds)&&void 0!==s?s:30,[y,b]=(0,m.useState)(j),w=(0,a.cc)(i),{setCurrentCompassTask:_}=(0,g.r)(),N=d?"/api/organizations/".concat(n,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(n,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:C,isLoading:M,error:k}=(0,r.WE)(N,{refetchInterval:!!x&&1e3*y,enabled:!!(u&&i&&n&&l),meta:{noToast:!0}}),S=(null==C?void 0:C.status)!==void 0&&!(0,o.Ml)(null==C?void 0:C.status);return(0,m.useEffect)(()=>{if(u&&i&&n&&l){if(S)h(!1),_(void 0),w(),p(0);else if(k){if(!(null==C?void 0:C.started_at)){h(!1);return}p(e=>{let t=e+1,s=f.ou.fromISO(C.started_at).plus({hours:3}),n=f.ou.now();return h(t<3&&n<s),t})}else C&&!S&&(p(0),_(l))}},[u,l,S,k,w,n,i,C,_]),(0,m.useEffect)(()=>{if(!(null==C?void 0:C.started_at)||!x)return;let e=setInterval(()=>{let e=function(e,t){let s=f.ou.fromISO(e),n=f.ou.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||n<e.durationSeconds)return e.intervalSeconds;return 30}(C.started_at,v);e!==y&&b(e)},1e3*y);return()=>clearInterval(e)},[null==C?void 0:C.started_at,x,v,y]),{compassStatus:C,isLoading:M,error:k,completed:S}}let b=e=>{var t;return null==e?void 0:null===(t=e.agents[0])||void 0===t?void 0:t.name};function w(e){let t=(0,x.Z)();return b(e)||(e.status!==o.IN.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=h.z.object({thought:h.z.string()});function N(e){let t=null==e?void 0:e.agents[0];return(0,m.useMemo)(()=>{var e,s,n;let a=null==t?void 0:null===(e=t.annotated_snippets[0])||void 0===e?void 0:e.thinking_blocks,i=a&&a.length>0?a[0]:void 0;if(i)return i.thinking;let l=null==t?void 0:null===(n=t.annotated_snippets[0])||void 0===n?void 0:null===(s=n.tool_calls)||void 0===s?void 0:s.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function C(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),n=Math.floor(s/60);return n>0?"".concat(n,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function M(e){let{startedAt:t,completedAt:s}=e,[a,i]=(0,m.useState)(()=>f.ou.now());if((0,m.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(f.ou.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=f.ou.fromISO(t);if(s){let e=f.ou.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,n.jsx)(n.Fragment,{children:C(e)})}let r=a.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,n.jsx)(n.Fragment,{children:C(r)})}function k(e){let{thought:t,className:s}=e;return t?(0,n.jsx)("div",{className:(0,d.Z)("text-base text-text-100 font-tiempos",s),children:(0,n.jsx)(l.ux,{text:t})}):null}},16155:function(e,t,s){"use strict";s.d(t,{NotificationListener:function(){return _},NF:function(){return w},Qc:function(){return y}});var n,a,i,l,r=s(3053),o=s(27218),c=s(44053),d=s(45144),u=s(98531),f=s(69174),m=s(7653),x=s(5362),h=s(77930);(n=i||(i={})).FCM="FCM",n.APNS="APNS",(a=l||(l={})).ACTIVE="ACTIVE",a.INACTIVE="INACTIVE";let g=()=>{let{activeOrganization:e}=(0,o.t)(),t=null==e?void 0:e.uuid,s=(0,h.useQueryClient)();return(0,x.uC)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:["notificationChannels",{orgUUID:t}]})}})};var p=s(68571);let v={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:p.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:p.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},j="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",y=()=>{let[e,t]=(0,m.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,m.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,c.s)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},b=async(e,t)=>{if(!("Notification"in window))return!1;try{let s=await Notification.requestPermission();if(t&&t({event_key:"claudeai.notification.permission.result",permission:s}),"granted"!==s)return t&&t({event_key:"claudeai.notification.permission.result",permission:s}),!1;{let t,s;if(t=0===(0,u.C6)().length?(0,u.ZF)(v):(0,u.Mq)(),!await (0,f.Gb)())return!1;try{s=(0,f.KL)(t)}catch(e){return!1}let n=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null===(t=e.active)||void 0===t?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!n)try{n=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,d.Tb)(e,{tags:{action:"registerServiceWorker"}})}try{let t=await (0,f.LP)(s,{vapidKey:j,serviceWorkerRegistration:n});if(t)e(t);else throw(0,d.Tb)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,d.Tb)(e,{tags:{action:"getToken"}}),e}}return"granted"===s}catch(e){return(0,d.Tb)(e,{tags:{action:"requestPermission"}}),!1}},w=()=>{let{track:e}=(0,r.z$)(),{mutate:t}=g();return(0,m.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await b(e=>{t({channel_type:i.FCM,registration_token:e,client_app_name:"claude-ai-web"})},e)),[t,e])},_=()=>{let e=(0,m.useRef)(null),{account:t}=(0,o.t)(),{mutate:s}=g(),n=async()=>{let t;if(t=0===(0,u.C6)().length?(0,u.ZF)(v):(0,u.Mq)(),!await (0,f.Gb)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let s=(0,f.KL)(t);return e.current=s,{app:t,messaging:s}},a=async e=>{try{return await (0,f.LP)(e,{vapidKey:j})}catch(e){return(0,d.Tb)(e,{tags:{action:"getFCMToken"}}),null}},l=(0,m.useCallback)(e=>{s({channel_type:i.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[s]);return(0,m.useEffect)(()=>{var e;let t=!0,s=null;(async()=>{if("Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await n();if(!e||!t)return;let i=await a(e);i&&t&&l(i),s=(0,f.ps)(e,e=>{var t,s;let n=(null===(t=e.data)||void 0===t?void 0:t.title)||"Claude",a={body:null===(s=e.data)||void 0===s?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},i=new Notification(n,a);i.onclick=()=>{var t,s;if(window.focus(),i.close(),null===(t=e.data)||void 0===t?void 0:t.payload)try{let t=JSON.parse(e.data.payload);if(null===(s=t.request)||void 0===s?void 0:s.conversation_uuid){window.location.href="/chat/".concat(t.request.conversation_uuid);return}}catch(e){(0,d.Tb)(e,{tags:{action:"parseNotificationPayload"}})}window.location.href="/"}})}catch(e){(0,d.Tb)(e,{tags:{action:"setupNotifications"}})}})();let i=e=>{let t=e.data;(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl)};return null===(e=navigator.serviceWorker)||void 0===e||e.addEventListener("message",i),()=>{var e;t=!1,s&&s(),null===(e=navigator.serviceWorker)||void 0===e||e.removeEventListener("message",i)}},[t,l]),null}},37607:function(e,t,s){"use strict";s.d(t,{PageHeader:function(){return f}});var n=s(41596),a=s(27573),i=s(9788),l=s(85069),r=s(88755),o=s(10607),c=s(20355);function d(){let e=(0,n._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return d=function(){return e},e}let u=i.q.div(d());function f(e){let{children:t,className:s,contentClassName:n,sticky:i,fixed:d,mdTitle:f,large:m,narrow:x}=e,{isMobile:h,isExpanded:g}=(0,c.S)(),p=(0,r.Q)(l.t6),v=!t&&!f,j=m&&!p;return(0,a.jsxs)("header",{className:(0,o.Z)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",d&&"fixed top-0 z-header",p?l.eM:"h-12",p&&[!g&&"pl-[133px]",!v&&l.Gg],j&&["mx-auto md:h-24 md:items-end",x?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,children:[!p&&(i||d)&&(0,a.jsx)(u,{}),(0,a.jsx)("div",{className:(0,o.Z)("flex w-full items-center justify-between gap-4",p?"pt-0.5":"",p&&!g?"pl-3":"pl-11 lg:pl-8",p&&!(h&&g)&&"draggable",n,j?"px-4 md:pl-8":"pr-3"),children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:(0,o.Z)("text-text-200 flex items-center gap-2 text-center font-medium leading-tight tracking-tight max-md:hidden min-w-0",!p&&"font-copernicus",!p&&(j?"text-2xl":"text-lg")),children:(0,a.jsx)("span",{className:"truncate",children:f})}),(0,a.jsx)("div",{}),t]}):t})]})}},45571:function(e,t,s){"use strict";s.d(t,{Dy:function(){return x},Jh:function(){return f}});var n=s(41596),a=s(27573),i=s(28803),l=s(9788),r=s(70354),o=s(7653),c=s(45790);function d(){let e=(0,n._)(["\n  w-full\n  tabular-nums\n  text-left\n  text-base\n  disabled:pointer-events-none\n  disabled:shadow-none\n  disabled:drop-shadow-none"]);return d=function(){return e},e}let u=e=>{let[t,s]=(0,o.useState)([]),[n,a]=(0,o.useState)(null),{data:l}=(0,i.QR)({limit:i.bf,enabled:!!n}),[r,c]=(0,o.useState)([]),{data:d,error:u}=(0,i._C)(null!=n?n:"");return(0,o.useEffect)(()=>{if(!l)return;if(d&&d.uuid===n)t.some(e=>e.uuid===d.uuid)||s(e=>[...e,d]);else{if(!u)return;c(e=>[...e,n])}let i=l.find(e=>!t.some(t=>t.uuid===e.uuid)&&!r.includes(e.uuid));i?a(i.uuid):e(t)},[d,u,r,n,t,l,e]),{totalConversations:null==l?void 0:l.length,numExported:t.length,numFailed:r.length,startExporting:()=>{l&&l.length&&a(l[0].uuid)}}},f=(0,o.forwardRef)((e,t)=>{let[s,n]=(0,o.useState)(!1),[i,l]=(0,o.useState)(null),{totalConversations:r,numExported:d,numFailed:f,startExporting:x}=u(e=>{n(!1),l(JSON.stringify(e,null,2))});return s?(0,a.jsx)(m,{ref:t,disabled:!0,...e,children:f>0?(0,a.jsx)(c.Z,{defaultMessage:"Exporting: {numExported} / {totalConversations} ({numFailed} failed)",id:"hKNwlNeKOf",values:{numExported:d,totalConversations:r,numFailed:f}}):(0,a.jsx)(c.Z,{defaultMessage:"Exporting: {numExported} / {totalConversations}",id:"EAIBTT4RJD",values:{numExported:d,totalConversations:r}})}):i?(0,a.jsx)(m,{ref:t,...e,onClick:()=>{let e=new Blob([i],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="conversations.json",s.click()},children:(0,a.jsx)(c.Z,{defaultMessage:"Download conversations",id:"BS3OuP1PiM"})}):(0,a.jsx)(m,{ref:t,...e,onClick:()=>{n(!0),x()},children:(0,a.jsx)(c.Z,{defaultMessage:"Export conversations",id:"0GrSEx4ynQ"})})});f.displayName="ExportConversationsWidget";let m=l.q.button(d()),x=e=>{let{conversationUUID:t}=e,{data:s}=(0,i.Rq)(t);return(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="conversation.json",n.click()},children:(0,a.jsx)(c.Z,{defaultMessage:"Download conversation",id:"VBmA8/nsFU"})})}},70278:function(e,t,s){"use strict";s.d(t,{c:function(){return l}});var n=s(64617),a=s(88495),i=s(67363);function l(e){let t=e.trim();return(0,n.HA)(t,{extensions:[(0,a.x)()],htmlExtensions:[(0,i.E)()]})}},37199:function(e,t,s){"use strict";s.d(t,{i:function(){return c},s:function(){return o}});var n=s(5362),a=s(53949),i=s(7653);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let n=null!==(t=s.get(e.file_name))&&void 0!==t?t:[];n.push(e),s.set(e.file_name,n)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let n=s.filter(e=>e.file_kind===a.Y.Blob);return 0===n.length?null:n[n.length-1]}function o(){let e=function(){let e=(0,n.OJ)();return(0,i.useCallback)(async(t,s,n,a,i)=>{let l=r(t,s);if(!l&&a){let s=await e("/api/organizations/".concat(n,"/projects/").concat(a,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(n,"/projects/").concat(a,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(n,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(n,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>2147483648-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,n,a,i,r)=>a?function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let n=s[s.length-1];if(n){let e=n.extracted_content;return new TextEncoder().encode(e)}return null}(t,s)||await e(t,n,a,i,r):null,[e])}function c(e,t,s,n,a){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,n,a),[e,t,s,n,l,a])}},84165:function(e,t,s){"use strict";s.d(t,{C:function(){return n}});let n=async e=>{let{prompt:t,appsUseTurmeric:s,orgUuid:n,artifactUuid:a,onRateLimitError:i}=e;if(!s||!n)return Promise.resolve(null);try{let e=await fetch("/api/artifacts/api/".concat(n,"/completion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t,artifact_uuid:a})});if(!e.ok)throw 429===e.status&&i&&i(),Error("HTTP error! status: ".concat(e.status));let s=await e.json();return Promise.resolve(s.completion)}catch(e){return Promise.reject(e)}}},51789:function(e,t,s){"use strict";s.d(t,{r:function(){return i},y:function(){return a}});var n=s(7653);let a=(0,n.createContext)(null),i=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},89269:function(e,t,s){"use strict";s.d(t,{s:function(){return a}});var n=s(7653);function a(e,t,s){let a=(0,n.useRef)(),i=(0,n.useCallback)(e,t),l=(0,n.useCallback)(()=>{a.current&&window.clearTimeout(a.current),a.current=window.setTimeout(i,s)},[i,s]);return(0,n.useEffect)(()=>{l()},[...t,i,s]),l}},39418:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var n=s(27573),a=s(10607),i=s(7653);function l(e){let{containerClassName:t,className:s,gradientHeight:l=24,children:r,...o}=e,c=(0,i.useRef)(null),[d,u]=(0,i.useState)(!0),[f,m]=(0,i.useState)(!0),x=(0,i.useRef)(d),h=(0,i.useRef)(f),g=()=>{let e=c.current;e&&(e.scrollHeight-e.scrollTop-e.clientHeight<=1?x.current||(u(!0),x.current=!0):x.current&&(u(!1),x.current=!1),e.scrollTop<=0?h.current||(m(!0),h.current=!0):h.current&&(m(!1),h.current=!1))};return(0,i.useEffect)(()=>{g()},[]),(0,n.jsx)("div",{style:{maskImage:"linear-gradient(to bottom, transparent 0%, black ".concat(f?0:l,"px, black calc(100% - ").concat(d?0:l,"px), transparent 100%)")},className:t,children:(0,n.jsx)("div",{onScroll:g,ref:c,className:(0,a.Z)("overflow-y-auto overflow-x-hidden",s),...o,children:r})})}},80727:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var n=s(84187);let a={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,n.a)(a[e])}},1679:function(){}}]);